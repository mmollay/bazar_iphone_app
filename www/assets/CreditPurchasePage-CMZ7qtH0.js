import{x as K,aJ as J,n as Y,aj as G,r as h,_ as b,aQ as V,aH as _,j as e,B as s,aR as q,R as F,l as z,T as t,A as Q,aB as w,ak as X,H as W,aS as ee,t as re,az as L,aT as se,K as T,S as M,aU as te,C as ie,f as oe}from"./index-kFPCxDRP.js";import{u as ne,f as a,a as g}from"./useSystemSettings-DRyNq9BN.js";import{S as ae}from"./Snackbar-ojQY2fo9.js";import{A as le}from"./arrow-left-u1hUR8uZ.js";import{Z as de}from"./zap-BOEIjyRH.js";import{S as ce}from"./shopping-cart-CHEGBgJ4.js";const be=()=>{const j=K(),[I]=J(),{user:A}=Y(),{settings:i,loading:P}=ne(),y=G(),[o,C]=h.useState(0),[v,D]=h.useState(null),[m,k]=h.useState(10),[c,B]=h.useState(!1),[H,l]=h.useState(null),[E,U]=h.useState(I.get("canceled")==="true");h.useEffect(()=>{const r=I.get("tab");C(r==="community"?1:0)},[I]);const p=r=>i?Math.floor(r/i.powerUserCreditPrice):0,u=r=>i?Math.floor(r/i.costPerListing):0,$=i?[{id:"STARTER",credits:p(5),price:5,bonus:0,features:["1 Credit = 1 Basic-Inserat","Premium-Features kosten zusätzlich","Keine monatlichen Limits","Credits verfallen nicht"]},{id:"POPULAR",credits:p(10),price:10,bonus:Math.floor(p(10)*.1),popular:!0,features:["1 Credit = 1 Basic-Inserat","Premium-Features kosten zusätzlich","10% Bonus Credits","Keine monatlichen Limits","Credits verfallen nicht"]},{id:"PRO",credits:p(20),price:20,bonus:Math.floor(p(20)*.15),bestValue:!0,features:["1 Credit = 1 Basic-Inserat","Premium-Features kosten zusätzlich","15% Bonus Credits","Beste Preis-Leistung","Keine monatlichen Limits","Credits verfallen nicht"]}]:[],O=i?[{id:"SUPPORTER",amount:5,impact:`~${a(u(5))} kostenlose Inserate`,icon:b,color:"#e91e63"},{id:"CONTRIBUTOR",amount:10,impact:`~${a(u(10))} kostenlose Inserate`,icon:V,color:"#9c27b0",popular:!0},{id:"CHAMPION",amount:25,impact:`~${a(u(25))} kostenlose Inserate`,icon:_,color:"#ff9800"}]:[],R=async(r,x)=>{if(!A){l("Bitte melde dich an, um fortzufahren.");return}D(r),B(!0),l(null);try{const{data:{session:n}}=await oe.auth.getSession(),d=n==null?void 0:n.access_token;if(!d){l("Bitte melde dich an, um fortzufahren.");return}const S=await fetch("https://hsbjflixgavjqxvnkivi.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify({packageId:r.toLowerCase(),type:x,amount:x==="community"?m:void 0})}),f=await S.json();if(!S.ok){f.needsConfig?l("Zahlungssystem ist noch nicht konfiguriert. Bitte kontaktiere den Administrator."):l(f.error||"Fehler beim Erstellen der Checkout-Session");return}f.url?window.location.href=f.url:l("Keine Checkout-URL erhalten")}catch(n){console.error("Error creating checkout session:",n),l(n instanceof Error?n.message:"Ein Fehler ist aufgetreten")}finally{B(!1)}},N=r=>{const x=r.credits+r.bonus,n=(r.price/x).toFixed(2),d=r.popular||r.bestValue;return e.jsxs(w,{sx:{position:"relative",border:d?"2px solid":"1px solid",borderColor:d?"primary.main":"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",display:"flex",flexDirection:"column",boxShadow:d?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[d&&e.jsx(T,{icon:r.popular?e.jsx(M,{size:14}):e.jsx(te,{size:14}),label:r.popular?"Beliebt":"Beste Wahl",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.popular?"primary.main":"#ff9800",color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(s,{sx:{p:3,display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(t,{variant:"overline",sx:{fontWeight:700,fontSize:"0.8rem",color:"primary.main",letterSpacing:"0.12em",lineHeight:1,mb:2},children:r.id}),e.jsxs(s,{sx:{mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[e.jsx(t,{variant:"h2",sx:{fontWeight:800,fontSize:{xs:"2.5rem",sm:"3rem"},lineHeight:1,color:"text.primary"},children:x}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{fontWeight:600},children:"Credits"})]}),r.bonus>0&&e.jsx(T,{label:`+${r.bonus} Bonus`,size:"small",sx:{mt:1,bgcolor:"success.light",color:"success.dark",fontWeight:700}})]}),e.jsx(s,{sx:{display:"flex",alignItems:"baseline",gap:.5,mb:1,py:2,borderTop:"1px solid",borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(t,{variant:"h3",sx:{fontWeight:800,fontSize:{xs:"2rem",sm:"2.25rem"},lineHeight:1,color:"text.primary"},children:g(r.price)})}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mb:3},children:[g(parseFloat(n))," pro Credit"]}),e.jsx(s,{sx:{mb:3,flexGrow:1},children:r.features.map((S,f)=>e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,py:.75},children:[e.jsx(ie,{size:18,style:{color:"#4caf50",flexShrink:0,marginTop:"2px"}}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem",lineHeight:1.6},children:S})]},f))}),e.jsx(z,{fullWidth:!0,variant:d?"contained":"outlined",size:"large",startIcon:c&&v===r.id?e.jsx(W,{size:18,color:"inherit"}):e.jsx(ce,{size:18}),onClick:()=>R(r.id,"personal"),disabled:c||P,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",mt:"auto",borderRadius:2},children:c&&v===r.id?"Laden...":"Credits kaufen"})]})]},r.id)},Z=r=>{const x=r.icon,n=u(r.amount);return e.jsxs(w,{sx:{position:"relative",border:r.popular?"2px solid":"1px solid",borderColor:r.popular?r.color:"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",boxShadow:r.popular?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[r.popular&&e.jsx(T,{icon:e.jsx(M,{size:14}),label:"Beliebt",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.color,color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(s,{sx:{p:3,display:"flex",flexDirection:"column"},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(s,{sx:{width:48,height:48,borderRadius:2,bgcolor:`${r.color}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(x,{size:24,style:{color:r.color}})}),e.jsx(t,{variant:"h6",sx:{fontWeight:700,color:"text.primary"},children:r.id})]}),e.jsxs(s,{sx:{mb:2},children:[e.jsx(s,{sx:{display:"flex",alignItems:"baseline",gap:1},children:e.jsx(t,{variant:"h3",sx:{fontWeight:800,fontSize:"2.5rem",lineHeight:1,color:"text.primary"},children:g(r.amount)})}),e.jsxs(t,{variant:"body2",sx:{color:r.color,fontWeight:600,mt:1},children:["= ",a(n)," kostenlose Inserate"]})]}),e.jsxs(s,{sx:{bgcolor:`${r.color}10`,borderRadius:2,p:2,mb:3,border:"1px solid",borderColor:`${r.color}30`},children:[e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"text.primary",mb:.5},children:"Impact:"}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:[r.impact," für die Community"]})]}),e.jsx(z,{fullWidth:!0,variant:"contained",size:"large",startIcon:c&&v===r.id?e.jsx(W,{size:18,color:"inherit"}):e.jsx(b,{size:18}),onClick:()=>R(r.id,"community"),disabled:c||P,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:r.color,"&:hover":{bgcolor:r.color,filter:"brightness(0.9)"}},children:c&&v===r.id?"Laden...":"Jetzt spenden"})]})]},r.id)};return e.jsxs(s,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(q,{onNavigate:r=>{r==="items"?j("/"):r==="messages"?j("/messages"):r==="settings"&&j("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsxs(s,{sx:{flex:1,bgcolor:"#fafafa"},children:[e.jsx(ae,{open:E,autoHideDuration:6e3,onClose:()=>U(!1),message:"Zahlung abgebrochen"}),e.jsx(s,{sx:{bgcolor:"white",borderBottom:"1px solid",borderColor:"divider",py:2},children:e.jsx(F,{maxWidth:"lg",children:e.jsx(z,{startIcon:e.jsx(le,{size:18}),onClick:()=>j(-1),sx:{textTransform:"none",fontWeight:500,color:"text.secondary"},children:"Zurück"})})}),e.jsxs(F,{maxWidth:"lg",sx:{py:6},children:[e.jsxs(s,{sx:{mb:5,textAlign:"center"},children:[e.jsx(t,{variant:"h3",sx:{fontWeight:800,mb:2,color:"text.primary",fontSize:{xs:"2rem",sm:"2.5rem",md:"3rem"}},children:"HabDaWas Credits"}),e.jsxs(t,{variant:"h6",color:"text.secondary",sx:{mb:2,maxWidth:700,mx:"auto",fontWeight:400,lineHeight:1.8},children:[e.jsxs("strong",{style:{color:"#4caf50"},children:[a((i==null?void 0:i.dailyFreeListings)||5)," Gratis-Inserate"]})," jeden Monat"]}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{maxWidth:600,mx:"auto",lineHeight:1.6},children:"Credits für Power-User • Spenden für die Community"})]}),H&&e.jsx(Q,{severity:"error",onClose:()=>l(null),sx:{mb:4,maxWidth:900,mx:"auto"},children:H}),e.jsx(s,{sx:{mb:4,display:"flex",justifyContent:"center"},children:e.jsxs(s,{sx:{display:"inline-flex",gap:1.5,p:.75,bgcolor:"#f8f9fa",borderRadius:2,border:"1px solid #e8eaed"},children:[e.jsxs(s,{onClick:()=>C(0),sx:{display:"flex",alignItems:"center",gap:1,px:{xs:2,sm:2.5},py:{xs:1,sm:1.25},borderRadius:1.5,cursor:"pointer",transition:"all 0.2s ease",bgcolor:o===0?"#e8f0fe":"transparent",border:"2px solid",borderColor:o===0?"#1a73e8":"transparent","&:hover":{bgcolor:o===0?"#e8f0fe":"rgba(26, 115, 232, 0.08)",transform:"translateY(-1px)"}},children:[e.jsx(s,{sx:{width:{xs:28,sm:32},height:{xs:28,sm:32},borderRadius:1.5,bgcolor:o===0?"#1a73e8":"#e8eaed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx(de,{size:o===0?16:14,style:{color:o===0?"white":"#5f6368"}})}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:{xs:"0.8rem",sm:"0.95rem"},color:o===0?"#1a73e8":"#5f6368",lineHeight:1.2,display:{xs:"none",sm:"block"}},children:"Personal Credits"}),e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:"0.8rem",color:o===0?"#1a73e8":"#5f6368",lineHeight:1.2,display:{xs:"block",sm:"none"}},children:"Credits"}),e.jsx(t,{variant:"caption",sx:{color:o===0?"#1a73e8":"#5f6368",fontSize:{xs:"0.6rem",sm:"0.7rem"},opacity:.75},children:"Für Power-User"})]})]}),e.jsxs(s,{onClick:()=>C(1),sx:{display:"flex",alignItems:"center",gap:1,px:{xs:2,sm:2.5},py:{xs:1,sm:1.25},borderRadius:1.5,cursor:"pointer",transition:"all 0.2s ease",bgcolor:o===1?"#fef7ff":"transparent",border:"2px solid",borderColor:o===1?"#c51162":"transparent","&:hover":{bgcolor:o===1?"#fef7ff":"rgba(197, 17, 98, 0.08)",transform:"translateY(-1px)"}},children:[e.jsx(s,{sx:{width:{xs:28,sm:32},height:{xs:28,sm:32},borderRadius:1.5,bgcolor:o===1?"#c51162":"#e8eaed",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease"},children:e.jsx(b,{size:o===1?16:14,style:{color:o===1?"white":"#5f6368"}})}),e.jsxs(s,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:{xs:"0.8rem",sm:"0.95rem"},color:o===1?"#c51162":"#5f6368",lineHeight:1.2,display:{xs:"none",sm:"block"}},children:"Community Spenden"}),e.jsx(t,{variant:"body2",sx:{fontWeight:700,fontSize:"0.8rem",color:o===1?"#c51162":"#5f6368",lineHeight:1.2,display:{xs:"block",sm:"none"}},children:"Spenden"}),e.jsx(t,{variant:"caption",sx:{color:o===1?"#c51162":"#5f6368",fontSize:{xs:"0.6rem",sm:"0.7rem"},opacity:.75},children:"Für die Community"})]})]})]})}),e.jsxs(s,{sx:{mb:4,maxWidth:600,mx:"auto",display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1.5},children:[A&&e.jsxs(w,{sx:{flex:1,p:1.5,bgcolor:"rgba(25, 118, 210, 0.05)",border:"1px solid rgba(25, 118, 210, 0.2)",borderRadius:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:1,bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(X,{size:16,style:{color:"white"}})}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Meine Credits"}),e.jsx(t,{variant:"body1",sx:{fontWeight:700,color:"primary.main",lineHeight:1.2,fontSize:"1.1rem"},children:y.loading?e.jsx(W,{size:14}):a(y.personalCredits)})]})]}),e.jsxs(w,{sx:{flex:1,p:1.5,bgcolor:"rgba(233, 30, 99, 0.05)",border:"1px solid rgba(233, 30, 99, 0.2)",borderRadius:2,display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(s,{sx:{width:32,height:32,borderRadius:1,bgcolor:"#e91e63",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ee,{size:16,style:{color:"white"}})}),e.jsxs(s,{sx:{flex:1},children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem"},children:"Community-Topf"}),e.jsx(t,{variant:"body1",sx:{fontWeight:700,color:"#e91e63",lineHeight:1.2,fontSize:"1.1rem"},children:y.loading?e.jsx(W,{size:14}):`${a(y.communityPotBalance)} Inserate`})]})]})]}),o===0&&e.jsxs(s,{children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsx(t,{variant:"h5",sx:{fontWeight:700,mb:1},children:"Personal Credits kaufen"}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto"},children:["Für Power-User, die mehr als ",a((i==null?void 0:i.dailyFreeListings)||5)," Inserate pro Monat benötigen. Credits verfallen nicht und können jederzeit verwendet werden."]})]}),e.jsx(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto"},children:$.map(N)}),e.jsx(s,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(25, 118, 210, 0.05)",border:"1px solid rgba(25, 118, 210, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["💡 ",e.jsx("strong",{children:"So funktionieren Credits:"})," 1 Credit = 1 Basic-Inserat. Premium-Features (z.B. Hervorhebung, Top-Platzierung) kosten zusätzliche Credits. Credits verfallen nie!"]})})]}),o===1&&e.jsxs(s,{children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsxs(t,{variant:"h5",sx:{fontWeight:700,mb:1,display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(b,{size:22,style:{color:"#e91e63"}}),"Community unterstützen"]}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto",mb:2},children:"Mit deiner Spende ermöglichst du kostenlosen Zugang für alle! Deine Spende füllt den Community-Topf und ermöglicht kostenlose Inserate für die Allgemeinheit."}),e.jsx(t,{variant:"body2",sx:{fontWeight:600,color:"#e91e63"},children:"🏆 Top-Spender werden in unserer Hall of Fame geehrt!"})]}),e.jsx(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto",mb:4},children:O.map(Z)}),e.jsxs(s,{sx:{maxWidth:600,mx:"auto",p:4,borderRadius:3,bgcolor:"white",border:"2px dashed",borderColor:"divider"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:700,mb:2,textAlign:"center"},children:"Eigener Betrag"}),e.jsx(re,{fullWidth:!0,type:"number",value:m,onChange:r=>k(parseFloat(r.target.value)||0),InputProps:{startAdornment:e.jsx(L,{position:"start",children:"€"}),endAdornment:e.jsx(L,{position:"end",children:e.jsxs(t,{variant:"caption",color:"text.secondary",children:["= ",a(u(m))," Inserate"]})})},inputProps:{min:(i==null?void 0:i.minDonationAmount)||5,step:1},sx:{mb:2}}),e.jsxs(z,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(b,{size:18}),onClick:()=>R("CUSTOM","community"),disabled:c||m<((i==null?void 0:i.minDonationAmount)||5)||P,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:"#e91e63","&:hover":{bgcolor:"#c2185b"}},children:[g(m)," spenden"]}),m<((i==null?void 0:i.minDonationAmount)||5)&&e.jsxs(t,{variant:"caption",color:"error",sx:{mt:1,display:"block",textAlign:"center"},children:["Mindestbetrag: ",g((i==null?void 0:i.minDonationAmount)||5)]})]}),e.jsx(s,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(233, 30, 99, 0.05)",border:"1px solid rgba(233, 30, 99, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["🌟 ",e.jsx("strong",{children:"So funktioniert's:"})," Jeder gespendete Euro wird 1:1 in kostenlose Inserate umgewandelt. Mit 10€ ermöglichst du ",a(u(10))," kostenlose Inserate für die Community!"]})})]})]})]}),e.jsx(se,{})]})};export{be as CreditPurchasePage};
