import{x as p,r as b,j as o,B as h,T as c,H as x,f as A}from"./index-Bsq2wW-s.js";const w=()=>{const a=p(),[u,n]=b.useState(null);if(b.useEffect(()=>{(async()=>{try{const e=window.location.href,r=new URLSearchParams(window.location.search),f=r.get("platform")==="ios";if(console.log("[OAuth Callback] Processing URL:",e),console.log("[OAuth Callback] Platform:",f?"Native iOS (from URL param)":"Web"),console.log("[OAuth Callback] All URL parameters:"),r.forEach((t,s)=>{console.log(`  - ${s}: ${t}`)}),f){console.log("[OAuth Callback] Native iOS request detected - redirecting to app...");const t=r.get("error"),s=r.get("error_description");if(t){console.error("[OAuth Callback] OAuth Error:",t),console.error("[OAuth Callback] Error Description:",s),n(`OAuth Fehler: ${s||t}`);return}const i=window.location.hash.substring(1);if(console.log("[OAuth Callback] URL Fragment:",i),!i){console.error("[OAuth Callback] No fragment found in URL"),console.error("[OAuth Callback] Full URL:",window.location.href),n("Keine Authentifizierungsdaten gefunden.");return}const m=`habdawas://auth/callback#${i}`;console.log("[OAuth Callback] Redirecting to:",m),window.location.href=m;return}console.log("[OAuth Callback] Web platform - exchanging code for session...");const{error:d}=await A.auth.exchangeCodeForSession(e);if(d){console.error("[OAuth Callback] Exchange error:",d),n("Anmeldung fehlgeschlagen. Bitte versuche es erneut."),setTimeout(()=>a("/"),3e3);return}console.log("[OAuth Callback] Success! Redirecting to home..."),a("/",{replace:!0})}catch(e){console.error("[OAuth Callback] Error:",e),n("Ein Fehler ist aufgetreten. Du wirst weitergeleitet..."),setTimeout(()=>a("/"),3e3)}})()},[a]),u){const g=new URLSearchParams(window.location.search),e=[];return g.forEach((r,l)=>{e.push(`${l}: ${r}`)}),o.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[o.jsx(c,{variant:"h6",color:"error",children:u}),e.length>0&&o.jsxs(h,{sx:{mt:2,p:2,bgcolor:"#f5f5f5",borderRadius:1,width:"100%",maxWidth:500},children:[o.jsx(c,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Debug Info:"}),e.map((r,l)=>o.jsx(c,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.8rem"},children:r},l))]})]})}return o.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[o.jsx(x,{size:60}),o.jsx(c,{variant:"h6",children:"Anmeldung wird verarbeitet..."})]})};export{w as OAuthCallbackPage};
