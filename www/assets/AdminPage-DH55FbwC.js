import{a as he,g as ge,r as o,u as me,h as Vt,a_ as Zt,a$ as He,aS as Qt,aU as Xt,b0 as mt,b1 as Yt,aT as Jt,b2 as es,j as e,c as le,aO as Fe,s as re,b3 as ts,b4 as Tt,aP as ie,b as xe,m as ve,b5 as xt,e as We,n as _t,f as M,B as w,T as u,P as te,ad as Re,ag as Ke,ah as ze,L as _,A as X,Q as ss,t as se,aB as ft,l as Q,x as Ct,H as rt,K as U,w as St,as as Rt,M as zt,av as nt,a3 as rs,C as ns,V as Mt,D as Me,p as Ae,q as Be,v as $e,ax as Pe,ay as De,b6 as st,b7 as Y,ac as os,ap as as,b8 as is,N as et,o as ls,O as tt,aY as cs,R as ds,b9 as ps,aZ as us}from"./index-D3GumTob.js";import{S as hs}from"./save-BtAhMKPU.js";import{S as Ge}from"./Snackbar-Di8TQ8EG.js";import{C as At}from"./credit-card-AcJFDDUD.js";import{G as ue}from"./Grid-CMjmK_Rq.js";import{P as gs}from"./plus-DeWqYPXO.js";import{A as ms,a as xs,b as fs}from"./AccordionSummary-CQElU5Qb.js";import{C as ys}from"./calendar-CeLqFR2w.js";function js(t){return ge("MuiTooltip",t)}const z=he("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]);function bs(t){return Math.round(t*1e5)/1e5}const vs=t=>{const{classes:s,disableInteractive:a,arrow:l,touch:y,placement:d}=t,x={popper:["popper",!a&&"popperInteractive",l&&"popperArrow"],tooltip:["tooltip",l&&"tooltipArrow",y&&"touch",`tooltipPlacement${ie(d.split("-")[0])}`],arrow:["arrow"]};return xe(x,js,s)},ws=re(Tt,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.popper,!a.disableInteractive&&s.popperInteractive,a.arrow&&s.popperArrow,!a.open&&s.popperClose]}})(ve(({theme:t})=>({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none",variants:[{props:({ownerState:s})=>!s.disableInteractive,style:{pointerEvents:"auto"}},{props:({open:s})=>!s,style:{pointerEvents:"none"}},{props:({ownerState:s})=>s.arrow,style:{[`&[data-popper-placement*="bottom"] .${z.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${z.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${z.arrow}`]:{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}},[`&[data-popper-placement*="left"] .${z.arrow}`]:{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}}}},{props:({ownerState:s})=>s.arrow&&!s.isRtl,style:{[`&[data-popper-placement*="right"] .${z.arrow}`]:{left:0,marginLeft:"-0.71em"}}},{props:({ownerState:s})=>s.arrow&&!!s.isRtl,style:{[`&[data-popper-placement*="right"] .${z.arrow}`]:{right:0,marginRight:"-0.71em"}}},{props:({ownerState:s})=>s.arrow&&!s.isRtl,style:{[`&[data-popper-placement*="left"] .${z.arrow}`]:{right:0,marginRight:"-0.71em"}}},{props:({ownerState:s})=>s.arrow&&!!s.isRtl,style:{[`&[data-popper-placement*="left"] .${z.arrow}`]:{left:0,marginLeft:"-0.71em"}}}]}))),ks=re("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.tooltip,a.touch&&s.touch,a.arrow&&s.tooltipArrow,s[`tooltipPlacement${ie(a.placement.split("-")[0])}`]]}})(ve(({theme:t})=>({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:t.alpha(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium,[`.${z.popper}[data-popper-placement*="left"] &`]:{transformOrigin:"right center"},[`.${z.popper}[data-popper-placement*="right"] &`]:{transformOrigin:"left center"},[`.${z.popper}[data-popper-placement*="top"] &`]:{transformOrigin:"center bottom",marginBottom:"14px"},[`.${z.popper}[data-popper-placement*="bottom"] &`]:{transformOrigin:"center top",marginTop:"14px"},variants:[{props:({ownerState:s})=>s.arrow,style:{position:"relative",margin:0}},{props:({ownerState:s})=>s.touch,style:{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${bs(16/14)}em`,fontWeight:t.typography.fontWeightRegular}},{props:({ownerState:s})=>!s.isRtl,style:{[`.${z.popper}[data-popper-placement*="left"] &`]:{marginRight:"14px"},[`.${z.popper}[data-popper-placement*="right"] &`]:{marginLeft:"14px"}}},{props:({ownerState:s})=>!s.isRtl&&s.touch,style:{[`.${z.popper}[data-popper-placement*="left"] &`]:{marginRight:"24px"},[`.${z.popper}[data-popper-placement*="right"] &`]:{marginLeft:"24px"}}},{props:({ownerState:s})=>!!s.isRtl,style:{[`.${z.popper}[data-popper-placement*="left"] &`]:{marginLeft:"14px"},[`.${z.popper}[data-popper-placement*="right"] &`]:{marginRight:"14px"}}},{props:({ownerState:s})=>!!s.isRtl&&s.touch,style:{[`.${z.popper}[data-popper-placement*="left"] &`]:{marginLeft:"24px"},[`.${z.popper}[data-popper-placement*="right"] &`]:{marginRight:"24px"}}},{props:({ownerState:s})=>s.touch,style:{[`.${z.popper}[data-popper-placement*="top"] &`]:{marginBottom:"24px"}}},{props:({ownerState:s})=>s.touch,style:{[`.${z.popper}[data-popper-placement*="bottom"] &`]:{marginTop:"24px"}}}]}))),Ts=re("span",{name:"MuiTooltip",slot:"Arrow"})(ve(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:t.alpha(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}})));let Ne=!1;const yt=new Yt;let Se={x:0,y:0};function Ue(t,s){return(a,...l)=>{s&&s(a,...l),t(a,...l)}}const _s=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTooltip"}),{arrow:y=!1,children:d,classes:x,components:j={},componentsProps:h={},describeChild:g=!1,disableFocusListener:S=!1,disableHoverListener:A=!1,disableInteractive:b=!1,disableTouchListener:P=!1,enterDelay:B=100,enterNextDelay:C=0,enterTouchDelay:L=700,followCursor:W=!1,id:n,leaveDelay:p=0,leaveTouchDelay:T=1500,onClose:v,onOpen:I,open:fe,placement:ye="bottom",PopperComponent:N,PopperProps:F={},slotProps:D={},slots:je={},title:K,TransitionComponent:we,TransitionProps:ce,...ne}=l,O=o.isValidElement(d)?d:e.jsx("span",{children:d}),H=Vt(),ke=Zt(),[E,r]=o.useState(),[c,R]=o.useState(null),$=o.useRef(!1),G=b||W,J=He(),oe=He(),i=He(),k=He(),[de,be]=Qt({controlled:fe,default:!1,name:"Tooltip",state:"open"});let ee=de;const Ze=Xt(n),Te=o.useRef(),Ie=mt(()=>{Te.current!==void 0&&(document.body.style.WebkitUserSelect=Te.current,Te.current=void 0),k.clear()});o.useEffect(()=>Ie,[Ie]);const ct=f=>{yt.clear(),Ne=!0,be(!0),I&&!ee&&I(f)},Le=mt(f=>{yt.start(800+p,()=>{Ne=!1}),be(!1),v&&ee&&v(f),J.start(H.transitions.duration.shortest,()=>{$.current=!1})}),Oe=f=>{$.current&&f.type!=="touchstart"||(E&&E.removeAttribute("title"),oe.clear(),i.clear(),B||Ne&&C?oe.start(Ne?C:B,()=>{ct(f)}):ct(f))},Qe=f=>{oe.clear(),i.start(p,()=>{Le(f)})},[,dt]=o.useState(!1),pt=f=>{xt(f.target)||(dt(!1),Qe(f))},ut=f=>{E||r(f.currentTarget),xt(f.target)&&(dt(!0),Oe(f))},ht=f=>{$.current=!0;const Z=O.props;Z.onTouchStart&&Z.onTouchStart(f)},Pt=f=>{ht(f),i.clear(),J.clear(),Ie(),Te.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",k.start(L,()=>{document.body.style.WebkitUserSelect=Te.current,Oe(f)})},Dt=f=>{O.props.onTouchEnd&&O.props.onTouchEnd(f),Ie(),i.start(T,()=>{Le(f)})};o.useEffect(()=>{if(!ee)return;function f(Z){Z.key==="Escape"&&Le(Z)}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[Le,ee]);const Wt=Jt(es(O),r,a);!K&&K!==0&&(ee=!1);const Xe=o.useRef(),It=f=>{const Z=O.props;Z.onMouseMove&&Z.onMouseMove(f),Se={x:f.clientX,y:f.clientY},Xe.current&&Xe.current.update()},_e={},Ye=typeof K=="string";g?(_e.title=!ee&&Ye&&!A?K:null,_e["aria-describedby"]=ee?Ze:null):(_e["aria-label"]=Ye?K:null,_e["aria-labelledby"]=ee&&!Ye?Ze:null);const q={..._e,...ne,...O.props,className:le(ne.className,O.props.className),onTouchStart:ht,ref:Wt,...W?{onMouseMove:It}:{}},Ce={};P||(q.onTouchStart=Pt,q.onTouchEnd=Dt),A||(q.onMouseOver=Ue(Oe,q.onMouseOver),q.onMouseLeave=Ue(Qe,q.onMouseLeave),G||(Ce.onMouseOver=Oe,Ce.onMouseLeave=Qe)),S||(q.onFocus=Ue(ut,q.onFocus),q.onBlur=Ue(pt,q.onBlur),G||(Ce.onFocus=ut,Ce.onBlur=pt));const pe={...l,isRtl:ke,arrow:y,disableInteractive:G,placement:ye,PopperComponentProp:N,touch:$.current},V=typeof D.popper=="function"?D.popper(pe):D.popper,Lt=o.useMemo(()=>{var Z,gt;let f=[{name:"arrow",enabled:!!c,options:{element:c,padding:4}}];return(Z=F.popperOptions)!=null&&Z.modifiers&&(f=f.concat(F.popperOptions.modifiers)),(gt=V==null?void 0:V.popperOptions)!=null&&gt.modifiers&&(f=f.concat(V.popperOptions.modifiers)),{...F.popperOptions,...V==null?void 0:V.popperOptions,modifiers:f}},[c,F.popperOptions,V==null?void 0:V.popperOptions]),Je=vs(pe),Ot=typeof D.transition=="function"?D.transition(pe):D.transition,Ee={slots:{popper:j.Popper,transition:j.Transition??we,tooltip:j.Tooltip,arrow:j.Arrow,...je},slotProps:{arrow:D.arrow??h.arrow,popper:{...F,...V??h.popper},tooltip:D.tooltip??h.tooltip,transition:{...ce,...Ot??h.transition}}},[Et,Ht]=Fe("popper",{elementType:ws,externalForwardedProps:Ee,ownerState:pe,className:le(Je.popper,F==null?void 0:F.className)}),[Ft,Nt]=Fe("transition",{elementType:ts,externalForwardedProps:Ee,ownerState:pe}),[Ut,Kt]=Fe("tooltip",{elementType:ks,className:Je.tooltip,externalForwardedProps:Ee,ownerState:pe}),[Gt,qt]=Fe("arrow",{elementType:Ts,className:Je.arrow,externalForwardedProps:Ee,ownerState:pe,ref:R});return e.jsxs(o.Fragment,{children:[o.cloneElement(O,q),e.jsx(Et,{as:N??Tt,placement:ye,anchorEl:W?{getBoundingClientRect:()=>({top:Se.y,left:Se.x,right:Se.x,bottom:Se.y,width:0,height:0})}:E,popperRef:Xe,open:E?ee:!1,id:Ze,transition:!0,...Ce,...Ht,popperOptions:Lt,children:({TransitionProps:f})=>e.jsx(Ft,{timeout:H.transitions.duration.shorter,...f,...Nt,children:e.jsxs(Ut,{...Kt,children:[K,y?e.jsx(Gt,{...qt}):null]})})})]})}),Bt=o.createContext();function Cs(t){return ge("MuiTable",t)}he("MuiTable",["root","stickyHeader"]);const Ss=t=>{const{classes:s,stickyHeader:a}=t;return xe({root:["root",a&&"stickyHeader"]},Cs,s)},Rs=re("table",{name:"MuiTable",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.root,a.stickyHeader&&s.stickyHeader]}})(ve(({theme:t})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...t.typography.body2,padding:t.spacing(2),color:(t.vars||t).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:s})=>s.stickyHeader,style:{borderCollapse:"separate"}}]}))),jt="table",ot=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTable"}),{className:y,component:d=jt,padding:x="normal",size:j="medium",stickyHeader:h=!1,...g}=l,S={...l,component:d,padding:x,size:j,stickyHeader:h},A=Ss(S),b=o.useMemo(()=>({padding:x,size:j,stickyHeader:h}),[x,j,h]);return e.jsx(Bt.Provider,{value:b,children:e.jsx(Rs,{as:d,role:d===jt?null:"table",ref:a,className:le(A.root,y),ownerState:S,...g})})}),qe=o.createContext();function zs(t){return ge("MuiTableBody",t)}he("MuiTableBody",["root"]);const Ms=t=>{const{classes:s}=t;return xe({root:["root"]},zs,s)},As=re("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),Bs={variant:"body"},bt="tbody",at=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTableBody"}),{className:y,component:d=bt,...x}=l,j={...l,component:d},h=Ms(j);return e.jsx(qe.Provider,{value:Bs,children:e.jsx(As,{className:le(h.root,y),as:d,ref:a,role:d===bt?null:"rowgroup",ownerState:j,...x})})});function $s(t){return ge("MuiTableCell",t)}const Ps=he("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),Ds=t=>{const{classes:s,variant:a,align:l,padding:y,size:d,stickyHeader:x}=t,j={root:["root",a,x&&"stickyHeader",l!=="inherit"&&`align${ie(l)}`,y!=="normal"&&`padding${ie(y)}`,`size${ie(d)}`]};return xe(j,$s,s)},Ws=re("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.root,s[a.variant],s[`size${ie(a.size)}`],a.padding!=="normal"&&s[`padding${ie(a.padding)}`],a.align!=="inherit"&&s[`align${ie(a.align)}`],a.stickyHeader&&s.stickyHeader]}})(ve(({theme:t})=>({...t.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:t.vars?`1px solid ${t.vars.palette.TableCell.border}`:`1px solid
    ${t.palette.mode==="light"?t.lighten(t.alpha(t.palette.divider,1),.88):t.darken(t.alpha(t.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(t.vars||t).palette.text.primary,lineHeight:t.typography.pxToRem(24),fontWeight:t.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(t.vars||t).palette.text.primary}},{props:{variant:"footer"},style:{color:(t.vars||t).palette.text.secondary,lineHeight:t.typography.pxToRem(21),fontSize:t.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Ps.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:s})=>s.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(t.vars||t).palette.background.default}}]}))),m=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTableCell"}),{align:y="inherit",className:d,component:x,padding:j,scope:h,size:g,sortDirection:S,variant:A,...b}=l,P=o.useContext(Bt),B=o.useContext(qe),C=B&&B.variant==="head";let L;x?L=x:L=C?"th":"td";let W=h;L==="td"?W=void 0:!W&&C&&(W="col");const n=A||B&&B.variant,p={...l,align:y,component:L,padding:j||(P&&P.padding?P.padding:"normal"),size:g||(P&&P.size?P.size:"medium"),sortDirection:S,stickyHeader:n==="head"&&P&&P.stickyHeader,variant:n},T=Ds(p);let v=null;return S&&(v=S==="asc"?"ascending":"descending"),e.jsx(Ws,{as:L,ref:a,className:le(T.root,d),"aria-sort":v,scope:W,ownerState:p,...b})});function Is(t){return ge("MuiTableContainer",t)}he("MuiTableContainer",["root"]);const Ls=t=>{const{classes:s}=t;return xe({root:["root"]},Is,s)},Os=re("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),it=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTableContainer"}),{className:y,component:d="div",...x}=l,j={...l,component:d},h=Ls(j);return e.jsx(Os,{ref:a,as:d,className:le(h.root,y),ownerState:j,...x})});function Es(t){return ge("MuiTableHead",t)}he("MuiTableHead",["root"]);const Hs=t=>{const{classes:s}=t;return xe({root:["root"]},Es,s)},Fs=re("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Ns={variant:"head"},vt="thead",lt=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTableHead"}),{className:y,component:d=vt,...x}=l,j={...l,component:d},h=Hs(j);return e.jsx(qe.Provider,{value:Ns,children:e.jsx(Fs,{as:d,className:le(h.root,y),ref:a,role:d===vt?null:"rowgroup",ownerState:j,...x})})});function Us(t){return ge("MuiTableRow",t)}const wt=he("MuiTableRow",["root","selected","hover","head","footer"]),Ks=t=>{const{classes:s,selected:a,hover:l,head:y,footer:d}=t;return xe({root:["root",a&&"selected",l&&"hover",y&&"head",d&&"footer"]},Us,s)},Gs=re("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:a}=t;return[s.root,a.head&&s.head,a.footer&&s.footer]}})(ve(({theme:t})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${wt.hover}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${wt.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`)}}}))),kt="tr",ae=o.forwardRef(function(s,a){const l=me({props:s,name:"MuiTableRow"}),{className:y,component:d=kt,hover:x=!1,selected:j=!1,...h}=l,g=o.useContext(qe),S={...l,component:d,hover:x,selected:j,head:g&&g.variant==="head",footer:g&&g.variant==="footer"},A=Ks(S);return e.jsx(Gs,{as:d,ref:a,className:le(A.root,y),role:d===kt?null:"row",ownerState:S,...h})});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=We("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=We("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=We("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=We("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=We("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),Ve=()=>{const{user:t}=_t(),[s,a]=o.useState(!1),[l,y]=o.useState(!0);return o.useEffect(()=>{(async()=>{if(!t){a(!1),y(!1);return}const{data:p}=await M.from("profiles").select("is_admin").eq("id",t.id).maybeSingle();a((p==null?void 0:p.is_admin)===!0),y(!1)})()},[t]),{isAdmin:s,loading:l,getSystemSettings:async()=>{const{data:n,error:p}=await M.from("system_settings").select("*").limit(1).maybeSingle();if(p)throw p;return n},updateSystemSettings:async n=>{const{data:p}=await M.from("system_settings").select("id").limit(1).maybeSingle();if(!p)throw new Error("System settings not found");const{error:T}=await M.from("system_settings").update({...n,updated_at:new Date().toISOString(),updated_by:t==null?void 0:t.id}).eq("id",p.id);if(T)throw T},getAllUsers:async()=>{const{data:n,error:p}=await M.rpc("get_all_users_admin");if(p)throw p;return n||[]},suspendUser:async(n,p)=>{const{error:T}=await M.rpc("suspend_user_admin",{target_user_id:n,reason:p});if(T)throw T},unsuspendUser:async n=>{const{error:p}=await M.rpc("unsuspend_user_admin",{target_user_id:n});if(p)throw p},deleteUser:async n=>{const{error:p}=await M.rpc("delete_user_admin",{target_user_id:n});if(p)throw p},updateUserTokens:async(n,p)=>{const{error:T}=await M.from("user_tokens").update({balance:p}).eq("user_id",n);if(T)throw T},getAllRoles:async()=>{const{data:n,error:p}=await M.rpc("get_all_roles_with_permissions");if(p)throw p;return n||[]},getUserRoles:async n=>{const{data:p,error:T}=await M.rpc("get_user_roles",{check_user_id:n});if(T)throw T;return p||[]},assignRole:async(n,p)=>{const{error:T}=await M.rpc("assign_role_to_user",{target_user_id:n,target_role_id:p});if(T)throw T},removeRole:async(n,p)=>{const{error:T}=await M.rpc("remove_role_from_user",{target_user_id:n,target_role_id:p});if(T)throw T},getUserPermissions:async n=>{const{data:p,error:T}=await M.rpc("get_user_permissions",{check_user_id:n});if(T)throw T;return p||[]},hasPermission:async n=>{if(!t)return!1;const{data:p,error:T}=await M.rpc("user_has_permission",{check_user_id:t.id,permission_name:n});return T?!1:p||!1}}},Xs=()=>{const{getSystemSettings:t,updateSystemSettings:s}=Ve(),[a,l]=o.useState(!1),[y,d]=o.useState(!1),[x,j]=o.useState({open:!1,message:"",severity:"success"}),[h,g]=o.useState({id:"",token_system_mode:"enabled",default_token_package:100,token_price_per_100:1.99,platform_message:null,updated_at:"",updated_by:null});o.useEffect(()=>{S()},[]);const S=async()=>{l(!0);try{const b=await t();b&&g(b)}catch(b){j({open:!0,message:`Fehler beim Laden: ${b.message}`,severity:"error"})}finally{l(!1)}},A=async()=>{d(!0);try{await s({token_system_mode:h.token_system_mode,default_token_package:h.default_token_package,token_price_per_100:h.token_price_per_100,platform_message:h.platform_message}),j({open:!0,message:"Einstellungen erfolgreich gespeichert",severity:"success"}),await S()}catch(b){j({open:!0,message:`Fehler beim Speichern: ${b.message}`,severity:"error"})}finally{d(!1)}};return a?e.jsx(w,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(u,{children:"Lade Einstellungen..."})}):e.jsxs(w,{children:[e.jsxs(te,{sx:{p:3,mb:3},children:[e.jsx(u,{variant:"h6",sx:{mb:3,fontWeight:600},children:"Token-System"}),e.jsxs(Re,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Ke,{children:"Token-System Modus"}),e.jsxs(ze,{value:h.token_system_mode,label:"Token-System Modus",onChange:b=>g({...h,token_system_mode:b.target.value}),children:[e.jsx(_,{value:"enabled",children:"Aktiviert - Normale Token-Nutzung"}),e.jsx(_,{value:"donation_only",children:"Nur Spenden - Kostenloser Test-Modus"}),e.jsx(_,{value:"disabled",children:"Deaktiviert - Keine Token-Funktion"})]})]}),h.token_system_mode==="donation_only"&&e.jsx(X,{severity:"info",sx:{mb:3},children:"Im Spenden-Modus können Benutzer alle Funktionen kostenlos testen. Das ist ideal für Freunde während der Testphase."}),h.token_system_mode==="disabled"&&e.jsx(X,{severity:"warning",sx:{mb:3},children:"Im deaktivierten Modus sind alle Token-Funktionen ausgeblendet."}),e.jsx(ss,{sx:{my:3}}),e.jsx(u,{variant:"h6",sx:{mb:1,fontWeight:600},children:"Token-Preise"}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Hier kannst du die Preisstruktur für Token-Pakete festlegen. Diese Preise gelten systemweit und beeinflussen alle Kauf-Optionen."}),e.jsxs(w,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(se,{label:"Basis-Einheit",type:"number",fullWidth:!0,value:h.default_token_package,onChange:b=>g({...h,default_token_package:parseInt(b.target.value)||0}),InputProps:{endAdornment:e.jsx(ft,{position:"end",children:"Tokens"})},helperText:"Die kleinste kaufbare Token-Menge (z.B. 100)",sx:{minWidth:250}}),e.jsx(se,{label:"Preis pro 100 Tokens",type:"number",fullWidth:!0,value:h.token_price_per_100,onChange:b=>g({...h,token_price_per_100:parseFloat(b.target.value)||0}),InputProps:{startAdornment:e.jsx(ft,{position:"start",children:"€"})},inputProps:{step:.01,min:0},helperText:"Basispreis für 100 Tokens (z.B. 1,99 €)",sx:{minWidth:250}})]}),e.jsxs(X,{severity:"info",sx:{mb:0},children:[e.jsx(u,{variant:"body2",fontWeight:600,mb:1,children:"Berechnungsbeispiel:"}),e.jsxs(u,{variant:"body2",component:"div",children:["• 100 Tokens = ",h.token_price_per_100.toFixed(2)," €",e.jsx("br",{}),"• 200 Tokens = ",(h.token_price_per_100*2).toFixed(2)," €",e.jsx("br",{}),"• 500 Tokens = ",(h.token_price_per_100*5).toFixed(2)," €",e.jsx("br",{}),"• 1.000 Tokens = ",(h.token_price_per_100*10).toFixed(2)," €"]}),e.jsx(u,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1},children:"Die Token-Pakete auf der Kaufseite können zusätzliche Bonus-Tokens enthalten (z.B. 10% mehr bei größeren Paketen)."})]})]}),e.jsxs(te,{sx:{p:3,mb:3},children:[e.jsx(u,{variant:"h6",sx:{mb:3,fontWeight:600},children:"Plattform-Nachricht"}),e.jsx(se,{label:"Nachricht an alle Benutzer (optional)",multiline:!0,rows:4,fullWidth:!0,value:h.platform_message||"",onChange:b=>g({...h,platform_message:b.target.value||null}),placeholder:"Z.B.: 'Willkommen in der Beta-Phase! Bitte melden Sie Bugs an office@ssi.at'",helperText:"Diese Nachricht wird allen Benutzern auf der Startseite angezeigt"})]}),e.jsx(w,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(Q,{variant:"contained",size:"large",startIcon:e.jsx(hs,{size:20}),onClick:A,disabled:y,children:y?"Speichert...":"Einstellungen speichern"})}),e.jsx(Ge,{open:x.open,autoHideDuration:6e3,onClose:()=>j({...x,open:!1}),children:e.jsx(X,{severity:x.severity,onClose:()=>j({...x,open:!1}),children:x.message})})]})},Ys=()=>{const t=Ct(),{getAllUsers:s,suspendUser:a,unsuspendUser:l,deleteUser:y,updateUserTokens:d,getUserRoles:x,assignRole:j,removeRole:h,getAllRoles:g}=Ve(),[S,A]=o.useState([]),[b,P]=o.useState(!1),[B,C]=o.useState({open:!1,message:"",severity:"success"}),[L,W]=o.useState(null),[n,p]=o.useState(null),[T,v]=o.useState(!1),[I,fe]=o.useState(""),[ye,N]=o.useState(!1),[F,D]=o.useState(!1),[je,K]=o.useState(0),[we,ce]=o.useState(!1),[ne,O]=o.useState([]),[H,ke]=o.useState([]);o.useEffect(()=>{E()},[]);const E=async()=>{P(!0);try{const i=await s(),k=await Promise.all(i.map(async de=>{const be=await x(de.id);return{...de,roles:be}}));A(k)}catch(i){C({open:!0,message:`Fehler beim Laden: ${i.message}`,severity:"error"})}finally{P(!1)}},r=(i,k)=>{W(i.currentTarget),p(k)},c=()=>{W(null)},R=async()=>{if(n){try{await a(n.id,I),C({open:!0,message:"Benutzer erfolgreich gesperrt",severity:"success"}),v(!1),fe(""),await E()}catch(i){C({open:!0,message:`Fehler: ${i.message}`,severity:"error"})}c()}},$=async()=>{if(n){try{await l(n.id),C({open:!0,message:"Sperrung erfolgreich aufgehoben",severity:"success"}),await E()}catch(i){C({open:!0,message:`Fehler: ${i.message}`,severity:"error"})}c()}},G=async()=>{if(n){try{await y(n.id),C({open:!0,message:"Benutzer erfolgreich gelöscht",severity:"success"}),N(!1),await E()}catch(i){C({open:!0,message:`Fehler: ${i.message}`,severity:"error"})}c()}},J=async()=>{if(n){try{await d(n.id,je),C({open:!0,message:"Token-Guthaben erfolgreich aktualisiert",severity:"success"}),D(!1),await E()}catch(i){C({open:!0,message:`Fehler: ${i.message}`,severity:"error"})}c()}},oe=i=>new Date(i).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return b&&S.length===0?e.jsx(w,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(rt,{})}):e.jsxs(w,{children:[e.jsxs(te,{children:[e.jsx(w,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:e.jsxs(u,{variant:"h6",sx:{fontWeight:600},children:["Benutzerverwaltung (",S.length," Benutzer)"]})}),e.jsx(it,{children:e.jsxs(ot,{children:[e.jsx(lt,{children:e.jsxs(ae,{children:[e.jsx(m,{children:"E-Mail"}),e.jsx(m,{children:"Name"}),e.jsx(m,{children:"Rollen"}),e.jsx(m,{children:"Registriert"}),e.jsx(m,{align:"center",children:"Status"}),e.jsx(m,{align:"center",children:"Tokens"}),e.jsx(m,{align:"center",children:"Items"}),e.jsx(m,{align:"center",children:"Nachrichten"}),e.jsx(m,{align:"center",children:"Aktionen"})]})}),e.jsx(at,{children:S.map(i=>e.jsxs(ae,{hover:!0,children:[e.jsxs(m,{children:[i.email,i.is_admin&&e.jsx(U,{label:"Super Admin",size:"small",color:"error",sx:{ml:1}})]}),e.jsx(m,{children:i.full_name||"-"}),e.jsx(m,{children:e.jsx(w,{display:"flex",gap:.5,flexWrap:"wrap",children:i.roles&&i.roles.length>0?i.roles.map(k=>e.jsx(U,{label:k.display_name,size:"small",variant:"outlined"},k.role_id)):e.jsx(u,{variant:"body2",color:"text.secondary",children:"-"})})}),e.jsx(m,{children:oe(i.created_at)}),e.jsx(m,{align:"center",children:i.is_suspended?e.jsx(_s,{title:i.suspended_reason||"Gesperrt",children:e.jsx(U,{label:"Gesperrt",size:"small",color:"error"})}):e.jsx(U,{label:"Aktiv",size:"small",color:"success"})}),e.jsx(m,{align:"center",children:i.token_balance}),e.jsx(m,{align:"center",children:e.jsx(U,{label:i.item_count,size:"small",variant:"outlined",onClick:()=>t(`/?seller=${i.id}`),sx:{cursor:"pointer"}})}),e.jsx(m,{align:"center",children:i.message_count}),e.jsx(m,{align:"center",children:e.jsx(St,{size:"small",onClick:k=>r(k,i),disabled:i.is_admin,children:e.jsx(Rt,{size:20})})})]},i.id))})]})})]}),e.jsxs(zt,{anchorEl:L,open:!!L,onClose:c,children:[e.jsxs(_,{onClick:async()=>{if(n){const i=await x(n.id),k=await g();O(i),ke(k),ce(!0)}},children:[e.jsx(nt,{size:18,style:{marginRight:8}}),"Rollen verwalten"]}),e.jsxs(_,{onClick:()=>{K((n==null?void 0:n.token_balance)||0),D(!0)},children:[e.jsx(rs,{size:18,style:{marginRight:8}}),"Tokens bearbeiten"]}),e.jsxs(_,{onClick:()=>n&&t(`/?seller=${n.id}`),children:[e.jsx(At,{size:18,style:{marginRight:8}}),"Items anzeigen"]}),n!=null&&n.is_suspended?e.jsxs(_,{onClick:$,children:[e.jsx(ns,{size:18,style:{marginRight:8}}),"Entsperren"]}):e.jsxs(_,{onClick:()=>v(!0),sx:{color:"warning.main"},children:[e.jsx(qs,{size:18,style:{marginRight:8}}),"Sperren"]}),e.jsxs(_,{onClick:()=>N(!0),sx:{color:"error.main"},children:[e.jsx(Mt,{size:18,style:{marginRight:8}}),"Löschen"]})]}),e.jsxs(Me,{open:T,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:"Benutzer sperren"}),e.jsxs(Be,{children:[e.jsx(X,{severity:"warning",sx:{mb:2},children:"Der Benutzer kann sich nicht mehr anmelden und keine Items erstellen oder bearbeiten."}),e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:n==null?void 0:n.email})]}),e.jsx(se,{label:"Grund für Sperrung",fullWidth:!0,multiline:!0,rows:3,value:I,onChange:i=>fe(i.target.value),placeholder:"Z.B.: Verstoß gegen Nutzungsbedingungen"})]}),e.jsxs($e,{children:[e.jsx(Q,{onClick:()=>v(!1),children:"Abbrechen"}),e.jsx(Q,{variant:"contained",color:"warning",onClick:R,disabled:!I.trim(),children:"Sperren"})]})]}),e.jsxs(Me,{open:ye,onClose:()=>N(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:"Benutzer löschen"}),e.jsxs(Be,{children:[e.jsx(X,{severity:"error",sx:{mb:2},children:"Diese Aktion kann nicht rückgängig gemacht werden! Alle Daten des Benutzers werden unwiderruflich gelöscht."}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Benutzer: ",e.jsx("strong",{children:n==null?void 0:n.email})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Items: ",e.jsx("strong",{children:n==null?void 0:n.item_count})]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:["Nachrichten: ",e.jsx("strong",{children:n==null?void 0:n.message_count})]})]}),e.jsxs($e,{children:[e.jsx(Q,{onClick:()=>N(!1),children:"Abbrechen"}),e.jsx(Q,{variant:"contained",color:"error",onClick:G,children:"Unwiderruflich löschen"})]})]}),e.jsxs(Me,{open:F,onClose:()=>D(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:"Token-Guthaben bearbeiten"}),e.jsxs(Be,{children:[e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:n==null?void 0:n.email})]}),e.jsx(se,{label:"Token-Guthaben",type:"number",fullWidth:!0,value:je,onChange:i=>K(parseInt(i.target.value)||0),inputProps:{min:0}})]}),e.jsxs($e,{children:[e.jsx(Q,{onClick:()=>D(!1),children:"Abbrechen"}),e.jsx(Q,{variant:"contained",onClick:J,children:"Speichern"})]})]}),e.jsxs(Me,{open:we,onClose:()=>ce(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:"Rollen verwalten"}),e.jsxs(Be,{children:[e.jsxs(u,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:n==null?void 0:n.email})]}),e.jsx(u,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Aktuelle Rollen:"}),e.jsx(w,{display:"flex",gap:1,flexWrap:"wrap",mb:2,children:ne.length>0?ne.map(i=>e.jsx(U,{label:i.display_name,onDelete:async()=>{if(n)try{await h(n.id,i.role_id);const k=await x(n.id);O(k),C({open:!0,message:"Rolle erfolgreich entfernt",severity:"success"}),await E()}catch(k){C({open:!0,message:`Fehler: ${k.message}`,severity:"error"})}}},i.role_id)):e.jsx(u,{variant:"body2",color:"text.secondary",children:"Keine Rollen zugewiesen"})}),e.jsx(u,{variant:"subtitle2",sx:{mt:3,mb:1},children:"Rolle hinzufügen:"}),e.jsx(w,{display:"flex",gap:1,flexWrap:"wrap",children:H.filter(i=>!ne.some(k=>k.role_id===i.role_id)).map(i=>e.jsx(U,{label:i.display_name,onClick:async()=>{if(n)try{await j(n.id,i.role_id);const k=await x(n.id);O(k),C({open:!0,message:"Rolle erfolgreich zugewiesen",severity:"success"}),await E()}catch(k){C({open:!0,message:`Fehler: ${k.message}`,severity:"error"})}},variant:"outlined",sx:{cursor:"pointer"}},i.role_id))})]}),e.jsx($e,{children:e.jsx(Q,{onClick:()=>ce(!1),children:"Schließen"})})]}),e.jsx(Ge,{open:B.open,autoHideDuration:6e3,onClose:()=>C({...B,open:!1}),children:e.jsx(X,{severity:B.severity,onClose:()=>C({...B,open:!1}),children:B.message})})]})},Js=()=>{const{getAllRoles:t}=Ve(),[s,a]=o.useState([]),[l,y]=o.useState(!1),[d,x]=o.useState({open:!1,message:"",severity:"success"});o.useEffect(()=>{j()},[]);const j=async()=>{y(!0);try{const g=await t();a(g)}catch(g){console.error("Error loading roles:",g),x({open:!0,message:"Fehler beim Laden der Rollen",severity:"error"})}finally{y(!1)}},h=g=>{switch(g){case"admin":return"error";case"moderator":return"warning";case"support":return"info";case"content_reviewer":return"success";default:return"default"}};return l?e.jsx(w,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(rt,{})}):e.jsxs(w,{children:[e.jsx(w,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:e.jsx(u,{variant:"h6",children:"Rollen & Berechtigungen"})}),e.jsx(ue,{container:!0,spacing:3,mb:4,children:s.map(g=>e.jsx(ue,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(De,{sx:{display:"flex",flexDirection:"column",height:"100%",p:3},children:[e.jsxs(w,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(nt,{size:24,style:{marginRight:8}}),e.jsx(u,{variant:"h6",component:"div",fontWeight:600,children:g.display_name})]}),e.jsx(u,{variant:"body2",color:"text.secondary",sx:{mb:"auto",minHeight:40,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:g.description}),e.jsxs(w,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{pt:2,mt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[e.jsx($t,{size:16}),e.jsx(u,{variant:"body2",fontWeight:500,children:g.user_count})]}),e.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Zs,{size:16}),e.jsx(u,{variant:"body2",fontWeight:500,children:g.permission_count})]})]})]})})},g.role_id))}),e.jsx(te,{children:e.jsx(it,{children:e.jsxs(ot,{children:[e.jsx(lt,{children:e.jsxs(ae,{children:[e.jsx(m,{children:"Rolle"}),e.jsx(m,{children:"Beschreibung"}),e.jsx(m,{align:"center",children:"Berechtigungen"}),e.jsx(m,{align:"center",children:"Benutzer"})]})}),e.jsx(at,{children:s.map(g=>e.jsxs(ae,{children:[e.jsx(m,{children:e.jsx(U,{label:g.display_name,color:h(g.role_name),size:"small"})}),e.jsx(m,{children:g.description}),e.jsx(m,{align:"center",children:g.permission_count}),e.jsx(m,{align:"center",children:g.user_count})]},g.role_id))})]})})}),e.jsxs(w,{mt:3,children:[e.jsxs(X,{severity:"info",sx:{mb:2},children:[e.jsx(u,{variant:"body2",fontWeight:600,mb:1,children:"Verfügbare Rollen und Berechtigungen:"}),e.jsxs(u,{variant:"body2",component:"div",sx:{mt:1},children:["• ",e.jsx("strong",{children:"Administrator:"})," Vollzugriff auf alle Systemfunktionen inkl. Rollenverwaltung",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Moderator:"})," Kann Inserate prüfen, freigeben, sperren und bearbeiten",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Support:"})," Kann Benutzerdaten einsehen und bei Problemen helfen",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Content Reviewer:"})," Kann Inhalte prüfen und freigeben"]})]}),e.jsxs(X,{severity:"success",children:[e.jsx(u,{variant:"body2",fontWeight:600,mb:1,children:"✓ Funktionen bereits aktiv:"}),e.jsxs(u,{variant:"body2",component:"div",children:["• Rollen können Benutzern über die Benutzerverwaltung zugewiesen werden",e.jsx("br",{}),"• Berechtigungen werden automatisch überprüft (items.view_all, items.edit_any, items.delete, etc.)",e.jsx("br",{}),"• Datenbank-Funktionen: approve_item(), reject_item(), feature_item() für Moderatoren",e.jsx("br",{}),"• RLS-Policies berücksichtigen Berechtigungen bei Items"]}),e.jsxs(u,{variant:"body2",component:"div",sx:{mt:2},children:[e.jsx("strong",{children:"Noch zu implementieren:"}),e.jsx("br",{}),"• UI-Integration für Moderatoren (Approve/Reject Buttons in der Item-Ansicht)",e.jsx("br",{}),"• Messages-Moderation UI",e.jsx("br",{}),"• Analytics-Dashboard für Support-Rolle"]})]})]}),e.jsx(Ge,{open:d.open,autoHideDuration:6e3,onClose:()=>x({...d,open:!1}),children:e.jsx(X,{severity:d.severity,onClose:()=>x({...d,open:!1}),children:d.message})})]})},er=()=>{const{user:t}=_t(),[s,a]=o.useState([]),[l,y]=o.useState([]),[d,x]=o.useState(!0),[j,h]=o.useState(!1),[g,S]=o.useState(null),[A,b]=o.useState({open:!1,message:"",severity:"success"}),[P,B]=o.useState(null),[C,L]=o.useState(null),[W,n]=o.useState("all"),[p,T]=o.useState(0),[v,I]=o.useState({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""});o.useEffect(()=>{N(),fe()},[]);const fe=async()=>{try{const c=await(await fetch("/TODO.md")).text();ye(c)}catch(r){console.error("Error loading TODO.md:",r)}},ye=r=>{const c=r.split(`
`),R=[];let $=null;for(let G=0;G<c.length;G++){const J=c[G],oe=J.match(/^## (.+)$/);if(oe){$&&R.push($);const i=oe[1].trim(),k=i.match(/^([^\w\s]+)\s+(.+)$/);$={title:k?k[2]:i,emoji:k?k[1]:"📋",items:[],notes:[]};continue}if($){const i=J.match(/^(\s*)- \[([ x])\] (.+)$/);if(i){const be=Math.floor(i[1].length/2);$.items.push({text:i[3],checked:i[2]==="x",indent:be});continue}const k=J.match(/\*\*Priorität:\*\*\s*(.+)$/);if(k){$.priority=k[1];continue}const de=J.match(/\*\*Geschätzter Aufwand:\*\*\s*(.+)$/);if(de){$.estimatedHours=de[1];continue}}}$&&R.push($),y(R.filter(G=>G.items.length>0))},N=async()=>{x(!0);try{const{data:r,error:c}=await M.from("admin_tasks").select("*").order("created_at",{ascending:!1});if(c)throw c;a(r||[])}catch(r){b({open:!0,message:`Fehler beim Laden: ${r.message}`,severity:"error"})}finally{x(!1)}},F=r=>{var c;r?(S(r),I({title:r.title,description:r.description||"",category:r.category,priority:r.priority,status:r.status,estimated_hours:((c=r.estimated_hours)==null?void 0:c.toString())||"",due_date:r.due_date?r.due_date.split("T")[0]:""})):(S(null),I({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""})),h(!0)},D=()=>{h(!1),S(null)},je=async()=>{if(!v.title.trim()){b({open:!0,message:"Bitte gib einen Titel ein",severity:"error"});return}try{const r={title:v.title.trim(),description:v.description.trim()||null,category:v.category,priority:v.priority,status:v.status,estimated_hours:v.estimated_hours?parseInt(v.estimated_hours):null,due_date:v.due_date||null};if(g){const{error:c}=await M.from("admin_tasks").update(r).eq("id",g.id);if(c)throw c;b({open:!0,message:"Task erfolgreich aktualisiert",severity:"success"})}else{const{error:c}=await M.from("admin_tasks").insert([{...r,created_by:t==null?void 0:t.id}]);if(c)throw c;b({open:!0,message:"Task erfolgreich erstellt",severity:"success"})}D(),N()}catch(r){b({open:!0,message:`Fehler: ${r.message}`,severity:"error"})}},K=async r=>{if(confirm("Möchtest du diese Aufgabe wirklich löschen?"))try{const{error:c}=await M.from("admin_tasks").delete().eq("id",r);if(c)throw c;b({open:!0,message:"Task erfolgreich gelöscht",severity:"success"}),N()}catch(c){b({open:!0,message:`Fehler: ${c.message}`,severity:"error"})}},we=async(r,c)=>{try{const{error:R}=await M.from("admin_tasks").update({status:c}).eq("id",r);if(R)throw R;N()}catch(R){b({open:!0,message:`Fehler: ${R.message}`,severity:"error"})}},ce=r=>({moderation:"Moderation",feature:"Feature",bug:"Bug",improvement:"Verbesserung",documentation:"Dokumentation",other:"Sonstiges"})[r]||r,ne=r=>({low:"default",medium:"info",high:"warning",urgent:"error"})[r]||"default",O=W==="all"?s:s.filter(r=>r.status===W),H={total:s.length,todo:s.filter(r=>r.status==="todo").length,in_progress:s.filter(r=>r.status==="in_progress").length,done:s.filter(r=>r.status==="done").length},ke=l.reduce((r,c)=>r+c.items.length,0),E=l.reduce((r,c)=>r+c.items.filter(R=>R.checked).length,0);return e.jsxs(w,{children:[e.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(u,{variant:"h6",sx:{fontWeight:600},children:"Task Management"}),e.jsx(Q,{variant:"contained",startIcon:e.jsx(gs,{size:20}),onClick:()=>F(),children:"Neue Aufgabe"})]}),e.jsx(te,{sx:{mb:3},children:e.jsxs(st,{value:p,onChange:(r,c)=>T(c),children:[e.jsx(Y,{label:`TODO-Liste (${E}/${ke})`}),e.jsx(Y,{label:`Datenbank Tasks (${H.total})`})]})}),p===0?e.jsx(w,{children:l.length===0?e.jsx(te,{sx:{p:4,textAlign:"center"},children:e.jsx(u,{variant:"body1",color:"text.secondary",children:"TODO.md wird geladen..."})}):e.jsx(w,{children:l.map((r,c)=>e.jsxs(ms,{defaultExpanded:c<3,children:[e.jsx(xs,{expandIcon:e.jsx(os,{size:20}),children:e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1.5,width:"100%"},children:[e.jsx(u,{sx:{fontSize:"1.5rem"},children:r.emoji}),e.jsxs(w,{sx:{flex:1},children:[e.jsx(u,{variant:"h6",fontWeight:600,children:r.title}),e.jsxs(w,{sx:{display:"flex",gap:2,mt:.5},children:[e.jsxs(u,{variant:"caption",color:"text.secondary",children:[r.items.filter(R=>R.checked).length," / ",r.items.length," erledigt"]}),r.priority&&e.jsx(U,{label:r.priority,size:"small",color:r.priority.toLowerCase().includes("high")||r.priority.toLowerCase().includes("urgent")?"error":r.priority.toLowerCase().includes("medium")?"warning":"default",sx:{height:20}}),r.estimatedHours&&e.jsx(U,{label:r.estimatedHours,size:"small",variant:"outlined",sx:{height:20}})]})]})]})}),e.jsx(fs,{children:e.jsx(as,{dense:!0,children:r.items.map((R,$)=>e.jsxs(is,{sx:{pl:2+R.indent*3,py:.5},children:[e.jsx(et,{sx:{minWidth:32},children:R.checked?e.jsx(ls,{size:18,color:"#4caf50"}):e.jsx(Vs,{size:18,color:"#9e9e9e"})}),e.jsx(tt,{primary:R.text,primaryTypographyProps:{sx:{textDecoration:R.checked?"line-through":"none",color:R.checked?"text.secondary":"text.primary",fontSize:"0.9rem"}}})]},$))})})]},c))})}):e.jsxs(w,{children:[e.jsxs(ue,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(ue,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{children:e.jsxs(De,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Gesamt"}),e.jsx(u,{variant:"h4",fontWeight:600,children:H.total})]})})}),e.jsx(ue,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{children:e.jsxs(De,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Offen"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"text.primary",children:H.todo})]})})}),e.jsx(ue,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{children:e.jsxs(De,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"In Arbeit"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"info.main",children:H.in_progress})]})})}),e.jsx(ue,{item:!0,xs:12,sm:6,md:3,children:e.jsx(Pe,{children:e.jsxs(De,{children:[e.jsx(u,{color:"text.secondary",variant:"body2",children:"Erledigt"}),e.jsx(u,{variant:"h4",fontWeight:600,color:"success.main",children:H.done})]})})})]}),e.jsx(te,{sx:{mb:3},children:e.jsxs(st,{value:W,onChange:(r,c)=>n(c),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(Y,{label:`Alle (${H.total})`,value:"all"}),e.jsx(Y,{label:`Offen (${H.todo})`,value:"todo"}),e.jsx(Y,{label:`In Arbeit (${H.in_progress})`,value:"in_progress"}),e.jsx(Y,{label:`Erledigt (${H.done})`,value:"done"})]})}),e.jsx(it,{component:te,children:e.jsxs(ot,{children:[e.jsx(lt,{children:e.jsxs(ae,{children:[e.jsx(m,{children:"Titel"}),e.jsx(m,{children:"Kategorie"}),e.jsx(m,{children:"Priorität"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Aufwand"}),e.jsx(m,{children:"Fällig am"}),e.jsx(m,{align:"right",children:"Aktionen"})]})}),e.jsx(at,{children:d?e.jsx(ae,{children:e.jsx(m,{colSpan:7,align:"center",children:"Lädt..."})}):O.length===0?e.jsx(ae,{children:e.jsx(m,{colSpan:7,align:"center",children:"Keine Aufgaben gefunden"})}):O.map(r=>e.jsxs(ae,{children:[e.jsx(m,{children:e.jsxs(w,{children:[e.jsx(u,{variant:"body2",fontWeight:600,children:r.title}),r.description&&e.jsxs(u,{variant:"caption",color:"text.secondary",children:[r.description.substring(0,60),r.description.length>60?"...":""]})]})}),e.jsx(m,{children:e.jsx(U,{label:ce(r.category),size:"small",variant:"outlined"})}),e.jsx(m,{children:e.jsx(U,{label:r.priority,size:"small",color:ne(r.priority)})}),e.jsx(m,{children:e.jsx(Re,{size:"small",sx:{minWidth:120},children:e.jsxs(ze,{value:r.status,onChange:c=>we(r.id,c.target.value),sx:{fontSize:"0.875rem"},children:[e.jsx(_,{value:"todo",children:"Offen"}),e.jsx(_,{value:"in_progress",children:"In Arbeit"}),e.jsx(_,{value:"done",children:"Erledigt"}),e.jsx(_,{value:"cancelled",children:"Abgebrochen"})]})})}),e.jsx(m,{children:r.estimated_hours?`${r.estimated_hours}h`:"-"}),e.jsx(m,{children:r.due_date?e.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ys,{size:14}),e.jsx(u,{variant:"body2",children:new Date(r.due_date).toLocaleDateString("de-DE")})]}):"-"}),e.jsx(m,{align:"right",children:e.jsx(St,{size:"small",onClick:c=>{B(c.currentTarget),L(r)},children:e.jsx(Rt,{size:18})})})]},r.id))})]})}),e.jsxs(zt,{anchorEl:P,open:!!P,onClose:()=>{B(null),L(null)},children:[e.jsxs(_,{onClick:()=>{C&&F(C),B(null)},children:[e.jsx(et,{children:e.jsx(At,{size:18})}),e.jsx(tt,{children:"Bearbeiten"})]}),e.jsxs(_,{onClick:()=>{C&&K(C.id),B(null),L(null)},children:[e.jsx(et,{children:e.jsx(Mt,{size:18})}),e.jsx(tt,{children:"Löschen"})]})]})]}),e.jsxs(Me,{open:j,onClose:D,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ae,{children:g?"Aufgabe bearbeiten":"Neue Aufgabe erstellen"}),e.jsx(Be,{children:e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(se,{label:"Titel",fullWidth:!0,required:!0,value:v.title,onChange:r=>I({...v,title:r.target.value})}),e.jsx(se,{label:"Beschreibung",fullWidth:!0,multiline:!0,rows:3,value:v.description,onChange:r=>I({...v,description:r.target.value})}),e.jsxs(Re,{fullWidth:!0,children:[e.jsx(Ke,{children:"Kategorie"}),e.jsxs(ze,{value:v.category,label:"Kategorie",onChange:r=>I({...v,category:r.target.value}),children:[e.jsx(_,{value:"moderation",children:"Moderation"}),e.jsx(_,{value:"feature",children:"Feature"}),e.jsx(_,{value:"bug",children:"Bug"}),e.jsx(_,{value:"improvement",children:"Verbesserung"}),e.jsx(_,{value:"documentation",children:"Dokumentation"}),e.jsx(_,{value:"other",children:"Sonstiges"})]})]}),e.jsxs(Re,{fullWidth:!0,children:[e.jsx(Ke,{children:"Priorität"}),e.jsxs(ze,{value:v.priority,label:"Priorität",onChange:r=>I({...v,priority:r.target.value}),children:[e.jsx(_,{value:"low",children:"Niedrig"}),e.jsx(_,{value:"medium",children:"Mittel"}),e.jsx(_,{value:"high",children:"Hoch"}),e.jsx(_,{value:"urgent",children:"Dringend"})]})]}),e.jsxs(Re,{fullWidth:!0,children:[e.jsx(Ke,{children:"Status"}),e.jsxs(ze,{value:v.status,label:"Status",onChange:r=>I({...v,status:r.target.value}),children:[e.jsx(_,{value:"todo",children:"Offen"}),e.jsx(_,{value:"in_progress",children:"In Arbeit"}),e.jsx(_,{value:"done",children:"Erledigt"}),e.jsx(_,{value:"cancelled",children:"Abgebrochen"})]})]}),e.jsx(se,{label:"Geschätzter Aufwand (Stunden)",type:"number",fullWidth:!0,value:v.estimated_hours,onChange:r=>I({...v,estimated_hours:r.target.value})}),e.jsx(se,{label:"Fällig am",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:v.due_date,onChange:r=>I({...v,due_date:r.target.value})})]})}),e.jsxs($e,{children:[e.jsx(Q,{onClick:D,children:"Abbrechen"}),e.jsx(Q,{onClick:je,variant:"contained",children:g?"Speichern":"Erstellen"})]})]}),e.jsx(Ge,{open:A.open,autoHideDuration:6e3,onClose:()=>b({...A,open:!1}),children:e.jsx(X,{severity:A.severity,onClose:()=>b({...A,open:!1}),children:A.message})})]})},tr=()=>{const t=Ct(),{isAdmin:s,loading:a}=Ve(),[l,y]=o.useState(0);return o.useEffect(()=>{!a&&!s&&t("/")},[s,a,t]),a?e.jsx(w,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(rt,{})}):s?e.jsxs(w,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(cs,{onNavigate:d=>{d==="items"?t("/"):d==="messages"?t("/messages"):d==="settings"&&t("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsx(w,{sx:{flex:1},children:e.jsxs(ds,{maxWidth:"lg",sx:{py:4},children:[e.jsx(u,{variant:"h4",sx:{mb:3,fontWeight:600},children:"Admin-Bereich"}),e.jsx(te,{sx:{mb:3},children:e.jsxs(st,{value:l,onChange:(d,x)=>y(x),sx:{borderBottom:1,borderColor:"divider"},variant:"scrollable",scrollButtons:"auto",children:[e.jsx(Y,{icon:e.jsx(ps,{size:20}),label:"System-Einstellungen",iconPosition:"start",sx:{textTransform:"none",minHeight:56}}),e.jsx(Y,{icon:e.jsx($t,{size:20}),label:"Benutzerverwaltung",iconPosition:"start",sx:{textTransform:"none",minHeight:56}}),e.jsx(Y,{icon:e.jsx(nt,{size:20}),label:"Rollen & Berechtigungen",iconPosition:"start",sx:{textTransform:"none",minHeight:56}}),e.jsx(Y,{icon:e.jsx(Qs,{size:20}),label:"Aufgaben",iconPosition:"start",sx:{textTransform:"none",minHeight:56}})]})}),l===0&&e.jsx(Xs,{}),l===1&&e.jsx(Ys,{}),l===2&&e.jsx(Js,{}),l===3&&e.jsx(er,{})]})}),e.jsx(us,{})]}):null},dr=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"}));export{tr as A,_s as T,it as a,ot as b,lt as c,ae as d,m as e,at as f,dr as g,Ve as u};
