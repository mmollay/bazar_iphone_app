import{x,r as A,j as r,B as h,T as i,H as C,f as O}from"./index-hJjOI5Y2.js";const R=()=>{const a=x(),[u,t]=A.useState(null);if(A.useEffect(()=>{(async()=>{try{const e=window.location.href,o=new URLSearchParams(window.location.search),f=o.get("platform")==="ios";if(console.log("[OAuth Callback] Processing URL:",e),console.log("[OAuth Callback] Platform:",f?"Native iOS (from URL param)":"Web"),console.log("[OAuth Callback] All URL parameters:"),o.forEach((n,s)=>{console.log(`  - ${s}: ${n}`)}),f){console.log("[OAuth Callback] Native iOS request detected!"),console.log("[OAuth Callback] ✅ Universal Links will open the app automatically!"),console.log("[OAuth Callback] Current URL:",window.location.href);const n=o.get("error"),s=o.get("error_description");if(n){console.error("[OAuth Callback] OAuth Error:",n),console.error("[OAuth Callback] Error Description:",s),t(`OAuth Fehler: ${s||n}`);return}const c=window.location.hash.substring(1);if(console.log("[OAuth Callback] URL Fragment present:",!!c),!c){console.error("[OAuth Callback] No fragment found in URL"),console.error("[OAuth Callback] Full URL:",window.location.href),t("Keine Authentifizierungsdaten gefunden.");return}const m=new URLSearchParams(c),b=m.get("access_token"),p=m.get("refresh_token");if(console.log("[OAuth Callback] Access token present:",!!b),console.log("[OAuth Callback] Refresh token present:",!!p),!b||!p){console.error("[OAuth Callback] Missing tokens in fragment"),t("Authentifizierungsdaten unvollständig.");return}console.log("[OAuth Callback] ✅ Tokens verified! Redirecting to app...");const k=`habdawas://auth/callback#${c}`;console.log("[OAuth Callback] Redirecting to:",k),setTimeout(()=>{window.location.href=k},100);return}console.log("[OAuth Callback] Web platform - exchanging code for session...");const{error:d}=await O.auth.exchangeCodeForSession(e);if(d){console.error("[OAuth Callback] Exchange error:",d),t("Anmeldung fehlgeschlagen. Bitte versuche es erneut."),setTimeout(()=>a("/"),3e3);return}console.log("[OAuth Callback] Success! Redirecting to home..."),a("/",{replace:!0})}catch(e){console.error("[OAuth Callback] Error:",e),t("Ein Fehler ist aufgetreten. Du wirst weitergeleitet..."),setTimeout(()=>a("/"),3e3)}})()},[a]),u){const g=new URLSearchParams(window.location.search),e=[];return g.forEach((o,l)=>{e.push(`${l}: ${o}`)}),r.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[r.jsx(i,{variant:"h6",color:"error",children:u}),e.length>0&&r.jsxs(h,{sx:{mt:2,p:2,bgcolor:"#f5f5f5",borderRadius:1,width:"100%",maxWidth:500},children:[r.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Debug Info:"}),e.map((o,l)=>r.jsx(i,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.8rem"},children:o},l))]})]})}return r.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[r.jsx(C,{size:60}),r.jsx(i,{variant:"h6",children:"Anmeldung wird verarbeitet..."})]})};export{R as OAuthCallbackPage};
