import{e as G,n as k,r as f,f as M,x as V,aH as Y,Z as C,aO as Q,j as e,B as t,aP as X,R as H,l as z,T as s,aN as ee,A as re,aQ as te,aR as D,ay as W,aj as se,H as I,aF as oe,t as ie,aC as E,aS as ne,K as B,C as ae}from"./index-BSUU9nrj.js";import{u as le,f as i,A as de,a as S}from"./formatNumber-_rJIlwWT.js";import{S as ce}from"./Snackbar-DAEujyml.js";import{A as xe}from"./arrow-left-DEc7V5ES.js";import{Z as U}from"./zap-YQG6yVnS.js";import{S as F}from"./sparkles-DWbAhNz0.js";import{S as he}from"./shopping-cart-t84iTnfV.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=G("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),ue=()=>{const{user:l}=k(),[P,b]=f.useState({personalCredits:0,communityPotBalance:0,loading:!0,lastUpdated:null}),o=async()=>{try{b(x=>({...x,loading:!0}));let d=0;if(l){const{data:x,error:R}=await M.from("profiles").select("personal_credits").eq("id",l.id).single();!R&&x&&(d=x.personal_credits||0)}const{data:c,error:v}=await M.from("credit_system_settings").select("setting_value").eq("setting_key","community_pot_balance").single(),T=v?0:parseInt(c.setting_value||"0");b({personalCredits:d,communityPotBalance:T,loading:!1,lastUpdated:new Date})}catch(d){console.error("Error fetching credits stats:",d),b(c=>({...c,loading:!1}))}};return f.useEffect(()=>{o();const d=setInterval(o,12e4);return()=>clearInterval(d)},[l==null?void 0:l.id]),P},ve=()=>{const l=V(),[P]=Y(),{user:b}=k(),{settings:o,loading:d}=le(),c=ue(),[v,T]=f.useState(0),[x,R]=f.useState(null),[g,_]=f.useState(10),[p,L]=f.useState(!1),[$,m]=f.useState(null),[O,Z]=f.useState(P.get("canceled")==="true"),n=r=>o?Math.floor(r/o.powerUserCreditPrice):0,j=r=>o?Math.floor(r/o.costPerListing):0,N=o?[{id:"STARTER",credits:n(5),price:5,bonus:0,features:[`${i(n(5))} Personal Credits`,`~${i(n(5))} Inserate erstellen`,"Keine monatlichen Limits","Credits verfallen nicht"]},{id:"POPULAR",credits:n(10),price:10,bonus:Math.floor(n(10)*.1),popular:!0,features:[`${i(n(10))} Personal Credits + ${i(Math.floor(n(10)*.1))} Bonus`,`~${i(n(10)+Math.floor(n(10)*.1))} Inserate erstellen`,"10% Bonus Credits","Keine monatlichen Limits","Credits verfallen nicht"]},{id:"PRO",credits:n(20),price:20,bonus:Math.floor(n(20)*.15),bestValue:!0,features:[`${i(n(20))} Personal Credits + ${i(Math.floor(n(20)*.15))} Bonus`,`~${i(n(20)+Math.floor(n(20)*.15))} Inserate erstellen`,"15% Bonus Credits","Beste Preis-Leistung","Keine monatlichen Limits","Credits verfallen nicht"]}]:[],K=o?[{id:"SUPPORTER",amount:5,impact:`~${i(j(5))} kostenlose Inserate`,icon:C,color:"#e91e63"},{id:"CONTRIBUTOR",amount:10,impact:`~${i(j(10))} kostenlose Inserate`,icon:Q,color:"#9c27b0",popular:!0},{id:"CHAMPION",amount:25,impact:`~${i(j(25))} kostenlose Inserate`,icon:de,color:"#ff9800"}]:[],A=async(r,h)=>{if(!b){m("Bitte melde dich an, um fortzufahren.");return}R(r),L(!0),m(null);try{const{data:{session:a}}=await M.auth.getSession(),u=a==null?void 0:a.access_token;if(!u){m("Bitte melde dich an, um fortzufahren.");return}const w=await fetch("https://hsbjflixgavjqxvnkivi.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({packageId:r.toLowerCase(),type:h,amount:h==="community"?g:void 0})}),y=await w.json();if(!w.ok){y.needsConfig?m("Zahlungssystem ist noch nicht konfiguriert. Bitte kontaktiere den Administrator."):m(y.error||"Fehler beim Erstellen der Checkout-Session");return}y.url?window.location.href=y.url:m("Keine Checkout-URL erhalten")}catch(a){console.error("Error creating checkout session:",a),m(a instanceof Error?a.message:"Ein Fehler ist aufgetreten")}finally{L(!1)}},J=r=>{const h=r.credits+r.bonus,a=(r.price/h).toFixed(2),u=r.popular||r.bestValue;return e.jsxs(W,{sx:{position:"relative",border:u?"2px solid":"1px solid",borderColor:u?"primary.main":"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",display:"flex",flexDirection:"column",boxShadow:u?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[u&&e.jsx(B,{icon:r.popular?e.jsx(F,{size:14}):e.jsx(me,{size:14}),label:r.popular?"Beliebt":"Beste Wahl",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.popular?"primary.main":"#ff9800",color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(t,{sx:{p:3,display:"flex",flexDirection:"column",flexGrow:1},children:[e.jsx(s,{variant:"overline",sx:{fontWeight:700,fontSize:"0.8rem",color:"primary.main",letterSpacing:"0.12em",lineHeight:1,mb:2},children:r.id}),e.jsxs(t,{sx:{mb:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[e.jsx(s,{variant:"h2",sx:{fontWeight:800,fontSize:{xs:"2.5rem",sm:"3rem"},lineHeight:1,color:"text.primary"},children:h}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{fontWeight:600},children:"Credits"})]}),r.bonus>0&&e.jsx(B,{label:`+${r.bonus} Bonus`,size:"small",sx:{mt:1,bgcolor:"success.light",color:"success.dark",fontWeight:700}})]}),e.jsx(t,{sx:{display:"flex",alignItems:"baseline",gap:.5,mb:1,py:2,borderTop:"1px solid",borderBottom:"1px solid",borderColor:"divider"},children:e.jsx(s,{variant:"h3",sx:{fontWeight:800,fontSize:{xs:"2rem",sm:"2.25rem"},lineHeight:1,color:"text.primary"},children:S(r.price)})}),e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{mb:3},children:[S(parseFloat(a))," pro Credit"]}),e.jsx(t,{sx:{mb:3,flexGrow:1},children:r.features.map((w,y)=>e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:1.5,py:.75},children:[e.jsx(ae,{size:18,style:{color:"#4caf50",flexShrink:0,marginTop:"2px"}}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem",lineHeight:1.6},children:w})]},y))}),e.jsx(z,{fullWidth:!0,variant:u?"contained":"outlined",size:"large",startIcon:p&&x===r.id?e.jsx(I,{size:18,color:"inherit"}):e.jsx(he,{size:18}),onClick:()=>A(r.id,"personal"),disabled:p||d,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",mt:"auto",borderRadius:2},children:p&&x===r.id?"Laden...":"Credits kaufen"})]})]},r.id)},q=r=>{const h=r.icon,a=j(r.amount);return e.jsxs(W,{sx:{position:"relative",border:r.popular?"2px solid":"1px solid",borderColor:r.popular?r.color:"divider",borderRadius:3,bgcolor:"white",overflow:"visible",transition:"all 0.3s ease",boxShadow:r.popular?3:0,"&:hover":{transform:"translateY(-4px)",boxShadow:6}},children:[r.popular&&e.jsx(B,{icon:e.jsx(F,{size:14}),label:"Beliebt",size:"small",sx:{position:"absolute",top:-12,right:20,bgcolor:r.color,color:"white",fontWeight:700,fontSize:"0.75rem",height:26,px:1,"& .MuiChip-icon":{color:"white"},boxShadow:2}}),e.jsxs(t,{sx:{p:3,display:"flex",flexDirection:"column"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(t,{sx:{width:48,height:48,borderRadius:2,bgcolor:`${r.color}15`,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{size:24,style:{color:r.color}})}),e.jsx(s,{variant:"h6",sx:{fontWeight:700,color:"text.primary"},children:r.id})]}),e.jsxs(t,{sx:{mb:2},children:[e.jsx(t,{sx:{display:"flex",alignItems:"baseline",gap:1},children:e.jsx(s,{variant:"h3",sx:{fontWeight:800,fontSize:"2.5rem",lineHeight:1,color:"text.primary"},children:S(r.amount)})}),e.jsxs(s,{variant:"body2",sx:{color:r.color,fontWeight:600,mt:1},children:["= ",i(a)," kostenlose Inserate"]})]}),e.jsxs(t,{sx:{bgcolor:`${r.color}10`,borderRadius:2,p:2,mb:3,border:"1px solid",borderColor:`${r.color}30`},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:600,color:"text.primary",mb:.5},children:"Impact:"}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[r.impact," für die Community"]})]}),e.jsx(z,{fullWidth:!0,variant:"contained",size:"large",startIcon:p&&x===r.id?e.jsx(I,{size:18,color:"inherit"}):e.jsx(C,{size:18}),onClick:()=>A(r.id,"community"),disabled:p||d,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:r.color,"&:hover":{bgcolor:r.color,filter:"brightness(0.9)"}},children:p&&x===r.id?"Laden...":"Jetzt spenden"})]})]},r.id)};return e.jsxs(t,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(X,{onNavigate:r=>{r==="items"?l("/"):r==="messages"?l("/messages"):r==="settings"&&l("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsxs(t,{sx:{flex:1,bgcolor:"#fafafa"},children:[e.jsx(ce,{open:O,autoHideDuration:6e3,onClose:()=>Z(!1),message:"Zahlung abgebrochen"}),e.jsx(t,{sx:{bgcolor:"white",borderBottom:"1px solid",borderColor:"divider",py:2},children:e.jsx(H,{maxWidth:"lg",children:e.jsx(z,{startIcon:e.jsx(xe,{size:18}),onClick:()=>l(-1),sx:{textTransform:"none",fontWeight:500,color:"text.secondary"},children:"Zurück"})})}),e.jsxs(H,{maxWidth:"lg",sx:{py:6},children:[e.jsxs(t,{sx:{mb:5,textAlign:"center"},children:[e.jsx(s,{variant:"h3",sx:{fontWeight:800,mb:2,color:"text.primary",fontSize:{xs:"2rem",sm:"2.5rem",md:"3rem"}},children:"Credits & Spenden"}),e.jsxs(s,{variant:"h6",color:"text.secondary",sx:{mb:3,maxWidth:800,mx:"auto",fontWeight:400,lineHeight:1.7},children:["Jeden Monat erhältst du"," ",e.jsxs("strong",{children:[i((o==null?void 0:o.dailyFreeListings)||5)," kostenlose Inserate"]}),"!",e.jsx("br",{}),"Power-User können Credits kaufen • Die Community mit Spenden unterstützen"]}),e.jsxs(ee,{direction:{xs:"column",sm:"row"},spacing:2,sx:{maxWidth:900,mx:"auto",mb:4},children:[e.jsxs(t,{sx:{flex:1,p:2,borderRadius:2,bgcolor:"rgba(25, 118, 210, 0.08)",border:"1px solid rgba(25, 118, 210, 0.2)"},children:[e.jsx(U,{size:24,style:{color:"#1976d2",marginBottom:8}}),e.jsx(s,{variant:"body2",sx:{fontWeight:600,color:"primary.main"},children:"Personal Credits"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Für Power-User mit vielen Inseraten"})]}),e.jsxs(t,{sx:{flex:1,p:2,borderRadius:2,bgcolor:"rgba(233, 30, 99, 0.08)",border:"1px solid rgba(233, 30, 99, 0.2)"},children:[e.jsx(C,{size:24,style:{color:"#e91e63",marginBottom:8}}),e.jsx(s,{variant:"body2",sx:{fontWeight:600,color:"#e91e63"},children:"Community Spenden"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Ermöglicht kostenlosen Zugang für alle"})]})]})]}),$&&e.jsx(re,{severity:"error",onClose:()=>m(null),sx:{mb:4,maxWidth:900,mx:"auto"},children:$}),e.jsx(t,{sx:{mb:4},children:e.jsxs(te,{value:v,onChange:(r,h)=>T(h),centered:!0,sx:{"& .MuiTabs-indicator":{height:3,borderRadius:1.5}},children:[e.jsx(D,{label:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(U,{size:18}),e.jsx("span",{children:"Personal Credits"})]}),sx:{textTransform:"none",fontWeight:700,fontSize:"1rem"}}),e.jsx(D,{label:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(C,{size:18}),e.jsx("span",{children:"Community Spenden"})]}),sx:{textTransform:"none",fontWeight:700,fontSize:"1rem"}})]})}),e.jsxs(t,{sx:{mb:4,maxWidth:800,mx:"auto",display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2},children:[b&&e.jsxs(W,{sx:{flex:1,p:2,bgcolor:"rgba(25, 118, 210, 0.05)",border:"1px solid rgba(25, 118, 210, 0.2)",borderRadius:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{width:40,height:40,borderRadius:1.5,bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(se,{size:20,style:{color:"white"}})}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Meine Credits"}),e.jsx(s,{variant:"h6",sx:{fontWeight:700,color:"primary.main",lineHeight:1.2},children:c.loading?e.jsx(I,{size:16}):i(c.personalCredits)})]})]}),e.jsxs(W,{sx:{flex:1,p:2,bgcolor:"rgba(233, 30, 99, 0.05)",border:"1px solid rgba(233, 30, 99, 0.2)",borderRadius:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(t,{sx:{width:40,height:40,borderRadius:1.5,bgcolor:"#e91e63",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(oe,{size:20,style:{color:"white"}})}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Community-Topf"}),e.jsx(s,{variant:"h6",sx:{fontWeight:700,color:"#e91e63",lineHeight:1.2},children:c.loading?e.jsx(I,{size:16}):`${i(c.communityPotBalance)} Inserate`})]}),c.lastUpdated&&e.jsx(s,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.65rem",ml:"auto"},children:"↻"})]})]}),v===0&&e.jsxs(t,{children:[e.jsxs(t,{sx:{textAlign:"center",mb:4},children:[e.jsx(s,{variant:"h5",sx:{fontWeight:700,mb:1},children:"Personal Credits kaufen"}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto"},children:["Für Power-User, die mehr als ",i((o==null?void 0:o.dailyFreeListings)||5)," Inserate pro Monat benötigen. Credits verfallen nicht und können jederzeit verwendet werden."]})]}),e.jsx(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto"},children:N.map(J)}),e.jsx(t,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(25, 118, 210, 0.05)",border:"1px solid rgba(25, 118, 210, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["💡 ",e.jsx("strong",{children:"Tipp:"})," Credits verfallen nicht und können flexibel verwendet werden. Größere Pakete enthalten Bonus-Credits!"]})})]}),v===1&&e.jsxs(t,{children:[e.jsxs(t,{sx:{textAlign:"center",mb:4},children:[e.jsxs(s,{variant:"h5",sx:{fontWeight:700,mb:1,display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(C,{size:22,style:{color:"#e91e63"}}),"Community unterstützen"]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{maxWidth:700,mx:"auto",mb:2},children:"Mit deiner Spende ermöglichst du kostenlosen Zugang für alle! Deine Spende füllt den Community-Topf und ermöglicht kostenlose Inserate für die Allgemeinheit."}),e.jsx(s,{variant:"body2",sx:{fontWeight:600,color:"#e91e63"},children:"🏆 Top-Spender werden in unserer Hall of Fame geehrt!"})]}),e.jsx(t,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(3, 1fr)"},gap:3,maxWidth:1200,mx:"auto",mb:4},children:K.map(q)}),e.jsxs(t,{sx:{maxWidth:600,mx:"auto",p:4,borderRadius:3,bgcolor:"white",border:"2px dashed",borderColor:"divider"},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:700,mb:2,textAlign:"center"},children:"Eigener Betrag"}),e.jsx(ie,{fullWidth:!0,type:"number",value:g,onChange:r=>_(parseFloat(r.target.value)||0),InputProps:{startAdornment:e.jsx(E,{position:"start",children:"€"}),endAdornment:e.jsx(E,{position:"end",children:e.jsxs(s,{variant:"caption",color:"text.secondary",children:["= ",i(j(g))," Inserate"]})})},inputProps:{min:(o==null?void 0:o.minDonationAmount)||5,step:1},sx:{mb:2}}),e.jsxs(z,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(C,{size:18}),onClick:()=>A("CUSTOM","community"),disabled:p||g<((o==null?void 0:o.minDonationAmount)||5)||d,sx:{textTransform:"none",fontWeight:700,py:1.75,fontSize:"1rem",borderRadius:2,bgcolor:"#e91e63","&:hover":{bgcolor:"#c2185b"}},children:[S(g)," spenden"]}),g<((o==null?void 0:o.minDonationAmount)||5)&&e.jsxs(s,{variant:"caption",color:"error",sx:{mt:1,display:"block",textAlign:"center"},children:["Mindestbetrag: ",S((o==null?void 0:o.minDonationAmount)||5)]})]}),e.jsx(t,{sx:{mt:4,p:3,borderRadius:2,bgcolor:"rgba(233, 30, 99, 0.05)",border:"1px solid rgba(233, 30, 99, 0.1)",maxWidth:900,mx:"auto"},children:e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{textAlign:"center"},children:["🌟 ",e.jsx("strong",{children:"So funktioniert's:"})," Jeder gespendete Euro wird 1:1 in kostenlose Inserate umgewandelt. Mit 10€ ermöglichst du ",i(j(10))," kostenlose Inserate für die Community!"]})})]})]})]}),e.jsx(ne,{})]})};export{ve as CreditPurchasePage};
