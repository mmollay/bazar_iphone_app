import{x as A,r as x,j as o,B as h,T as i,H as C,f as O}from"./index-BHBqG9s9.js";const R=()=>{const a=A(),[u,t]=x.useState(null);if(x.useEffect(()=>{(async()=>{try{const e=window.location.href,r=new URLSearchParams(window.location.search),f=r.get("platform")==="ios";if(console.log("[OAuth Callback] Processing URL:",e),console.log("[OAuth Callback] Platform:",f?"Native iOS (from URL param)":"Web"),console.log("[OAuth Callback] All URL parameters:"),r.forEach((n,l)=>{console.log(`  - ${l}: ${n}`)}),f){console.log("[OAuth Callback] Native iOS request detected - storing tokens...");const n=r.get("error"),l=r.get("error_description");if(n){console.error("[OAuth Callback] OAuth Error:",n),console.error("[OAuth Callback] Error Description:",l),t(`OAuth Fehler: ${l||n}`);return}const c=window.location.hash.substring(1);if(console.log("[OAuth Callback] URL Fragment:",c),!c){console.error("[OAuth Callback] No fragment found in URL"),console.error("[OAuth Callback] Full URL:",window.location.href),t("Keine Authentifizierungsdaten gefunden.");return}const m=new URLSearchParams(c),b=m.get("access_token"),p=m.get("refresh_token");if(console.log("[OAuth Callback] Access token present:",!!b),console.log("[OAuth Callback] Refresh token present:",!!p),!b||!p){console.error("[OAuth Callback] Missing tokens in fragment"),t("Authentifizierungsdaten unvollstÃ¤ndig.");return}const k=`habdawas://auth/callback#${c}`;console.log("[OAuth Callback] Redirecting to app:",k),setTimeout(()=>{window.location.href=k},100);return}console.log("[OAuth Callback] Web platform - exchanging code for session...");const{error:d}=await O.auth.exchangeCodeForSession(e);if(d){console.error("[OAuth Callback] Exchange error:",d),t("Anmeldung fehlgeschlagen. Bitte versuche es erneut."),setTimeout(()=>a("/"),3e3);return}console.log("[OAuth Callback] Success! Redirecting to home..."),a("/",{replace:!0})}catch(e){console.error("[OAuth Callback] Error:",e),t("Ein Fehler ist aufgetreten. Du wirst weitergeleitet..."),setTimeout(()=>a("/"),3e3)}})()},[a]),u){const g=new URLSearchParams(window.location.search),e=[];return g.forEach((r,s)=>{e.push(`${s}: ${r}`)}),o.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[o.jsx(i,{variant:"h6",color:"error",children:u}),e.length>0&&o.jsxs(h,{sx:{mt:2,p:2,bgcolor:"#f5f5f5",borderRadius:1,width:"100%",maxWidth:500},children:[o.jsx(i,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Debug Info:"}),e.map((r,s)=>o.jsx(i,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.8rem"},children:r},s))]})]})}return o.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[o.jsx(C,{size:60}),o.jsx(i,{variant:"h6",children:"Anmeldung wird verarbeitet..."})]})};export{R as OAuthCallbackPage};
