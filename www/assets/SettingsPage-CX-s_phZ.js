import{e as ze,x as Ne,j as e,P as H,B as s,w as le,aq as Ue,ar as Ze,N as be,O as je,av as qe,U as $e,ak as Se,$ as pe,a4 as He,aw as ye,S as _e,ax as Ce,t as D,h as ne,i as te,r as d,T as n,y as Je,H as Q,at as Ye,M as Qe,L as A,an as Xe,Y as es,K as Y,o as ve,l as U,A as q,ay as ss,f as K,az as ue,aA as Pe,Q as ce,a5 as T,ab as F,aB as ns,aC as ts,aD as is,aE as Te,W as rs,am as as,ae as we,af as ls,aF as os,aG as cs,n as Oe,aj as ds,_ as Ie,ah as Ee,ai as Be,a6 as hs,aH as xs,ad as us,aI as ps,aJ as gs,R as Ve,aK as ms,aL as fs,C as De,aM as bs}from"./index-kFPCxDRP.js";import{u as js,G as V,T as ys,M as _s,A as vs}from"./AdminPage-DPzygk0q.js";import{C as ws,a as ks}from"./chevron-right-C5Yo7UpY.js";import{L as ke,U as zs}from"./user-check-RH0y9sWK.js";import{A as Ss}from"./alert-circle-B4U78Sn6.js";import{M as Cs,A as As}from"./Modal-DijUbzpr.js";import{searchCitiesByPostalCode as Ws}from"./postalCodeLookup-Bx0v-AE9.js";import{P as Ps}from"./plus-BjnUYxU5.js";import{R as Ge,a as de}from"./RadioGroup-ClnBJre2.js";import{u as Ts}from"./useTokens-BWraYwIJ.js";import{f as Me}from"./useSystemSettings-DRyNq9BN.js";import{S as Ke}from"./shopping-cart-CHEGBgJ4.js";import{G as Is}from"./gift-DYT4blHw.js";import"./credit-card-B1cngNg0.js";import"./Snackbar-ojQY2fo9.js";import"./AccordionSummary-B1G0oEVo.js";import"./Collapse-DFeOGY6k.js";import"./calendar-nw68jU7U.js";import"./dollar-sign-BXZP7t6V.js";import"./save-Vqc6iNuh.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=ze("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=ze("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=ze("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Re=({currentSection:t,onSectionChange:o,collapsed:p,onToggleCollapse:m,isMobile:u=!1})=>{const{isAdmin:b}=js(),c=Ne(),B=[{id:"profile",label:"Persönliche Daten",icon:e.jsx($e,{size:20})},{id:"security",label:"Sicherheit",icon:e.jsx(ke,{size:20})},{id:"tokens",label:"Mein Guthaben",icon:e.jsx(Se,{size:20})},{id:"addresses",label:"Adressen",icon:e.jsx(pe,{size:20})},{id:"shipping",label:"Versand & Abholung",icon:e.jsx(He,{size:20})},{id:"display",label:"Anzeige",icon:e.jsx(ye,{size:20})},{id:"ai",label:"KI-Assistent",icon:e.jsx(_e,{size:20})},{id:"notifications",label:"Benachrichtigungen",icon:e.jsx(Es,{size:20})}];return b&&B.push({id:"admin",label:"Administration",icon:e.jsx(Ce,{size:20})}),e.jsxs(H,{elevation:0,sx:{width:u?"100%":p?72:260,transition:"width 0.3s ease",height:u?"100%":"100vh",borderRight:u?0:1,borderColor:"divider",borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",position:u?"relative":"sticky",top:0,left:0},children:[!u&&e.jsx(s,{sx:{display:"flex",justifyContent:p?"center":"flex-end",p:1.5,borderBottom:1,borderColor:"divider"},children:e.jsx(le,{onClick:m,size:"small",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:p?e.jsx(ws,{size:18}):e.jsx(ks,{size:18})})}),e.jsx(Ue,{sx:{pt:2,pb:2},children:B.map(_=>{const j=e.jsxs(Ze,{onClick:()=>{_.id==="admin"?c("/admin"):o(_.id)},selected:t===_.id,sx:{mb:.5,mx:p&&!u?1:1.5,borderRadius:2,minHeight:48,justifyContent:p&&!u?"center":"flex-start",px:p&&!u?0:2,"&.Mui-selected":{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"& .MuiListItemIcon-root":{color:"white"}},"&:hover":{bgcolor:p&&!u?"action.hover":"action.selected"}},children:[e.jsx(be,{sx:{minWidth:p&&!u?"auto":40,justifyContent:"center",color:t===_.id?"inherit":"text.secondary"},children:_.icon}),(!p||u)&&e.jsx(je,{primary:_.label,primaryTypographyProps:{fontWeight:t===_.id?600:400,fontSize:"0.95rem"}})]},_.id);return u?j:e.jsx(qe,{title:p?_.label:"",placement:"right",arrow:!0,children:j},_.id)})})]})},xe=({fieldName:t,savedField:o,saveTimestamp:p,autoSaveStatus:m,showCheckmark:u,...b})=>e.jsx(D,{...b}),Vs=({profile:t,formData:o,onFormChange:p,userId:m,onProfileUpdate:u})=>{var J,P;const b=ne(),c=te(b.breakpoints.down("md")),[B,_]=d.useState(!1),[j,I]=d.useState(!1),[w,M]=d.useState("idle"),[i,z]=d.useState(""),[v,W]=d.useState(null),[L,O]=d.useState(null),a=d.useRef(null),[l,h]=d.useState(!1),[y,k]=d.useState(null),r=g=>{k(g.currentTarget)},f=()=>{k(null)},C=()=>{var g;f(),(g=a.current)==null||g.click()},G=()=>{f(),h(!0)},Z=g=>new Promise(E=>{const ie=new FileReader;ie.onload=Ae=>{var oe;const X=new Image;X.onload=()=>{const re=document.createElement("canvas"),ae=re.getContext("2d"),me=1200,fe=1200;let ee=X.width,se=X.height;ee>se?ee>me&&(se=se*me/ee,ee=me):se>fe&&(ee=ee*fe/se,se=fe),re.width=ee,re.height=se,ae==null||ae.drawImage(X,0,0,ee,se),re.toBlob(We=>{if(We){const Fe=new File([We],g.name,{type:"image/jpeg",lastModified:Date.now()});E(Fe)}},"image/jpeg",.85)},X.src=(oe=Ae.target)==null?void 0:oe.result},ie.readAsDataURL(g)}),x=async g=>{if(!g.type.startsWith("image/")){alert("Bitte wähle eine Bilddatei aus");return}_(!0);try{const E=await Z(g);if(E.size>5*1024*1024){alert("Die Datei ist zu groß. Maximal 5MB erlaubt."),_(!1);return}const ie=E.name.split(".").pop(),X=`avatars/${`${m}-${Date.now()}.${ie}`}`,{error:oe}=await K.storage.from("avatars").upload(X,E);if(oe)throw oe;const{data:{publicUrl:re}}=K.storage.from("avatars").getPublicUrl(X),{error:ae}=await K.from("profiles").update({avatar_url:re}).eq("id",m);if(ae)throw ae;u()}catch(E){console.error("Error uploading avatar:",E),alert("Fehler beim Hochladen des Bildes")}finally{_(!1)}},N=async g=>{var ie;const E=(ie=g.target.files)==null?void 0:ie[0];E&&await x(E)},$=async g=>{await x(g)},he=async()=>{if(!o.phone||o.phone.trim()===""){W("Bitte gib zuerst eine Telefonnummer ein");return}I(!0),W(null);try{const{data:g,error:E}=await K.rpc("request_phone_verification",{p_phone:o.phone});if(E)throw E;g.success?(O(g.code),M("code-sent")):W(g.message)}catch(g){console.error("Verification request error:",g),W("Fehler beim Senden des Codes")}finally{I(!1)}},ge=async()=>{if(!i||i.length!==6){W("Bitte gib den 6-stelligen Code ein");return}I(!0),W(null);try{const{data:g,error:E}=await K.rpc("verify_phone_code",{p_code:i});if(E)throw E;g.success?(M("verified"),u()):W(g.message)}catch(g){console.error("Verification error:",g),W("Ungültiger oder abgelaufener Code")}finally{I(!1)}},S=c?s:H,R=c?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Persönliche Daten"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine persönlichen Informationen"}),e.jsxs(S,{...R,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",mb:4,flexDirection:{xs:"column",sm:"row"},textAlign:{xs:"center",sm:"left"}},children:[e.jsxs(s,{sx:{position:"relative",mb:{xs:2,sm:0}},children:[e.jsx(Je,{src:(t==null?void 0:t.avatar_url)||void 0,sx:{width:100,height:100,fontSize:"2rem",bgcolor:"primary.main"},children:((P=(J=o.full_name)==null?void 0:J[0])==null?void 0:P.toUpperCase())||"U"}),e.jsx("input",{ref:a,type:"file",accept:"image/*",style:{display:"none"},onChange:N}),e.jsx(le,{onClick:r,disabled:B,sx:{position:"absolute",bottom:0,right:0,bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},width:36,height:36},children:B?e.jsx(Q,{size:18,color:"inherit"}):e.jsx(Ye,{size:18})}),e.jsxs(Qe,{anchorEl:y,open:!!y,onClose:f,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[e.jsxs(A,{onClick:G,children:[e.jsx(be,{children:e.jsx(Xe,{size:18})}),e.jsx(je,{children:"Foto aufnehmen"})]}),e.jsxs(A,{onClick:C,children:[e.jsx(be,{children:e.jsx(es,{size:18})}),e.jsx(je,{children:"Datei wählen"})]})]})]}),e.jsxs(s,{sx:{ml:{sm:3}},children:[e.jsx(n,{variant:"h6",fontWeight:600,children:o.full_name||"Kein Name"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:o.email})]})]}),e.jsxs(V,{container:!0,spacing:{xs:2,md:3},children:[e.jsx(V,{size:{xs:12,md:6},children:e.jsx(xe,{fieldName:"full_name",fullWidth:!0,label:"Vollständiger Name",value:o.full_name,onChange:g=>p("full_name",g.target.value),helperText:"Dein voller Name wird anderen Nutzern angezeigt"})}),e.jsx(V,{size:{xs:12,md:6},children:e.jsx(D,{fullWidth:!0,label:"E-Mail-Adresse",value:o.email,disabled:!0,helperText:"Deine E-Mail-Adresse kann nicht geändert werden"})}),e.jsx(V,{size:{xs:12},children:e.jsxs(s,{children:[e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:e.jsx(xe,{fieldName:"phone",fullWidth:!0,label:"Telefonnummer",value:o.phone,onChange:g=>p("phone",g.target.value),placeholder:"+43 650 123456",disabled:(t==null?void 0:t.phone_verified)||w==="code-sent",InputProps:{endAdornment:t!=null&&t.phone_verified?e.jsx(Y,{icon:e.jsx(ve,{size:16}),label:"Verifiziert",color:"success",size:"small",sx:{mr:-1}}):void 0}})}),!(t!=null&&t.phone_verified)&&w==="idle"&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(U,{variant:"outlined",startIcon:e.jsx(Ce,{size:18}),onClick:he,disabled:j||!o.phone,size:"small",children:j?"Sende Code...":"Telefonnummer verifizieren"}),e.jsx(n,{variant:"caption",display:"block",color:"text.secondary",sx:{mt:1},children:"Erhöhe das Vertrauen durch Verifizierung deiner Telefonnummer"})]}),w==="code-sent"&&e.jsxs(s,{sx:{mt:2},children:[e.jsxs(q,{severity:"info",sx:{mb:2},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Demo-Modus:"})," Der Verifizierungscode lautet: ",e.jsx("strong",{children:L})]}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"In der Produktion würde dieser Code per SMS gesendet werden."})]}),e.jsxs(s,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[e.jsx(D,{label:"6-stelliger Code",value:i,onChange:g=>{const E=g.target.value.replace(/\D/g,"").slice(0,6);z(E)},placeholder:"123456",inputProps:{maxLength:6},sx:{width:"200px"},error:!!v,helperText:v}),e.jsx(U,{variant:"contained",onClick:ge,disabled:j||i.length!==6,children:j?"Prüfe...":"Verifizieren"}),e.jsx(U,{variant:"text",onClick:()=>{M("idle"),z(""),W(null)},children:"Abbrechen"})]})]}),w==="verified"&&e.jsx(q,{severity:"success",sx:{mt:2},children:"Deine Telefonnummer wurde erfolgreich verifiziert!"}),v&&w==="idle"&&e.jsx(q,{severity:"error",sx:{mt:2},children:v})]})}),e.jsx(V,{size:{xs:12,md:6},children:e.jsxs(xe,{fieldName:"language",fullWidth:!0,select:!0,label:"Sprache",value:o.language,onChange:g=>p("language",g.target.value),helperText:"Bevorzugte Sprache für die App",SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})}),e.jsx(V,{size:{xs:12},children:e.jsx(xe,{fieldName:"bio",fullWidth:!0,label:"Über mich",value:o.bio,onChange:g=>p("bio",g.target.value),multiline:!0,rows:4,helperText:"Erzähle anderen Nutzern etwas über dich (optional)",placeholder:"Ich verkaufe gerne gebrauchte Artikel und bin immer auf der Suche nach guten Deals..."})})]})]}),e.jsx(ss,{open:l,onClose:()=>h(!1),onCapture:$})]})},Ds=({userId:t})=>{const o=ne(),p=te(o.breakpoints.down("md")),[m,u]=d.useState(!1),[b,c]=d.useState(!0),[B,_]=d.useState(!1),[j,I]=d.useState(!1),[w,M]=d.useState(!1),[i,z]=d.useState(!1),[v,W]=d.useState(""),[L,O]=d.useState(""),[a,l]=d.useState(null),[h,y]=d.useState(null),[k,r]=d.useState(null);d.useEffect(()=>{f()},[t]),d.useEffect(()=>{r(v?C(v):null)},[v]);const f=async()=>{try{c(!0);const{data:{user:S},error:R}=await K.auth.getUser();if(R)throw R;if(!S)return;const J=S.app_metadata.providers||[],P=J.some(E=>E!=="email"),g=J.includes("email");_(P),I(g&&!P)}catch(S){console.error("Error checking user auth:",S)}finally{c(!1)}},C=S=>{let R=0;return S.length>=8&&R++,S.length>=12&&R++,/[a-z]/.test(S)&&/[A-Z]/.test(S)&&R++,/\d/.test(S)&&R++,/[^a-zA-Z\d]/.test(S)&&R++,R<=2?"weak":R<=3?"medium":"strong"},G=()=>!v||v.length<8?"Passwort muss mindestens 8 Zeichen lang sein":v!==L?"Passwörter stimmen nicht überein":k==="weak"?"Passwort ist zu schwach. Verwende Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen":null,Z=async()=>{var R,J;y(null),l(null);const S=G();if(S){y(S);return}u(!0);try{const{error:P}=await K.auth.updateUser({password:v});if(P)throw P;l("Passwort erfolgreich gesetzt! Du kannst dich jetzt mit deiner E-Mail und diesem Passwort anmelden."),W(""),O(""),I(!0),await f()}catch(P){console.error("Error setting password:",P),(R=P.message)!=null&&R.includes("should be different from the old password")?y("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):(J=P.message)!=null&&J.includes("Password is too weak")?y("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):y(P.message||"Fehler beim Setzen des Passworts")}finally{u(!1)}},x=async()=>{var R,J;y(null),l(null);const S=G();if(S){y(S);return}u(!0);try{const{error:P}=await K.auth.updateUser({password:v});if(P)throw P;l("Passwort erfolgreich geändert!"),W(""),O("")}catch(P){console.error("Error changing password:",P),(R=P.message)!=null&&R.includes("should be different from the old password")?y("Das neue Passwort muss sich vom aktuellen Passwort unterscheiden."):(J=P.message)!=null&&J.includes("Password is too weak")?y("Passwort ist zu schwach. Verwende ein stärkeres Passwort."):y(P.message||"Fehler beim Ändern des Passworts")}finally{u(!1)}},N=()=>k?k==="weak"?"error":k==="medium"?"warning":"success":"default",$=()=>k?k==="weak"?"Schwach":k==="medium"?"Mittel":"Stark":"",he=p?s:H,ge=p?{}:{sx:{p:3}};return b?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Q,{})}):e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Sicherheit"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Verwalte deine Anmeldemethoden und Passwort-Einstellungen"}),e.jsxs(he,{...ge,children:[e.jsxs(s,{sx:{mb:4},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:2},children:[e.jsx(Ce,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Anmeldemethoden"})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[B&&e.jsx(Y,{icon:e.jsx(ve,{size:16}),label:"Google OAuth",color:"success",sx:{alignSelf:"flex-start"}}),j?e.jsx(Y,{icon:e.jsx(ve,{size:16}),label:"E-Mail & Passwort",color:"success",sx:{alignSelf:"flex-start"}}):e.jsx(Y,{icon:e.jsx(Ss,{size:16}),label:"Kein Passwort gesetzt",color:"warning",sx:{alignSelf:"flex-start"}})]})]}),!j&&B&&e.jsxs(q,{severity:"info",sx:{mb:3},children:[e.jsxs(n,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Hinweis:"})," Du hast dich mit Google angemeldet und hast noch kein Passwort gesetzt."]}),e.jsx(n,{variant:"body2",children:"Setze ein Passwort, um dich alternativ auch mit E-Mail und Passwort anmelden zu können."})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(ke,{size:24,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:j?"Passwort ändern":"Passwort setzen"})]}),a&&e.jsx(q,{severity:"success",sx:{mb:3},onClose:()=>l(null),children:a}),h&&e.jsx(q,{severity:"error",sx:{mb:3},onClose:()=>y(null),children:h}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsx(D,{fullWidth:!0,label:"Neues Passwort",type:w?"text":"password",value:v,onChange:S=>W(S.target.value),placeholder:"Mindestens 8 Zeichen",InputProps:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(le,{onClick:()=>M(!w),edge:"end",children:w?e.jsx(Pe,{size:20}):e.jsx(ye,{size:20})})})},helperText:k&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[e.jsx(n,{variant:"caption",color:"text.secondary",children:"Passwortstärke:"}),e.jsx(Y,{label:$(),color:N(),size:"small",sx:{height:18,fontSize:"0.7rem"}})]})}),e.jsx(D,{fullWidth:!0,label:"Passwort bestätigen",type:i?"text":"password",value:L,onChange:S=>O(S.target.value),placeholder:"Passwort wiederholen",InputProps:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(le,{onClick:()=>z(!i),edge:"end",children:i?e.jsx(Pe,{size:20}):e.jsx(ye,{size:20})})})},error:L.length>0&&v!==L,helperText:L.length>0&&v!==L?"Passwörter stimmen nicht überein":""}),e.jsxs(s,{children:[e.jsx(U,{variant:"contained",onClick:j?x:Z,disabled:m||!v||!L||v!==L,startIcon:m?e.jsx(Q,{size:18}):e.jsx(ke,{size:18}),sx:{mr:2},children:m?"Wird gespeichert...":j?"Passwort ändern":"Passwort setzen"}),(v||L)&&e.jsx(U,{variant:"text",onClick:()=>{W(""),O(""),y(null),l(null)},children:"Abbrechen"})]}),e.jsxs(q,{severity:"info",sx:{mt:2},children:[e.jsx(n,{variant:"body2",fontWeight:600,sx:{mb:1},children:"Passwort-Anforderungen:"}),e.jsxs(s,{component:"ul",sx:{m:0,pl:2},children:[e.jsx(n,{component:"li",variant:"body2",children:"Mindestens 8 Zeichen"}),e.jsx(n,{component:"li",variant:"body2",children:"Groß- und Kleinbuchstaben"}),e.jsx(n,{component:"li",variant:"body2",children:"Mindestens eine Zahl"}),e.jsx(n,{component:"li",variant:"body2",children:"Empfohlen: Sonderzeichen (!@#$%^&*)"})]})]})]})]})]})},Ms=({formData:t,onFormChange:o})=>{const p=ne(),m=te(p.breakpoints.down("md")),u=m?s:H,b=m?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"KI-Assistent"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe an, wie die KI deine Inseratentexte erstellen soll"}),e.jsxs(u,{...b,children:[e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Textgenerierung"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[e.jsxs(D,{fullWidth:!0,select:!0,label:"Schreibstil",value:t.ai_text_style,onChange:c=>o("ai_text_style",c.target.value),helperText:"Der Ton und die Art der generierten Texte",children:[e.jsx(A,{value:"formal",children:"Förmlich - Professionell und sachlich"}),e.jsx(A,{value:"casual",children:"Locker - Freundlich und ungezwungen"}),e.jsx(A,{value:"detailed",children:"Detailreich - Ausführlich und informativ"}),e.jsx(A,{value:"concise",children:"Prägnant - Kurz und auf den Punkt"}),e.jsx(A,{value:"balanced",children:"Ausgewogen - Gute Balance (empfohlen)"})]}),e.jsxs(D,{fullWidth:!0,select:!0,label:"Textlänge",value:t.ai_text_length,onChange:c=>o("ai_text_length",c.target.value),helperText:"Bevorzugte Länge der Beschreibungen",children:[e.jsx(A,{value:"short",children:"Kurz - Ca. 2-3 Sätze"}),e.jsx(A,{value:"medium",children:"Mittel - Ca. 4-6 Sätze (empfohlen)"}),e.jsx(A,{value:"long",children:"Lang - Ca. 7-10 Sätze"})]})]}),e.jsx(ce,{sx:{my:3}}),e.jsx(n,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Erweiterte Optionen"}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(T,{control:e.jsx(F,{checked:t.ai_include_emoji,onChange:c=>o("ai_include_emoji",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Emojis verwenden"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI fügt passende Emojis in die Beschreibungen ein"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(T,{control:e.jsx(F,{checked:t.ai_allow_line_breaks,onChange:c=>o("ai_allow_line_breaks",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Zeilenumbrüche erlauben"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Die KI strukturiert Texte mit Absätzen für bessere Lesbarkeit"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(T,{control:e.jsx(F,{checked:t.ai_auto_publish,onChange:c=>o("ai_auto_publish",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Automatisch veröffentlichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate werden direkt nach der KI-Generierung veröffentlicht"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(T,{control:e.jsx(F,{checked:t.ai_analyze_all_images,onChange:c=>o("ai_analyze_all_images",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Alle Bilder analysieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Bei mehreren Bildern werden alle analysiert (teurer, aber detaillierter)"})]}),sx:{alignItems:"flex-start",m:0}})]})]})]})},Ls=({formData:t,onFormChange:o})=>{const p=ne(),m=te(p.breakpoints.down("md")),u=m?s:H,b=m?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Benachrichtigungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Wähle aus, wie du über Neuigkeiten informiert werden möchtest"}),e.jsx(u,{...b,children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(T,{control:e.jsx(F,{checked:t.notifications_enabled,onChange:c=>o("notifications_enabled",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Push-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte Benachrichtigungen über neue Nachrichten und Aktivitäten"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(T,{control:e.jsx(F,{checked:t.email_notifications,onChange:c=>o("email_notifications",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"E-Mail-Benachrichtigungen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte wichtige Updates und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(s,{sx:{height:1,bgcolor:"divider",my:.5}}),e.jsx(T,{control:e.jsx(F,{checked:t.newsletter_subscribed,onChange:c=>o("newsletter_subscribed",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Newsletter abonnieren"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Erhalte regelmäßig Angebote, Tipps und Neuigkeiten per E-Mail"})]}),sx:{alignItems:"flex-start",m:0}})]})})]})},Rs=({userId:t})=>{const o=ne(),p=te(o.breakpoints.down("md")),[m,u]=d.useState([]),[b,c]=d.useState(!0),[B,_]=d.useState(!1),[j,I]=d.useState(null),[w,M]=d.useState(!1),[i,z]=d.useState({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),[v,W]=d.useState([]),[L,O]=d.useState(!1);d.useEffect(()=>{const f=setTimeout(async()=>{if(i.postal_code.length>=4){O(!0);try{const G=(await Ws(i.postal_code,i.country)).map(Z=>Z.city);console.log("AddressesSection: Found cities for",i.postal_code,i.country,":",G),W(G),G.length===1&&!i.city&&z(Z=>({...Z,city:G[0]}))}catch(C){console.error("Error fetching cities:",C)}finally{O(!1)}}else W([])},500);return()=>clearTimeout(f)},[i.postal_code,i.country]);const a=async()=>{c(!0);try{const{data:r,error:f}=await K.from("addresses").select("*").eq("user_id",t).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(f)throw f;u(r||[])}catch(r){console.error("Error loading addresses:",r)}finally{c(!1)}};d.useEffect(()=>{a()},[t]);const l=()=>{I(null),z({name:"",address:"",postal_code:"",city:"",country:"AT",phone:"",show_phone_publicly:!1,is_default:!1,address_type:"both",is_default_shipping:!1}),_(!0)},h=r=>{I(r),z({name:r.name||"",address:r.address,postal_code:r.postal_code,city:r.city,country:r.country,phone:r.phone||"",show_phone_publicly:r.show_phone_publicly||!1,is_default:r.is_default,address_type:r.address_type||"both",is_default_shipping:r.is_default_shipping||!1}),_(!0)},y=async()=>{var r,f;if(!(!i.address.trim()||!i.postal_code.trim()||!i.city.trim())){M(!0);try{if(j){const{error:C}=await K.from("addresses").update({name:i.name.trim()||"Meine Adresse",address:i.address.trim(),postal_code:i.postal_code.trim(),city:i.city.trim(),country:i.country,phone:((r=i.phone)==null?void 0:r.trim())||null,show_phone_publicly:i.show_phone_publicly,is_default:i.is_default,address_type:i.address_type,is_default_shipping:i.is_default_shipping}).eq("id",j.id);if(C)throw C}else{const{error:C}=await K.from("addresses").insert({user_id:t,name:i.name.trim()||"Meine Adresse",address:i.address.trim(),postal_code:i.postal_code.trim(),city:i.city.trim(),country:i.country,phone:((f=i.phone)==null?void 0:f.trim())||null,show_phone_publicly:i.show_phone_publicly,is_default:i.is_default,address_type:i.address_type,is_default_shipping:i.is_default_shipping});if(C)throw C}await a(),_(!1)}catch(C){console.error("Error saving address:",C)}finally{M(!1)}}},k=async r=>{if(window.confirm("Möchtest du diese Adresse wirklich löschen?"))try{const{error:f}=await K.from("addresses").delete().eq("id",r);if(f)throw f;await a()}catch(f){console.error("Error deleting address:",f)}};return b?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Q,{})}):e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(s,{sx:{display:{xs:"none",md:"block"}},children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1},children:"Adressen"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Verwalte deine Adressen für Abholung und Versand"})]}),e.jsx(U,{variant:"contained",startIcon:e.jsx(Ps,{size:20}),onClick:l,sx:{ml:{xs:"auto",md:"auto"},mr:{xs:"auto",md:0}},children:m.length===0?"Adresse hinzufügen":p?"+ Adresse":"Neue Adresse"})]}),m.length===0?e.jsxs(H,{sx:{p:{xs:3,md:6},textAlign:"center"},children:[e.jsx(pe,{size:48,style:{margin:"0 auto 16px",color:"#999"}}),e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Keine Adressen vorhanden"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Füge deine erste Adresse über den Button oben hinzu"})]}):e.jsx(V,{container:!0,spacing:2,children:m.map(r=>{var f;return e.jsx(V,{size:{xs:12,md:6},children:e.jsx(ns,{sx:{height:"100%",border:r.is_default?2:1,borderColor:r.is_default?"primary.main":"divider"},children:e.jsxs(ts,{children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(is,{size:20,color:r.is_default?"#1976d2":"#666"}),e.jsx(n,{variant:"h6",fontWeight:600,children:r.name||"Unbenannte Adresse"})]}),r.is_default&&e.jsx(n,{variant:"caption",sx:{bgcolor:"primary.main",color:"white",px:1.5,py:.5,borderRadius:1,fontWeight:600},children:"Standard"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:r.address}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[r.postal_code," ",r.city]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:((f=Te.find(C=>C.code===r.country))==null?void 0:f.name)||r.country}),r.phone&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Tel: ",r.phone]}),e.jsxs(s,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[(r.address_type==="both"||r.address_type==="pickup_only")&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(25, 118, 210, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"primary.main"},children:e.jsx(n,{variant:"caption",color:"primary.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Abholung"})}),(r.address_type==="both"||r.address_type==="shipping_only")&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(46, 125, 50, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"success.main"},children:e.jsx(n,{variant:"caption",color:"success.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Versand"})}),r.is_default_shipping&&e.jsx(s,{sx:{display:"flex",alignItems:"center",px:1.5,py:.75,bgcolor:"rgba(237, 108, 2, 0.08)",borderRadius:1.5,border:"1px solid",borderColor:"warning.main"},children:e.jsx(n,{variant:"caption",color:"warning.main",fontWeight:600,sx:{fontSize:"0.75rem",lineHeight:1},children:"Standard-Versand"})})]}),e.jsxs(s,{sx:{display:"flex",gap:1,mt:3},children:[e.jsx(U,{variant:"outlined",size:"medium",onClick:()=>h(r),fullWidth:!0,sx:{fontWeight:600,textTransform:"none",borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:"Bearbeiten"}),e.jsx(U,{variant:"outlined",color:"error",size:"medium",onClick:()=>k(r.id),sx:{minWidth:48,px:1.5,fontWeight:600,borderWidth:1.5,"&:hover":{borderWidth:1.5}},children:e.jsx(rs,{size:18,strokeWidth:2})})]})]})})},r.id)})}),e.jsx(Cs,{open:B,onClose:()=>_(!1),title:j?"Adresse bearbeiten":"Neue Adresse hinzufügen",maxWidth:"md",fullScreen:p,children:e.jsxs(V,{container:!0,spacing:3,children:[e.jsx(V,{size:{xs:12},children:e.jsx(D,{fullWidth:!0,label:"Name (optional)",value:i.name,onChange:r=>z({...i,name:r.target.value}),placeholder:"z.B. Zuhause, Arbeit"})}),e.jsx(V,{size:{xs:12},children:e.jsx(D,{fullWidth:!0,required:!0,label:"Straße und Hausnummer",value:i.address,onChange:r=>z({...i,address:r.target.value})})}),e.jsx(V,{size:{xs:12,sm:4},children:e.jsx(D,{fullWidth:!0,label:"PLZ",required:!0,value:i.postal_code,onChange:r=>z({...i,postal_code:r.target.value}),helperText:L?"Suche Orte...":v.length>0?`${v.length} Ort(e) gefunden`:""})}),e.jsx(V,{size:{xs:12,sm:8},children:e.jsx(as,{fullWidth:!0,freeSolo:!0,loading:L,options:v,value:i.city,onInputChange:(r,f)=>{z({...i,city:f||""})},renderInput:r=>e.jsx(D,{...r,label:"Ort",required:!0})})}),e.jsx(V,{size:{xs:12,sm:6},children:e.jsx(D,{fullWidth:!0,select:!0,label:"Land",value:i.country,onChange:r=>z({...i,country:r.target.value}),SelectProps:{native:!0},children:Te.map(r=>e.jsx("option",{value:r.code,children:r.name},r.code))})}),e.jsx(V,{size:{xs:12,sm:6},children:e.jsx(D,{fullWidth:!0,label:"Telefon (optional)",value:i.phone,onChange:r=>z({...i,phone:r.target.value}),helperText:"Wird für Artikeldetails verwendet, falls freigegeben"})}),i.phone&&e.jsx(V,{size:{xs:12},children:e.jsx(T,{control:e.jsx(F,{checked:i.show_phone_publicly,onChange:r=>z({...i,show_phone_publicly:r.target.checked})}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",children:"Telefonnummer öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Wenn aktiviert, wird deine Telefonnummer bei Artikeln mit dieser Adresse angezeigt"})]})})}),e.jsx(V,{size:{xs:12},children:e.jsxs(D,{fullWidth:!0,select:!0,label:"Adresstyp",value:i.address_type,onChange:r=>z({...i,address_type:r.target.value}),helperText:"Wähle aus, wofür diese Adresse verwendet werden soll",children:[e.jsx(A,{value:"both",children:"Abholung & Versand"}),e.jsx(A,{value:"pickup_only",children:"Nur Abholung"}),e.jsx(A,{value:"shipping_only",children:"Nur Versand"})]})}),e.jsx(V,{size:{xs:12},children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(T,{control:e.jsx(F,{checked:i.is_default,onChange:r=>z({...i,is_default:r.target.checked})}),label:"Als Standard-Adresse für Abholung festlegen"}),(i.address_type==="both"||i.address_type==="shipping_only")&&e.jsx(T,{control:e.jsx(F,{checked:i.is_default_shipping,onChange:r=>z({...i,is_default_shipping:r.target.checked})}),label:"Als Standard-Versandadresse festlegen"})]})}),e.jsx(V,{size:{xs:12},children:e.jsxs(s,{sx:{display:"flex",gap:2,justifyContent:"flex-end",pt:3,mt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(U,{onClick:()=>_(!1),size:"large",sx:{minWidth:120},children:"ABBRECHEN"}),e.jsx(U,{variant:"contained",onClick:y,disabled:w||!i.address||!i.postal_code||!i.city,size:"large",sx:{minWidth:120},children:w?e.jsx(Q,{size:24}):"SPEICHERN"})]})})]})})]})},Ns=({formData:t,onFormChange:o})=>{const p=ne(),m=te(p.breakpoints.down("md")),u=m?s:H,b=m?{}:{sx:{p:3,mb:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Versand & Abholung"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Lege fest, wie Käufer deine Artikel erhalten können"}),e.jsx(q,{severity:"info",sx:{mb:3},children:"Diese Einstellungen gelten als Standard für alle deine Artikel."}),e.jsxs(u,{...b,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(He,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Versandoptionen"})]}),e.jsx(T,{control:e.jsx(F,{checked:t.shipping_enabled,onChange:c=>o("shipping_enabled",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Versand anbieten"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Biete Versand für deine Artikel an"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),t.shipping_enabled&&e.jsxs(s,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsxs(we,{component:"fieldset",children:[e.jsx(ls,{component:"legend",sx:{mb:1.5,fontWeight:600,fontSize:"0.875rem"},children:"Versandkostenberechnung"}),e.jsxs(Ge,{value:t.shipping_cost_type,onChange:c=>o("shipping_cost_type",c.target.value),children:[e.jsx(T,{value:"free",control:e.jsx(de,{size:"small"}),label:"Kostenloser Versand",sx:{mb:1}}),e.jsx(T,{value:"fixed",control:e.jsx(de,{size:"small"}),label:"Feste Versandkosten",sx:{mb:1}}),e.jsx(T,{value:"ai_calculated",control:e.jsx(de,{size:"small"}),label:"KI-berechnet (automatisch)"})]})]}),t.shipping_cost_type==="fixed"&&e.jsx(D,{label:"Versandkosten",type:"number",size:"small",value:t.shipping_cost,onChange:c=>o("shipping_cost",parseFloat(c.target.value)||0),InputProps:{endAdornment:e.jsx(ue,{position:"end",children:"€"}),inputProps:{min:0,step:.5}},helperText:"Standard-Versandkosten pro Artikel",sx:{maxWidth:280}}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Versandbeschreibung (optional)",placeholder:"z.B. Versand mit DHL, Lieferzeit 2-3 Werktage",value:t.shipping_description||"",onChange:c=>o("shipping_description",c.target.value||null),helperText:"Zusätzliche Informationen zum Versand"})]})]}),e.jsxs(u,{...b,children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:3},children:[e.jsx(pe,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Abholoptionen"})]}),e.jsx(T,{control:e.jsx(F,{checked:t.pickup_enabled,onChange:c=>o("pickup_enabled",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Abholung ermöglichen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Käufer können Artikel bei dir abholen"})]}),sx:{alignItems:"flex-start",m:0,mb:3}}),t.pickup_enabled&&e.jsxs(s,{sx:{pl:{xs:0,sm:2},display:"flex",flexDirection:"column",gap:2.5},children:[e.jsx(T,{control:e.jsx(F,{size:"small",checked:t.show_location_publicly,onChange:c=>o("show_location_publicly",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort öffentlich anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:.5},children:t.show_location_publicly?"Vollständige Adresse wird angezeigt":"Nur PLZ und Ort sichtbar"})]}),sx:{alignItems:"flex-start",m:0}}),e.jsx(D,{fullWidth:!0,multiline:!0,rows:2,size:"small",label:"Abholbeschreibung (optional)",placeholder:"z.B. Abholung nach Vereinbarung, Parkplätze vorhanden",value:t.location_description||"",onChange:c=>o("location_description",c.target.value||null),helperText:"Zusätzliche Informationen zur Abholung"})]})]})]})},Hs=({formData:t,onFormChange:o})=>{const p=ne(),m=te(p.breakpoints.down("md")),u=m?s:H,b=m?{}:{sx:{p:3}};return e.jsxs(s,{children:[e.jsx(n,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Anzeige-Einstellungen"}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:4,display:{xs:"none",md:"block"}},children:"Passe die Darstellung der Anwendung an deine Bedürfnisse an"}),e.jsx(u,{...b,children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(os,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Sprache"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Wähle die Sprache der Benutzeroberfläche"}),e.jsxs(D,{fullWidth:!0,select:!0,value:t.language,onChange:c=>o("language",c.target.value),SelectProps:{native:!0},children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"})]})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(pe,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standort-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Steuere, wer deinen Standort (Ort & Land) bei deinen Artikeln sehen kann"}),e.jsx(H,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(T,{control:e.jsx(F,{checked:t.show_location_to_public,onChange:c=>o("show_location_to_public",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Standort für Besucher sichtbar"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:t.show_location_to_public?"Ort und Land sind für alle sichtbar (auch nicht angemeldete Besucher)":"Ort und Land sind nur für angemeldete Nutzer sichtbar"})]}),sx:{alignItems:"flex-start",m:0}})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Vollständige Adressen sind nur für angemeldete Nutzer sichtbar, wenn du dies in den Abholoptionen aktiviert hast."})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(Bs,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Händigkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Optimiere die Button-Position für deine bevorzugte Hand bei der Ein-Hand-Bedienung"}),e.jsx(Ge,{value:t.hand_preference,onChange:c=>o("hand_preference",c.target.value),children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:[e.jsx(H,{elevation:0,sx:{p:2,border:1,borderColor:t.hand_preference==="right"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>o("hand_preference","right"),children:e.jsx(T,{value:"right",control:e.jsx(de,{checked:t.hand_preference==="right"}),label:e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Rechtshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation links, Aktionen rechts"})]})}),sx:{m:0,width:"100%"}})}),e.jsx(H,{elevation:0,sx:{p:2,border:1,borderColor:t.hand_preference==="left"?"primary.main":"divider",borderRadius:1,cursor:"pointer","&:hover":{borderColor:"primary.main"}},onClick:()=>o("hand_preference","left"),children:e.jsx(T,{value:"left",control:e.jsx(de,{checked:t.hand_preference==="left"}),label:e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1.5},children:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,children:"Linkshänder"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Navigation rechts, Aktionen links"})]})}),sx:{m:0,width:"100%"}})})]})})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(zs,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Verkäuferprofil-Sichtbarkeit"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Zeige dein Profil in deinen Inseraten an, um Vertrauen aufzubauen"}),e.jsx(H,{elevation:0,sx:{p:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(T,{control:e.jsx(F,{checked:t.show_seller_profile,onChange:c=>o("show_seller_profile",c.target.checked)}),label:e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:500,children:"Verkäuferprofil in Inseraten anzeigen"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:t.show_seller_profile?"Dein Name, Avatar und andere Inserate werden in deinen Artikeln angezeigt":'Nur "Privater Verkäufer" wird angezeigt, keine persönlichen Infos'})]}),sx:{alignItems:"flex-start",m:0}})}),!t.show_seller_profile&&e.jsx(H,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"warning.main",borderRadius:1,bgcolor:"warning.50"},children:e.jsxs(s,{sx:{display:"flex",gap:1.5,alignItems:"flex-start"},children:[e.jsx(As,{size:18,color:"#ed6c02",style:{flexShrink:0,marginTop:2}}),e.jsxs(s,{children:[e.jsx(n,{variant:"body2",fontWeight:600,color:"warning.dark",sx:{mb:.5},children:"Hinweis zur Sichtbarkeit"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Inserate mit sichtbarem Verkäuferprofil wirken seriöser und erhalten durchschnittlich 40% mehr Anfragen. Dein Name und Avatar helfen Interessenten, Vertrauen aufzubauen."})]})]})}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:1.5,fontStyle:"italic"},children:"ℹ️ Du kannst dein Profilbild und deinen Namen jederzeit in den persönlichen Daten ändern."})]}),e.jsx(ce,{sx:{my:2}}),e.jsxs(s,{children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1.5,mb:1.5},children:[e.jsx(cs,{size:20,color:"#1976d2"}),e.jsx(n,{variant:"h6",fontWeight:600,children:"Standard-Schaltdauer"})]}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Lege fest, wie lange deine Inserate standardmäßig online bleiben. Diese Dauer wird bei jedem neuen Inserat verwendet."}),e.jsx(D,{fullWidth:!0,type:"number",value:t.default_listing_duration,onChange:c=>{const B=parseInt(c.target.value);B>=10&&B<=30&&o("default_listing_duration",B)},inputProps:{min:10,max:30,step:1},helperText:"Zwischen 10 und 30 Tagen",InputProps:{endAdornment:e.jsx(ue,{position:"end",children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"Tage"})})}}),e.jsx(H,{elevation:0,sx:{p:2,mt:2,border:1,borderColor:"divider",borderRadius:1,bgcolor:"grey.50"},children:e.jsx(n,{variant:"caption",color:"text.secondary",children:'📅 Deine Inserate werden nach Ablauf dieser Dauer automatisch als "abgelaufen" markiert und sind nicht mehr öffentlich sichtbar. Du kannst sie jederzeit wieder aktivieren.'})})]})]})})]})},Os=t=>{const o=new Date(t);return new Intl.DateTimeFormat("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(o)},Gs=t=>({purchase:"Kauf",usage:"Verbrauch",bonus:"Bonus",refund:"Erstattung"})[t]||t,Ks=t=>({purchase:"success",usage:"error",bonus:"info",refund:"warning"})[t]||"info",Fs=t=>{switch(t){case"purchase":return e.jsx(Ke,{size:16});case"usage":return e.jsx(ys,{size:16});case"bonus":return e.jsx(Is,{size:16});case"refund":return e.jsx(ps,{size:16});default:return e.jsx(Se,{size:16})}},Us=()=>{const t=Ne(),{user:o}=Oe();Ts();const{personalCredits:p,communityPotBalance:m,loading:u}=ds(),[b,c]=d.useState([]),[B,_]=d.useState(!1),[j,I]=d.useState("all"),[w,M]=d.useState("all"),[i,z]=d.useState(!1),[v,W]=d.useState(new Set),L=l=>{W(h=>{const y=new Set(h);return y.has(l)?y.delete(l):y.add(l),y})},O=async()=>{if(o){_(!0);try{const{data:l,error:h}=await K.from("credit_transactions").select("*").eq("user_id",o.id).order("created_at",{ascending:!1}).limit(50);if(h)throw h;c(l||[])}catch(l){console.error("Error loading credit transactions:",l)}finally{_(!1)}}};d.useEffect(()=>{O()},[o]);const a=b.filter(l=>{var h;if(j!=="all"&&l.transaction_type!==j)return!1;if(w!=="all"){const y=new Date(l.created_at),k=new Date;if(w==="today"){if(!(y.toDateString()===k.toDateString()))return!1}else if(w==="week"){const r=new Date(k.getTime()-6048e5);if(y<r)return!1}else if(w==="month"){const r=new Date(k.getTime()-2592e6);if(y<r)return!1}}return!(i&&l.transaction_type==="usage"&&!(((h=l.metadata)==null?void 0:h.gemini_total_tokens)>0))});return e.jsxs(s,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,sx:{fontWeight:700,mb:3,display:{xs:"none",md:"block"}},children:"Mein Guthaben"}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)"},gap:{xs:2,md:3},mb:{xs:3,md:4}},children:[e.jsxs(H,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#f8f9fa",border:"1px solid #e8eaed",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(s,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#e8f0fe",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Se,{size:24,color:"#1a73e8"})}),e.jsxs(s,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Personal Credits"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#202124",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:u?e.jsx(Q,{size:28}):Me(p)})]})]}),e.jsxs(s,{sx:{display:"flex",gap:{xs:2,md:3},mb:{xs:1.5,md:2},px:.5},children:[e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},display:"block",mb:.25},children:"Gekauft"}),e.jsxs(n,{variant:"body2",sx:{fontWeight:600,color:"#34a853",fontSize:{xs:"0.875rem",md:"0.95rem"}},children:["+",b.filter(l=>{var h;return l.transaction_type==="purchase"&&((h=l.metadata)==null?void 0:h.package_type)!=="community"}).reduce((l,h)=>l+h.amount,0)]})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},display:"block",mb:.25},children:"Verbraucht"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,color:"#5f6368",fontSize:{xs:"0.875rem",md:"0.95rem"}},children:b.filter(l=>l.transaction_type==="usage").reduce((l,h)=>l+Math.abs(h.amount),0)})]})]}),e.jsxs(U,{fullWidth:!0,variant:"contained",startIcon:e.jsx(Ke,{size:16}),onClick:()=>t("/tokens"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},bgcolor:"#1a73e8",color:"white",borderRadius:2,boxShadow:"none",fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{bgcolor:"#1557b0",boxShadow:"0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15)"}},children:[e.jsx(s,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Credits kaufen"}),e.jsx(s,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Kaufen"})]})]}),e.jsxs(H,{elevation:0,sx:{p:{xs:2,sm:2.5,md:3},borderRadius:{xs:2,md:3},bgcolor:"#fef7ff",border:"1px solid #f3e8fd",position:"relative",overflow:"hidden",transition:"all 0.2s ease","&:hover":{boxShadow:"0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15)",transform:"translateY(-2px)"}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"flex-start",gap:{xs:1.5,md:2},mb:{xs:2,md:2.5}},children:[e.jsx(s,{sx:{width:{xs:40,md:48},height:{xs:40,md:48},borderRadius:2,bgcolor:"#fce8f3",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Ie,{size:24,color:"#c51162",fill:"#c51162"})}),e.jsxs(s,{sx:{flex:1,minWidth:0},children:[e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.75rem",md:"0.875rem"},mb:.25,fontWeight:500},children:"Community-Topf"}),e.jsx(n,{variant:"h3",sx:{fontWeight:600,color:"#c51162",fontSize:{xs:"1.75rem",sm:"2rem",md:"2.5rem"},lineHeight:1.2},children:u?e.jsx(Q,{size:28}):Me(m)})]})]}),e.jsxs(s,{sx:{px:.5,mb:{xs:1.5,md:2}},children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},display:"block",mb:.25},children:"Meine Spenden"}),e.jsxs(n,{variant:"body2",sx:{fontWeight:600,color:"#c51162",fontSize:{xs:"0.875rem",md:"0.95rem"}},children:[b.filter(l=>{var h;return l.transaction_type==="purchase"&&((h=l.metadata)==null?void 0:h.package_type)==="community"}).reduce((l,h)=>l+h.amount,0)||0," Credits"]})]}),e.jsxs(U,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(Ie,{size:16}),onClick:()=>t("/tokens?tab=community"),sx:{textTransform:"none",fontWeight:600,py:{xs:1,md:1.25},borderColor:"#c51162",color:"#c51162",borderRadius:2,borderWidth:1.5,fontSize:{xs:"0.875rem",md:"1rem"},"&:hover":{borderColor:"#a00037",bgcolor:"rgba(197, 17, 98, 0.04)",borderWidth:1.5}},children:[e.jsx(s,{component:"span",sx:{display:{xs:"none",sm:"inline"}},children:"Jetzt spenden"}),e.jsx(s,{component:"span",sx:{display:{xs:"inline",sm:"none"}},children:"Spenden"})]})]})]}),b.length>0&&e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:700},children:["Transaktionen",e.jsxs(n,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1,fontWeight:400},children:["(",a.length,")"]})]}),(j!=="all"||w!=="all"||i)&&e.jsx(U,{size:"small",onClick:()=>{I("all"),M("all"),z(!1)},sx:{textTransform:"none",fontSize:"0.75rem"},children:"Filter zurücksetzen"})]}),e.jsxs(s,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(we,{size:"small",sx:{minWidth:150},children:[e.jsx(Ee,{id:"filter-type-label",children:"Typ"}),e.jsxs(Be,{labelId:"filter-type-label",value:j,label:"Typ",onChange:l=>I(l.target.value),children:[e.jsx(A,{value:"all",children:"Alle"}),e.jsx(A,{value:"purchase",children:"Käufe"}),e.jsx(A,{value:"usage",children:"Verbrauch"}),e.jsx(A,{value:"bonus",children:"Bonus"}),e.jsx(A,{value:"refund",children:"Rückerstattung"})]})]}),e.jsxs(we,{size:"small",sx:{minWidth:140},children:[e.jsx(Ee,{id:"filter-period-label",children:"Zeitraum"}),e.jsxs(Be,{labelId:"filter-period-label",value:w,label:"Zeitraum",onChange:l=>M(l.target.value),children:[e.jsx(A,{value:"all",children:"Alle"}),e.jsx(A,{value:"today",children:"Heute"}),e.jsx(A,{value:"week",children:"7 Tage"}),e.jsx(A,{value:"month",children:"30 Tage"})]})]}),j==="usage"&&e.jsx(T,{control:e.jsx(hs,{checked:i,onChange:l=>z(l.target.checked),size:"small"}),label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{size:14}),e.jsx(n,{variant:"body2",children:"Nur AI"})]})})]})]}),B?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Q,{})}):b.length===0?e.jsx(q,{severity:"info",sx:{borderRadius:2},children:"Noch keine Transaktionen vorhanden."}):a.length===0?e.jsx(q,{severity:"warning",sx:{borderRadius:2},children:"Keine Transaktionen mit den aktuellen Filtern gefunden. Versuchen Sie, die Filter zurückzusetzen."}):e.jsx(H,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid",borderColor:"divider"},children:e.jsxs(s,{component:"table",sx:{width:"100%",borderCollapse:"collapse"},children:[e.jsx(s,{component:"thead",sx:{bgcolor:"#f8f9fa",borderBottom:"2px solid",borderColor:"divider"},children:e.jsxs(s,{component:"tr",children:[e.jsx(s,{component:"th",sx:{textAlign:"left",p:1.5,fontWeight:700,fontSize:"0.8rem",color:"text.secondary"},children:"Typ"}),e.jsx(s,{component:"th",sx:{textAlign:"left",p:1.5,fontWeight:700,fontSize:"0.8rem",color:"text.secondary",display:{xs:"none",sm:"table-cell"}},children:"Beschreibung"}),e.jsx(s,{component:"th",sx:{textAlign:"right",p:1.5,fontWeight:700,fontSize:"0.8rem",color:"text.secondary"},children:"Betrag"}),e.jsx(s,{component:"th",sx:{textAlign:"right",p:1.5,fontWeight:700,fontSize:"0.8rem",color:"text.secondary",display:{xs:"none",md:"table-cell"}},children:"Datum"}),e.jsx(s,{component:"th",sx:{width:40,p:1.5}})]})}),e.jsx(s,{component:"tbody",children:a.map(l=>{var G,Z,x;const h=l.metadata,y=(h==null?void 0:h.package_type)||"personal",k=l.transaction_type==="purchase"&&y==="community",r=v.has(l.id),f=(h==null?void 0:h.gemini_total_tokens)>0,C=(h==null?void 0:h.package_id)||f;return e.jsxs(s,{component:"tbody",sx:{display:"contents"},children:[e.jsxs(s,{component:"tr",sx:{bgcolor:k?"rgba(233, 30, 99, 0.02)":"white","&:hover":{bgcolor:k?"rgba(233, 30, 99, 0.05)":"#f8f9fa"},borderBottom:"1px solid",borderColor:"divider",transition:"background-color 0.2s"},children:[e.jsx(s,{component:"td",sx:{p:1.5,verticalAlign:"middle"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.8,flexWrap:"wrap"},children:[e.jsx(Y,{icon:Fs(l.transaction_type),label:Gs(l.transaction_type),color:Ks(l.transaction_type),size:"small",sx:{fontWeight:600,fontSize:"0.7rem",height:24}}),k&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.3,bgcolor:"#e91e63",color:"white",px:.8,py:.3,borderRadius:1,fontSize:"0.65rem",fontWeight:700},children:[e.jsx(xs,{size:10}),e.jsx("span",{children:"Hero"})]}),l.transaction_type==="usage"&&f&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.3,bgcolor:"rgba(156, 39, 176, 0.1)",color:"#9c27b0",px:.8,py:.3,borderRadius:1,fontSize:"0.65rem",fontWeight:600},children:[e.jsx(_e,{size:10}),e.jsx("span",{children:"AI"})]})]})}),e.jsx(s,{component:"td",sx:{p:1.5,verticalAlign:"middle",display:{xs:"none",sm:"table-cell"}},children:e.jsx(n,{variant:"body2",sx:{fontWeight:500,fontSize:"0.85rem"},children:l.description||"-"})}),e.jsx(s,{component:"td",sx:{p:1.5,textAlign:"right",verticalAlign:"middle"},children:e.jsxs(n,{variant:"body2",sx:{fontWeight:700,color:l.amount>0?"success.main":"error.main",fontSize:"0.9rem"},children:[l.amount>0?"+":"",l.amount]})}),e.jsx(s,{component:"td",sx:{p:1.5,textAlign:"right",verticalAlign:"middle",display:{xs:"none",md:"table-cell"}},children:e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:Os(l.created_at)})}),e.jsx(s,{component:"td",sx:{p:1.5,textAlign:"center",verticalAlign:"middle"},children:C&&e.jsx(le,{size:"small",onClick:()=>L(l.id),sx:{transition:"transform 0.2s",transform:r?"rotate(180deg)":"rotate(0deg)"},children:e.jsx(us,{size:18})})})]}),C&&r&&e.jsx(s,{component:"tr",sx:{bgcolor:"#f8f9fa"},children:e.jsx(s,{component:"td",colSpan:5,sx:{p:2,borderBottom:"1px solid",borderColor:"divider"},children:e.jsxs(s,{sx:{pl:2,borderLeft:"3px solid",borderColor:"divider"},children:[(h==null?void 0:h.package_id)&&e.jsxs(s,{sx:{mb:f?1.5:0},children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,display:"block",mb:.5},children:"Paket-Details:"}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(3, 1fr)"},gap:1},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["ID: ",h.package_id]}),h.amount_paid&&e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["Betrag: ",h.amount_paid,"€"]}),h.credits&&e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.8rem"},children:["Credits: ",h.credits,h.bonus>0&&` + ${h.bonus} Bonus`]})]})]}),f&&e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontWeight:600,display:"block",mb:.5},children:"Gemini Token-Verbrauch:"}),e.jsxs(s,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:1.5},children:[e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Input"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,fontSize:"0.8rem"},children:((G=h.gemini_input_tokens)==null?void 0:G.toLocaleString())||0})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Output"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,fontSize:"0.8rem"},children:((Z=h.gemini_output_tokens)==null?void 0:Z.toLocaleString())||0})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Total"}),e.jsx(n,{variant:"body2",sx:{fontWeight:700,color:"primary.main",fontSize:"0.8rem"},children:((x=h.gemini_total_tokens)==null?void 0:x.toLocaleString())||0})]}),e.jsxs(s,{children:[e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:"Credits"}),e.jsx(n,{variant:"body2",sx:{fontWeight:700,color:"success.main",fontSize:"0.8rem"},children:h.credits_calculated||Math.abs(l.amount)})]})]})]})]})})},`${l.id}-details`)]},l.id)})})]})})]})},Zs=({userId:t,data:o,enabled:p,debounceMs:m=1e3})=>{const[u,b]=d.useState("idle"),[c,B]=d.useState(null),_=d.useRef(null),j=d.useRef(null),I=d.useRef(""),w=d.useRef(!0);return d.useEffect(()=>{if(!p||!t){console.log("⏸️ AutoSave disabled:",{enabled:p,userId:t});return}if(w.current){w.current=!1,I.current=JSON.stringify(o),console.log("🎬 AutoSave initialized");return}const M=JSON.stringify(o);if(M!==I.current)return console.log("📝 Data changed, scheduling save..."),I.current=M,_.current&&clearTimeout(_.current),b("idle"),_.current=setTimeout(async()=>{console.log("💾 Saving to database...",o),b("saving");try{const{error:i}=await K.from("profiles").update(o).eq("id",t);if(i)throw i;console.log("✅ Saved successfully!"),b("saved"),B(new Date),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{b("idle")},3e3)}catch(i){console.error("❌ Auto-save error:",i),b("error"),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{b("idle")},5e3)}},m),()=>{_.current&&clearTimeout(_.current),j.current&&clearTimeout(j.current)}},[t,o,p,m]),{status:u,lastSaved:c}},gn=()=>{const{user:t}=Oe(),o=ne(),p=te(o.breakpoints.down("md")),[m,u]=gs(),[b,c]=d.useState(null),[B,_]=d.useState([]),[j,I]=d.useState(!0),[w,M]=d.useState(null),[i,z]=d.useState(()=>{const x=m.get("section");if(x)return x;const N=localStorage.getItem("settings-last-section");return N&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(N)?N:"profile"}),[v,W]=d.useState(!1),[L,O]=d.useState(!1),[a,l]=d.useState({full_name:"",email:"",phone:"",bio:"",language:"de",notifications_enabled:!0,email_notifications:!0,newsletter_subscribed:!1,show_phone_publicly:!1,ai_text_style:"balanced",ai_text_length:"medium",ai_include_emoji:!1,ai_allow_line_breaks:!1,ai_auto_publish:!1,ai_analyze_all_images:!1,shipping_enabled:!1,shipping_cost:5,shipping_cost_type:"fixed",shipping_description:null,pickup_enabled:!0,show_location_publicly:!1,show_location_to_public:!0,location_description:null,default_listing_duration:30,hand_preference:"right",show_seller_profile:!0}),h=t?{full_name:a.full_name||null,phone:a.phone||null,bio:a.bio||null,language:a.language||null,notifications_enabled:a.notifications_enabled,email_notifications:a.email_notifications,newsletter_subscribed:a.newsletter_subscribed,show_phone_publicly:a.show_phone_publicly,ai_text_style:a.ai_text_style,ai_text_length:a.ai_text_length,ai_include_emoji:a.ai_include_emoji,ai_auto_publish:a.ai_auto_publish,ai_allow_line_breaks:a.ai_allow_line_breaks,ai_analyze_all_images:a.ai_analyze_all_images,shipping_enabled:a.shipping_enabled,shipping_cost:a.shipping_cost,shipping_cost_type:a.shipping_cost_type,shipping_description:a.shipping_description,pickup_enabled:a.pickup_enabled,show_location_publicly:a.show_location_publicly,location_description:a.location_description,default_listing_duration:a.default_listing_duration,show_location_to_public:a.show_location_to_public,hand_preference:a.hand_preference,show_seller_profile:a.show_seller_profile}:{},{status:y,lastSaved:k}=Zs({userId:(t==null?void 0:t.id)||"",data:h,enabled:!!t,debounceMs:1e3}),r=async()=>{if(t){I(!0);try{const{data:x,error:N}=await K.from("profiles").select("*").eq("id",t.id).maybeSingle();if(N)throw N;if(x){c(x);const $={full_name:x.full_name||"",email:x.email||"",phone:x.phone||"",bio:x.bio||"",language:x.language||"de",notifications_enabled:x.notifications_enabled??!0,email_notifications:x.email_notifications??!0,newsletter_subscribed:x.newsletter_subscribed??!1,show_phone_publicly:x.show_phone_publicly??!1,ai_text_style:x.ai_text_style||"balanced",ai_text_length:x.ai_text_length||"medium",ai_include_emoji:x.ai_include_emoji??!1,ai_allow_line_breaks:x.ai_allow_line_breaks??!1,ai_auto_publish:x.ai_auto_publish??!1,ai_analyze_all_images:x.ai_analyze_all_images??!1,shipping_enabled:x.shipping_enabled??!1,shipping_cost:x.shipping_cost??0,shipping_cost_type:x.shipping_cost_type||"fixed",shipping_description:x.shipping_description||null,pickup_enabled:x.pickup_enabled??!0,show_location_publicly:x.show_location_publicly??!1,show_location_to_public:x.show_location_to_public??!0,location_description:x.location_description||null,default_listing_duration:x.default_listing_duration??30,hand_preference:x.hand_preference||"right",show_seller_profile:x.show_seller_profile??!0};l($)}}catch(x){console.error("Error loading profile:",x),M("Fehler beim Laden des Profils")}finally{I(!1)}}},f=(x,N)=>{l($=>({...$,[x]:N}))},C=x=>{const N=Math.floor((new Date().getTime()-x.getTime())/1e3);if(N<10)return"gerade eben";if(N<60)return`vor ${N}s`;const $=Math.floor(N/60);return $<60?`vor ${$}min`:`vor ${Math.floor($/60)}h`};if(d.useEffect(()=>{r()},[t]),d.useEffect(()=>{const x=m.get("section");x&&["overview","profile","security","addresses","shipping","display","ai","notifications","tokens","admin"].includes(x)&&(z(x),localStorage.setItem("settings-last-section",x))},[m]),d.useEffect(()=>{localStorage.setItem("settings-last-section",i),(!m.get("section")||m.get("section")!==i)&&u({section:i})},[i]),j)return e.jsx(Ve,{maxWidth:"xl",sx:{py:4},children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(Q,{size:60})})});const G=()=>{switch(i){case"profile":return e.jsx(Vs,{profile:b,formData:{full_name:a.full_name,email:a.email,phone:a.phone,bio:a.bio,language:a.language},onFormChange:f,userId:(t==null?void 0:t.id)||"",onProfileUpdate:r});case"security":return t?e.jsx(Ds,{userId:t.id}):null;case"addresses":return t?e.jsx(Rs,{userId:t.id}):null;case"shipping":return e.jsx(Ns,{formData:{shipping_enabled:a.shipping_enabled,shipping_cost:a.shipping_cost,shipping_cost_type:a.shipping_cost_type,shipping_description:a.shipping_description,pickup_enabled:a.pickup_enabled,show_location_publicly:a.show_location_publicly,location_description:a.location_description,show_ai_shipping_costs:!1},onFormChange:f});case"display":return e.jsx(Hs,{formData:{language:a.language,show_location_to_public:a.show_location_to_public,default_listing_duration:a.default_listing_duration,hand_preference:a.hand_preference,show_seller_profile:a.show_seller_profile},onFormChange:f});case"ai":return e.jsx(Ms,{formData:{ai_text_style:a.ai_text_style,ai_text_length:a.ai_text_length,ai_include_emoji:a.ai_include_emoji,ai_auto_publish:a.ai_auto_publish,ai_allow_line_breaks:a.ai_allow_line_breaks,ai_analyze_all_images:a.ai_analyze_all_images},onFormChange:f});case"tokens":return e.jsx(Us,{});case"notifications":return e.jsx(Ls,{formData:{notifications_enabled:a.notifications_enabled,email_notifications:a.email_notifications,newsletter_subscribed:a.newsletter_subscribed},onFormChange:f});case"admin":return e.jsx(vs,{});default:return null}},Z=()=>({overview:"Übersicht",profile:"Persönliche Daten",security:"Sicherheit",addresses:"Adressen",shipping:"Versand & Abholung",display:"Anzeige",ai:"KI-Assistent",notifications:"Benachrichtigungen",tokens:"Mein Guthaben",admin:"Administration"})[i];return p?e.jsxs(s,{children:[e.jsx(ms,{position:"sticky",elevation:1,sx:{bgcolor:"background.paper",color:"text.primary"},children:e.jsxs(fs,{children:[e.jsx(le,{edge:"start",onClick:()=>O(!0),sx:{mr:2},children:e.jsx(_s,{size:24})}),e.jsx(n,{variant:"h6",fontWeight:600,children:Z()}),e.jsxs(s,{sx:{ml:"auto"},children:[y==="saving"&&e.jsx(Y,{icon:e.jsx(Le,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),y==="saved"&&k&&e.jsx(Y,{icon:e.jsx(De,{size:14}),label:`Gespeichert ${C(k)}`,size:"small",color:"success",sx:{height:28}})]})]})}),e.jsx(bs,{anchor:"left",open:L,onClose:()=>O(!1),sx:{"& .MuiDrawer-paper":{width:280}},children:e.jsx(Re,{currentSection:i,onSectionChange:x=>{z(x),O(!1)},collapsed:!1,onToggleCollapse:()=>{},isMobile:!0})}),e.jsxs(s,{sx:{py:2,px:2},children:[w&&e.jsx(q,{severity:"error",sx:{mb:2},onClose:()=>M(null),children:w}),G()]})]}):e.jsxs(s,{sx:{display:"flex",minHeight:"calc(100vh - 200px)"},children:[e.jsx(Re,{currentSection:i,onSectionChange:z,collapsed:v,onToggleCollapse:()=>W(!v)}),e.jsxs(s,{sx:{flex:1,pl:4,pr:4,py:4,position:"relative"},children:[e.jsxs(s,{sx:{position:"fixed",top:80,right:24,zIndex:1e3},children:[y==="saving"&&e.jsx(Y,{icon:e.jsx(Le,{size:14,style:{animation:"spin 1s linear infinite"}}),label:"Speichert...",size:"small",sx:{height:28}}),y==="saved"&&k&&e.jsx(Y,{icon:e.jsx(De,{size:14}),label:`Gespeichert ${C(k)}`,size:"small",color:"success",sx:{height:28}})]}),e.jsxs(Ve,{maxWidth:"lg",disableGutters:!0,children:[w&&e.jsx(q,{severity:"error",sx:{mb:3},onClose:()=>M(null),children:w}),G()]})]})]})};export{gn as SettingsPage};
