import{x,r as b,j as o,B as i,T as l,H as w,f as A}from"./index-BSuyEbhb.js";const k=()=>{const a=x(),[h,n]=b.useState(null);if(b.useEffect(()=>{(async()=>{try{const r=window.location.href,e=new URLSearchParams(window.location.search),g=e.get("platform")==="ios";if(console.log("[OAuth Callback] Processing URL:",r),console.log("[OAuth Callback] Platform:",g?"Native iOS (from URL param)":"Web"),console.log("[OAuth Callback] All URL parameters:"),e.forEach((c,t)=>{console.log(`  - ${t}: ${c}`)}),g){console.log("[OAuth Callback] Native iOS request detected - redirecting to app...");const c=e.get("code"),t=e.get("error"),f=e.get("error_description");if(t){console.error("[OAuth Callback] OAuth Error:",t),console.error("[OAuth Callback] Error Description:",f),n(`OAuth Fehler: ${f||t}`);return}if(!c){console.error("[OAuth Callback] No code in URL"),n("Kein Autorisierungscode gefunden.");return}const m=new URLSearchParams(window.location.search);m.delete("platform");const p=`habdawas://auth/callback?${m.toString()}`;console.log("[OAuth Callback] Redirecting to:",p),window.location.href=p;return}console.log("[OAuth Callback] Web platform - exchanging code for session...");const{error:d}=await A.auth.exchangeCodeForSession(r);if(d){console.error("[OAuth Callback] Exchange error:",d),n("Anmeldung fehlgeschlagen. Bitte versuche es erneut."),setTimeout(()=>a("/"),3e3);return}console.log("[OAuth Callback] Success! Redirecting to home..."),a("/",{replace:!0})}catch(r){console.error("[OAuth Callback] Error:",r),n("Ein Fehler ist aufgetreten. Du wirst weitergeleitet..."),setTimeout(()=>a("/"),3e3)}})()},[a]),h){const u=new URLSearchParams(window.location.search),r=[];return u.forEach((e,s)=>{r.push(`${s}: ${e}`)}),o.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2,p:3},children:[o.jsx(l,{variant:"h6",color:"error",children:h}),r.length>0&&o.jsxs(i,{sx:{mt:2,p:2,bgcolor:"#f5f5f5",borderRadius:1,width:"100%",maxWidth:500},children:[o.jsx(l,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"Debug Info:"}),r.map((e,s)=>o.jsx(l,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.8rem"},children:e},s))]})]})}return o.jsxs(i,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",gap:2},children:[o.jsx(w,{size:60}),o.jsx(l,{variant:"h6",children:"Anmeldung wird verarbeitet..."})]})};export{k as OAuthCallbackPage};
