import{aV as rn,aW as sn,r as g,aX as an,j as e,c as Ce,aY as on,aZ as ln,b as Se,g as ke,a_ as cn,s as Me,u as _e,h as Pe,a as $e,m as ft,a$ as ze,e as ge,n as Bt,f as R,P as G,B as C,w as ve,aq as It,ar as dn,N as Ve,O as Xe,av as it,Q as Ne,aQ as ot,ax as xt,ak as un,i as Ee,x as Ft,H as le,t as U,az as he,ap as hn,ae as je,ah as Ae,ai as we,L as D,b0 as mn,T as m,K as I,at as Nt,M as Lt,C as gn,W as Ut,D as Ke,p as Ze,q as et,A as H,v as tt,l as Z,aB as ie,aC as oe,b1 as ht,b2 as K,ad as fn,b3 as xn,o as pn,aP as Ht,aH as yn,af as bn,a5 as jt,am as jn,aS as Gt,b4 as wn,b5 as Je,b6 as vn,ag as Cn,I as Sn,aR as kn,aM as Mn,X as _n,R as Pn,aT as Tn}from"./index-kFPCxDRP.js";import{C as Wn,a as Dn}from"./chevron-right-C5Yo7UpY.js";import{C as Yt}from"./credit-card-B1cngNg0.js";import{S as pt}from"./Snackbar-ojQY2fo9.js";import{A as qt}from"./alert-circle-B4U78Sn6.js";import{P as zn}from"./plus-BjnUYxU5.js";import{A as An,a as Rn,b as On}from"./AccordionSummary-B1G0oEVo.js";import{C as $n}from"./calendar-nw68jU7U.js";import{a as be,f as L,u as Qt}from"./useSystemSettings-DRyNq9BN.js";import{D as yt}from"./dollar-sign-BXZP7t6V.js";import{R as En,a as wt}from"./RadioGroup-ClnBJre2.js";import{G as mt}from"./gift-DYT4blHw.js";import{S as Bn}from"./save-Vqc6iNuh.js";const In=(t,r)=>t.filter(n=>r.includes(n)),Be=(t,r,n)=>{const s=t.keys[0];Array.isArray(r)?r.forEach((a,i)=>{n((l,d)=>{i<=t.keys.length-1&&(i===0?Object.assign(l,d):l[t.up(t.keys[i])]=d)},a)}):r&&typeof r=="object"?(Object.keys(r).length>t.keys.length?t.keys:In(t.keys,Object.keys(r))).forEach(i=>{if(t.keys.includes(i)){const l=r[i];l!==void 0&&n((d,f)=>{s===i?Object.assign(d,f):d[t.up(i)]=f},l)}}):(typeof r=="number"||typeof r=="string")&&n((a,i)=>{Object.assign(a,i)},r)};function nt(t){return`--Grid-${t}Spacing`}function lt(t){return`--Grid-parent-${t}Spacing`}const vt="--Grid-columns",Re="--Grid-parent-columns",Fn=({theme:t,ownerState:r})=>{const n={};return Be(t.breakpoints,r.size,(s,a)=>{let i={};a==="grow"&&(i={flexBasis:0,flexGrow:1,maxWidth:"100%"}),a==="auto"&&(i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"}),typeof a=="number"&&(i={flexGrow:0,flexBasis:"auto",width:`calc(100% * ${a} / var(${Re}) - (var(${Re}) - ${a}) * (var(${lt("column")}) / var(${Re})))`}),s(n,i)}),n},Nn=({theme:t,ownerState:r})=>{const n={};return Be(t.breakpoints,r.offset,(s,a)=>{let i={};a==="auto"&&(i={marginLeft:"auto"}),typeof a=="number"&&(i={marginLeft:a===0?"0px":`calc(100% * ${a} / var(${Re}) + var(${lt("column")}) * ${a} / var(${Re}))`}),s(n,i)}),n},Ln=({theme:t,ownerState:r})=>{if(!r.container)return{};const n={[vt]:12};return Be(t.breakpoints,r.columns,(s,a)=>{const i=a??12;s(n,{[vt]:i,"> *":{[Re]:i}})}),n},Un=({theme:t,ownerState:r})=>{if(!r.container)return{};const n={};return Be(t.breakpoints,r.rowSpacing,(s,a)=>{var l;const i=typeof a=="string"?a:(l=t.spacing)==null?void 0:l.call(t,a);s(n,{[nt("row")]:i,"> *":{[lt("row")]:i}})}),n},Hn=({theme:t,ownerState:r})=>{if(!r.container)return{};const n={};return Be(t.breakpoints,r.columnSpacing,(s,a)=>{var l;const i=typeof a=="string"?a:(l=t.spacing)==null?void 0:l.call(t,a);s(n,{[nt("column")]:i,"> *":{[lt("column")]:i}})}),n},Gn=({theme:t,ownerState:r})=>{if(!r.container)return{};const n={};return Be(t.breakpoints,r.direction,(s,a)=>{s(n,{flexDirection:a})}),n},Yn=({ownerState:t})=>({minWidth:0,boxSizing:"border-box",...t.container&&{display:"flex",flexWrap:"wrap",...t.wrap&&t.wrap!=="wrap"&&{flexWrap:t.wrap},gap:`var(${nt("row")}) var(${nt("column")})`}}),qn=t=>{const r=[];return Object.entries(t).forEach(([n,s])=>{s!==!1&&s!==void 0&&r.push(`grid-${n}-${String(s)}`)}),r},Qn=(t,r="xs")=>{function n(s){return s===void 0?!1:typeof s=="string"&&!Number.isNaN(Number(s))||typeof s=="number"&&s>0}if(n(t))return[`spacing-${r}-${String(t)}`];if(typeof t=="object"&&!Array.isArray(t)){const s=[];return Object.entries(t).forEach(([a,i])=>{n(i)&&s.push(`spacing-${a}-${String(i)}`)}),s}return[]},Jn=t=>t===void 0?[]:typeof t=="object"?Object.entries(t).map(([r,n])=>`direction-${r}-${n}`):[`direction-xs-${String(t)}`];function Vn(t,r){t.item!==void 0&&delete t.item,t.zeroMinWidth!==void 0&&delete t.zeroMinWidth,r.keys.forEach(n=>{t[n]!==void 0&&delete t[n]})}const Xn=cn(),Kn=rn("div",{name:"MuiGrid",slot:"Root"});function Zn(t){return ln({props:t,name:"MuiGrid",defaultTheme:Xn})}function er(t={}){const{createStyledComponent:r=Kn,useThemeProps:n=Zn,useTheme:s=sn,componentName:a="MuiGrid"}=t,i=(x,o)=>{const{container:p,direction:S,spacing:h,wrap:u,size:w}=x,k={root:["root",p&&"container",u!=="wrap"&&`wrap-xs-${String(u)}`,...Jn(S),...qn(w),...p?Qn(h,o.breakpoints.keys[0]):[]]};return Se(k,A=>ke(a,A),{})};function l(x,o,p=()=>!0){const S={};return x===null||(Array.isArray(x)?x.forEach((h,u)=>{h!==null&&p(h)&&o.keys[u]&&(S[o.keys[u]]=h)}):typeof x=="object"?Object.keys(x).forEach(h=>{const u=x[h];u!=null&&p(u)&&(S[h]=u)}):S[o.keys[0]]=x),S}const d=r(Ln,Hn,Un,Fn,Gn,Yn,Nn),f=g.forwardRef(function(o,p){const S=s(),h=n(o),u=an(h);Vn(u,S.breakpoints);const{className:w,children:k,columns:A=12,container:y=!1,component:v="div",direction:M="row",wrap:W="wrap",size:E={},offset:z={},spacing:F=0,rowSpacing:Q=F,columnSpacing:P=F,unstable_level:J=0,...Ie}=u,ce=l(E,S.breakpoints,c=>c!==!1),fe=l(z,S.breakpoints),Te=o.columns??(J?void 0:A),Fe=o.spacing??(J?void 0:F),ne=o.rowSpacing??o.spacing??(J?void 0:Q),Y=o.columnSpacing??o.spacing??(J?void 0:P),de={...u,level:J,columns:Te,container:y,direction:M,wrap:W,spacing:Fe,rowSpacing:ne,columnSpacing:Y,size:ce,offset:fe},xe=i(de,S);return e.jsx(d,{ref:p,as:v,ownerState:de,className:Ce(xe.root,w),...Ie,children:g.Children.map(k,c=>{var _;return g.isValidElement(c)&&on(c,["Grid"])&&y&&c.props.container?g.cloneElement(c,{unstable_level:((_=c.props)==null?void 0:_.unstable_level)??J+1}):c})})});return f.muiName="Grid",f}const $=er({createStyledComponent:Me("div",{name:"MuiGrid",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,n.container&&r.container]}}),componentName:"MuiGrid",useThemeProps:t=>_e({props:t,name:"MuiGrid"}),useTheme:Pe}),Jt=g.createContext();function tr(t){return ke("MuiTable",t)}$e("MuiTable",["root","stickyHeader"]);const nr=t=>{const{classes:r,stickyHeader:n}=t;return Se({root:["root",n&&"stickyHeader"]},tr,r)},rr=Me("table",{name:"MuiTable",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,n.stickyHeader&&r.stickyHeader]}})(ft(({theme:t})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...t.typography.body2,padding:t.spacing(2),color:(t.vars||t).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:r})=>r.stickyHeader,style:{borderCollapse:"separate"}}]}))),Ct="table",Ue=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTable"}),{className:a,component:i=Ct,padding:l="normal",size:d="medium",stickyHeader:f=!1,...x}=s,o={...s,component:i,padding:l,size:d,stickyHeader:f},p=nr(o),S=g.useMemo(()=>({padding:l,size:d,stickyHeader:f}),[l,d,f]);return e.jsx(Jt.Provider,{value:S,children:e.jsx(rr,{as:i,role:i===Ct?null:"table",ref:n,className:Ce(p.root,a),ownerState:o,...x})})}),ct=g.createContext();function sr(t){return ke("MuiTableBody",t)}$e("MuiTableBody",["root"]);const ar=t=>{const{classes:r}=t;return Se({root:["root"]},sr,r)},ir=Me("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),or={variant:"body"},St="tbody",He=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableBody"}),{className:a,component:i=St,...l}=s,d={...s,component:i},f=ar(d);return e.jsx(ct.Provider,{value:or,children:e.jsx(ir,{className:Ce(f.root,a),as:i,ref:n,role:i===St?null:"rowgroup",ownerState:d,...l})})});function lr(t){return ke("MuiTableCell",t)}const cr=$e("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),dr=t=>{const{classes:r,variant:n,align:s,padding:a,size:i,stickyHeader:l}=t,d={root:["root",n,l&&"stickyHeader",s!=="inherit"&&`align${ze(s)}`,a!=="normal"&&`padding${ze(a)}`,`size${ze(i)}`]};return Se(d,lr,r)},ur=Me("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,r[n.variant],r[`size${ze(n.size)}`],n.padding!=="normal"&&r[`padding${ze(n.padding)}`],n.align!=="inherit"&&r[`align${ze(n.align)}`],n.stickyHeader&&r.stickyHeader]}})(ft(({theme:t})=>({...t.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:t.vars?`1px solid ${t.vars.palette.TableCell.border}`:`1px solid
    ${t.palette.mode==="light"?t.lighten(t.alpha(t.palette.divider,1),.88):t.darken(t.alpha(t.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(t.vars||t).palette.text.primary,lineHeight:t.typography.pxToRem(24),fontWeight:t.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(t.vars||t).palette.text.primary}},{props:{variant:"footer"},style:{color:(t.vars||t).palette.text.secondary,lineHeight:t.typography.pxToRem(21),fontSize:t.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${cr.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:r})=>r.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(t.vars||t).palette.background.default}}]}))),b=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableCell"}),{align:a="inherit",className:i,component:l,padding:d,scope:f,size:x,sortDirection:o,variant:p,...S}=s,h=g.useContext(Jt),u=g.useContext(ct),w=u&&u.variant==="head";let k;l?k=l:k=w?"th":"td";let A=f;k==="td"?A=void 0:!A&&w&&(A="col");const y=p||u&&u.variant,v={...s,align:a,component:k,padding:d||(h&&h.padding?h.padding:"normal"),size:x||(h&&h.size?h.size:"medium"),sortDirection:o,stickyHeader:y==="head"&&h&&h.stickyHeader,variant:y},M=dr(v);let W=null;return o&&(W=o==="asc"?"ascending":"descending"),e.jsx(ur,{as:k,ref:n,className:Ce(M.root,i),"aria-sort":W,scope:A,ownerState:v,...S})});function hr(t){return ke("MuiTableContainer",t)}$e("MuiTableContainer",["root"]);const mr=t=>{const{classes:r}=t;return Se({root:["root"]},hr,r)},gr=Me("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),Ge=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableContainer"}),{className:a,component:i="div",...l}=s,d={...s,component:i},f=mr(d);return e.jsx(gr,{ref:n,as:i,className:Ce(f.root,a),ownerState:d,...l})});function fr(t){return ke("MuiTableHead",t)}$e("MuiTableHead",["root"]);const xr=t=>{const{classes:r}=t;return Se({root:["root"]},fr,r)},pr=Me("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),yr={variant:"head"},kt="thead",Ye=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableHead"}),{className:a,component:i=kt,...l}=s,d={...s,component:i},f=xr(d);return e.jsx(ct.Provider,{value:yr,children:e.jsx(pr,{as:i,className:Ce(f.root,a),ref:n,role:i===kt?null:"rowgroup",ownerState:d,...l})})});function br(t){return ke("MuiTableRow",t)}const Mt=$e("MuiTableRow",["root","selected","hover","head","footer"]),jr=t=>{const{classes:r,selected:n,hover:s,head:a,footer:i}=t;return Se({root:["root",n&&"selected",s&&"hover",a&&"head",i&&"footer"]},br,r)},wr=Me("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.root,n.head&&r.head,n.footer&&r.footer]}})(ft(({theme:t})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${Mt.hover}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${Mt.selected}`]:{backgroundColor:t.alpha((t.vars||t).palette.primary.main,(t.vars||t).palette.action.selectedOpacity),"&:hover":{backgroundColor:t.alpha((t.vars||t).palette.primary.main,`${(t.vars||t).palette.action.selectedOpacity} + ${(t.vars||t).palette.action.hoverOpacity}`)}}}))),_t="tr",q=g.forwardRef(function(r,n){const s=_e({props:r,name:"MuiTableRow"}),{className:a,component:i=_t,hover:l=!1,selected:d=!1,...f}=s,x=g.useContext(ct),o={...s,component:i,hover:l,selected:d,head:x&&x.variant==="head",footer:x&&x.variant==="footer"},p=jr(o);return e.jsx(wr,{as:i,ref:n,className:Ce(p.root,a),role:i===_t?null:"row",ownerState:o,...f})});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=ge("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=ge("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=ge("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kr=ge("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mr=ge("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=ge("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=ge("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=ge("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),bt=()=>{const{user:t}=Bt(),[r,n]=g.useState(!1),[s,a]=g.useState(!0);return g.useEffect(()=>{(async()=>{if(!t){n(!1),a(!1);return}const{data:v}=await R.from("profiles").select("is_admin").eq("id",t.id).maybeSingle();if((v==null?void 0:v.is_admin)===!0){n(!0),a(!1);return}const{data:M}=await R.rpc("get_user_roles",{check_user_id:t.id}),W=M==null?void 0:M.some(E=>E.role_name==="admin");n(W||!1),a(!1)})()},[t]),{isAdmin:r,loading:s,getSystemSettings:async()=>{const{data:y,error:v}=await R.from("system_settings").select("*").limit(1).maybeSingle();if(v)throw v;return y},updateSystemSettings:async y=>{const{data:v}=await R.from("system_settings").select("id").limit(1).maybeSingle();if(!v)throw new Error("System settings not found");const{error:M}=await R.from("system_settings").update({...y,updated_at:new Date().toISOString(),updated_by:t==null?void 0:t.id}).eq("id",v.id);if(M)throw M},getAllUsers:async()=>{const{data:y,error:v}=await R.rpc("get_all_users_admin");if(v)throw v;return y||[]},suspendUser:async(y,v)=>{const{error:M}=await R.rpc("suspend_user_admin",{target_user_id:y,reason:v});if(M)throw M},unsuspendUser:async y=>{const{error:v}=await R.rpc("unsuspend_user_admin",{target_user_id:y});if(v)throw v},deleteUser:async y=>{const{error:v}=await R.rpc("delete_user_admin",{target_user_id:y});if(v)throw v},updateUserTokens:async(y,v)=>{const{error:M}=await R.from("user_tokens").update({balance:v}).eq("user_id",y);if(M)throw M},getAllRoles:async()=>{const{data:y,error:v}=await R.rpc("get_all_roles_with_permissions");if(v)throw v;return y||[]},getUserRoles:async y=>{const{data:v,error:M}=await R.rpc("get_user_roles",{check_user_id:y});if(M)throw M;return v||[]},assignRole:async(y,v)=>{const{error:M}=await R.rpc("assign_role_to_user",{target_user_id:y,target_role_id:v});if(M)throw M},removeRole:async(y,v)=>{const{error:M}=await R.rpc("remove_role_from_user",{target_user_id:y,target_role_id:v});if(M)throw M},getUserPermissions:async y=>{const{data:v,error:M}=await R.rpc("get_user_permissions",{check_user_id:y});if(M)throw M;return v||[]},hasPermission:async y=>{if(!t)return!1;const{data:v,error:M}=await R.rpc("user_has_permission",{check_user_id:t.id,permission_name:y});return M?!1:v||!1}}},Pt=({currentSection:t,onSectionChange:r,collapsed:n,onToggleCollapse:s,isMobile:a=!1})=>{const i=[{id:"users",label:"Benutzerverwaltung",icon:e.jsx(ot,{size:20})},{id:"roles",label:"Rollen & Rechte",icon:e.jsx(xt,{size:20})},{id:"credits",label:"Credit-System",icon:e.jsx(un,{size:20})},{id:"tasks",label:"Aufgaben",icon:e.jsx(Mr,{size:20})}];return e.jsxs(G,{elevation:0,sx:{width:a?"100%":n?72:260,transition:"width 0.3s ease",height:a?"100%":"100vh",borderRight:a?0:1,borderColor:"divider",borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",position:a?"relative":"sticky",top:0,left:0},children:[!a&&e.jsx(C,{sx:{display:"flex",justifyContent:n?"center":"flex-end",p:1.5,borderBottom:1,borderColor:"divider"},children:e.jsx(ve,{onClick:s,size:"small",sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:n?e.jsx(Wn,{size:18}):e.jsx(Dn,{size:18})})}),e.jsx(It,{sx:{pt:2,pb:2},children:i.map((l,d)=>{const f=e.jsxs(dn,{onClick:()=>r(l.id),selected:t===l.id,sx:{mb:.5,mx:n&&!a?1:1.5,borderRadius:2,minHeight:48,justifyContent:n&&!a?"center":"flex-start",px:n&&!a?0:2,"&.Mui-selected":{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"},"& .MuiListItemIcon-root":{color:"white"}},"&:hover":{bgcolor:n&&!a?"action.hover":"action.selected"}},children:[e.jsx(Ve,{sx:{minWidth:n&&!a?"auto":40,justifyContent:"center",color:t===l.id?"inherit":"text.secondary"},children:l.icon}),(!n||a)&&e.jsx(Xe,{primary:l.label,primaryTypographyProps:{fontWeight:t===l.id?600:400,fontSize:"0.95rem"}})]},l.id),x=a?f:e.jsx(it,{title:n?l.label:"",placement:"right",arrow:!0,children:f},l.id);return l.id==="tasks"?e.jsxs(C,{children:[e.jsx(Ne,{sx:{my:2,mx:2}}),x]},l.id):x})})]})},Tt=()=>{const t=Pe();Ee(t.breakpoints.down("md"));const r=Ft(),{getAllUsers:n,suspendUser:s,unsuspendUser:a,deleteUser:i,getUserRoles:l,assignRole:d,removeRole:f,getAllRoles:x}=bt(),[o,p]=g.useState([]),[S,h]=g.useState(!1),[u,w]=g.useState({open:!1,message:"",severity:"success"}),[k,A]=g.useState(""),[y,v]=g.useState("all"),[M,W]=g.useState("all"),[E,z]=g.useState("newest"),[F,Q]=g.useState(null),[P,J]=g.useState(null),[Ie,ce]=g.useState(!1),[fe,Te]=g.useState(""),[Fe,ne]=g.useState(!1),[Y,de]=g.useState(!1),[xe,c]=g.useState([]),[_,B]=g.useState([]);g.useEffect(()=>{N()},[]);const N=async()=>{h(!0);try{const j=await n(),T=await Promise.all(j.map(async V=>{const ut=await l(V.id);return{...V,roles:ut}}));p(T)}catch(j){w({open:!0,message:`Fehler beim Laden: ${j.message}`,severity:"error"})}finally{h(!1)}},pe=(j,T)=>{Q(j.currentTarget),J(T)},re=()=>{Q(null)},qe=async()=>{if(P){try{await s(P.id,fe),w({open:!0,message:"Benutzer erfolgreich gesperrt",severity:"success"}),ce(!1),Te(""),await N()}catch(j){w({open:!0,message:`Fehler: ${j.message}`,severity:"error"})}re()}},se=async()=>{if(P){try{await a(P.id),w({open:!0,message:"Sperrung erfolgreich aufgehoben",severity:"success"}),await N()}catch(j){w({open:!0,message:`Fehler: ${j.message}`,severity:"error"})}re()}},ae=async()=>{if(P){try{await i(P.id),w({open:!0,message:"Benutzer erfolgreich gelöscht",severity:"success"}),ne(!1),await N()}catch(j){w({open:!0,message:`Fehler: ${j.message}`,severity:"error"})}re()}},Qe=j=>new Date(j).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),We=g.useMemo(()=>{let j=[...o];if(k.trim()){const T=k.toLowerCase();j=j.filter(V=>V.email.toLowerCase().includes(T)||V.full_name&&V.full_name.toLowerCase().includes(T))}return y==="active"?j=j.filter(T=>!T.is_suspended):y==="suspended"&&(j=j.filter(T=>T.is_suspended)),M==="admin"?j=j.filter(T=>T.is_admin):M==="user"&&(j=j.filter(T=>!T.is_admin)),j.sort((T,V)=>{if(E==="newest")return new Date(V.created_at).getTime()-new Date(T.created_at).getTime();if(E==="oldest")return new Date(T.created_at).getTime()-new Date(V.created_at).getTime();{const ut=T.full_name||T.email,nn=V.full_name||V.email;return ut.localeCompare(nn)}}),j},[o,k,y,M,E]);return S&&o.length===0?e.jsx(C,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(le,{})}):e.jsxs(C,{children:[e.jsxs(G,{sx:{mb:3},children:[e.jsxs(C,{sx:{p:{xs:2,md:3},borderBottom:1,borderColor:"divider"},children:[e.jsxs($,{container:!0,spacing:{xs:2,md:3},alignItems:"center",children:[e.jsx($,{size:{xs:12,md:4},children:e.jsx(U,{fullWidth:!0,placeholder:"Nach E-Mail oder Name suchen...",value:k,onChange:j=>A(j.target.value),InputProps:{startAdornment:e.jsx(he,{position:"start",children:e.jsx(hn,{size:20})})},size:"small"})}),e.jsx($,{size:{xs:12,sm:6,md:2.5},children:e.jsxs(je,{fullWidth:!0,size:"small",children:[e.jsx(Ae,{children:"Status"}),e.jsxs(we,{value:y,label:"Status",onChange:j=>v(j.target.value),children:[e.jsx(D,{value:"all",children:"Alle"}),e.jsx(D,{value:"active",children:"Aktiv"}),e.jsx(D,{value:"suspended",children:"Gesperrt"})]})]})}),e.jsx($,{size:{xs:12,sm:6,md:2.5},children:e.jsxs(je,{fullWidth:!0,size:"small",children:[e.jsx(Ae,{children:"Rolle"}),e.jsxs(we,{value:M,label:"Rolle",onChange:j=>W(j.target.value),children:[e.jsx(D,{value:"all",children:"Alle"}),e.jsx(D,{value:"admin",children:"Admins"}),e.jsx(D,{value:"user",children:"User"})]})]})}),e.jsx($,{size:{xs:12,sm:6,md:3},children:e.jsxs(je,{fullWidth:!0,size:"small",children:[e.jsx(Ae,{children:"Sortierung"}),e.jsxs(we,{value:E,label:"Sortierung",onChange:j=>z(j.target.value),children:[e.jsx(D,{value:"newest",children:"Neueste zuerst"}),e.jsx(D,{value:"oldest",children:"Älteste zuerst"}),e.jsx(D,{value:"name",children:"Nach Name"})]})]})})]}),e.jsxs(C,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(mn,{size:16,color:t.palette.text.secondary}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:[We.length," von ",o.length," Benutzer",We.length!==o.length&&" (gefiltert)"]})]})]}),e.jsx(Ge,{children:e.jsxs(Ue,{children:[e.jsx(Ye,{children:e.jsxs(q,{children:[e.jsx(b,{children:"E-Mail"}),e.jsx(b,{children:"Name"}),e.jsx(b,{children:"Rollen"}),e.jsx(b,{children:"Registriert"}),e.jsx(b,{align:"center",children:"Status"}),e.jsx(b,{align:"center",children:"Items"}),e.jsx(b,{align:"center",children:"Nachrichten"}),e.jsx(b,{align:"center",children:"Aktionen"})]})}),e.jsx(He,{children:We.length===0?e.jsx(q,{children:e.jsx(b,{colSpan:8,align:"center",sx:{py:4},children:e.jsx(m,{variant:"body2",color:"text.secondary",children:"Keine Benutzer gefunden"})})}):We.map(j=>e.jsxs(q,{hover:!0,children:[e.jsxs(b,{children:[j.email,j.is_admin&&e.jsx(I,{label:"Super Admin",size:"small",color:"error",sx:{ml:1}})]}),e.jsx(b,{children:j.full_name||"-"}),e.jsx(b,{children:e.jsx(C,{display:"flex",gap:.5,flexWrap:"wrap",children:j.roles&&j.roles.length>0?j.roles.map(T=>e.jsx(I,{label:T.display_name,size:"small",variant:"outlined"},T.role_id)):e.jsx(m,{variant:"body2",color:"text.secondary",children:"-"})})}),e.jsx(b,{children:Qe(j.created_at)}),e.jsx(b,{align:"center",children:j.is_suspended?e.jsx(it,{title:j.suspended_reason||"Gesperrt",children:e.jsx(I,{label:"Gesperrt",size:"small",color:"error"})}):e.jsx(I,{label:"Aktiv",size:"small",color:"success"})}),e.jsx(b,{align:"center",children:e.jsx(I,{label:j.item_count,size:"small",variant:"outlined",onClick:()=>r(`/?seller=${j.id}`),sx:{cursor:"pointer"}})}),e.jsx(b,{align:"center",children:j.message_count}),e.jsx(b,{align:"center",children:e.jsx(ve,{size:"small",onClick:T=>pe(T,j),disabled:j.is_admin,children:e.jsx(Nt,{size:20})})})]},j.id))})]})})]}),e.jsxs(Lt,{anchorEl:F,open:!!F,onClose:re,children:[e.jsxs(D,{onClick:async()=>{if(P){const j=await l(P.id),T=await x();c(j),B(T),de(!0)}},children:[e.jsx(xt,{size:18,style:{marginRight:8}}),"Rollen verwalten"]}),e.jsxs(D,{onClick:()=>P&&r(`/?seller=${P.id}`),children:[e.jsx(Yt,{size:18,style:{marginRight:8}}),"Items anzeigen"]}),P!=null&&P.is_suspended?e.jsxs(D,{onClick:se,children:[e.jsx(gn,{size:18,style:{marginRight:8}}),"Entsperren"]}):e.jsxs(D,{onClick:()=>ce(!0),sx:{color:"warning.main"},children:[e.jsx(vr,{size:18,style:{marginRight:8}}),"Sperren"]}),e.jsxs(D,{onClick:()=>ne(!0),sx:{color:"error.main"},children:[e.jsx(Ut,{size:18,style:{marginRight:8}}),"Löschen"]})]}),e.jsxs(Ke,{open:Ie,onClose:()=>ce(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ze,{children:"Benutzer sperren"}),e.jsxs(et,{children:[e.jsx(H,{severity:"warning",sx:{mb:2},children:"Der Benutzer kann sich nicht mehr anmelden und keine Items erstellen oder bearbeiten."}),e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsx(U,{label:"Grund für Sperrung",fullWidth:!0,multiline:!0,rows:3,value:fe,onChange:j=>Te(j.target.value),placeholder:"Z.B.: Verstoß gegen Nutzungsbedingungen"})]}),e.jsxs(tt,{children:[e.jsx(Z,{onClick:()=>ce(!1),children:"Abbrechen"}),e.jsx(Z,{variant:"contained",color:"warning",onClick:qe,disabled:!fe.trim(),children:"Sperren"})]})]}),e.jsxs(Ke,{open:Fe,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ze,{children:"Benutzer löschen"}),e.jsxs(et,{children:[e.jsx(H,{severity:"error",sx:{mb:2},children:"Diese Aktion kann nicht rückgängig gemacht werden! Alle Daten des Benutzers werden unwiderruflich gelöscht."}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Items: ",e.jsx("strong",{children:P==null?void 0:P.item_count})]}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Nachrichten: ",e.jsx("strong",{children:P==null?void 0:P.message_count})]})]}),e.jsxs(tt,{children:[e.jsx(Z,{onClick:()=>ne(!1),children:"Abbrechen"}),e.jsx(Z,{variant:"contained",color:"error",onClick:ae,children:"Unwiderruflich löschen"})]})]}),e.jsxs(Ke,{open:Y,onClose:()=>de(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ze,{children:"Rollen verwalten"}),e.jsxs(et,{children:[e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Benutzer: ",e.jsx("strong",{children:P==null?void 0:P.email})]}),e.jsx(m,{variant:"subtitle2",sx:{mt:2,mb:1},children:"Aktuelle Rollen:"}),e.jsx(C,{display:"flex",gap:1,flexWrap:"wrap",mb:2,children:xe.length>0?xe.map(j=>e.jsx(I,{label:j.display_name,onDelete:async()=>{if(P)try{await f(P.id,j.role_id);const T=await l(P.id);c(T),w({open:!0,message:"Rolle erfolgreich entfernt",severity:"success"}),await N()}catch(T){w({open:!0,message:`Fehler: ${T.message}`,severity:"error"})}}},j.role_id)):e.jsx(m,{variant:"body2",color:"text.secondary",children:"Keine Rollen zugewiesen"})}),e.jsx(m,{variant:"subtitle2",sx:{mt:3,mb:1},children:"Rolle hinzufügen:"}),e.jsx(C,{display:"flex",gap:1,flexWrap:"wrap",children:_.filter(j=>!xe.some(T=>T.role_id===j.role_id)).map(j=>e.jsx(I,{label:j.display_name,onClick:async()=>{if(P)try{await d(P.id,j.role_id);const T=await l(P.id);c(T),w({open:!0,message:"Rolle erfolgreich zugewiesen",severity:"success"}),await N()}catch(T){w({open:!0,message:`Fehler: ${T.message}`,severity:"error"})}},variant:"outlined",sx:{cursor:"pointer"}},j.role_id))})]}),e.jsx(tt,{children:e.jsx(Z,{onClick:()=>de(!1),children:"Schließen"})})]}),e.jsx(pt,{open:u.open,autoHideDuration:6e3,onClose:()=>w({...u,open:!1}),children:e.jsx(H,{severity:u.severity,onClose:()=>w({...u,open:!1}),children:u.message})})]})},Tr=()=>{const t=Pe();Ee(t.breakpoints.down("md"));const{getAllRoles:r}=bt(),[n,s]=g.useState([]),[a,i]=g.useState(!1),[l,d]=g.useState({open:!1,message:"",severity:"success"});g.useEffect(()=>{f()},[]);const f=async()=>{i(!0);try{const o=await r();s(o)}catch(o){console.error("Error loading roles:",o),d({open:!0,message:"Fehler beim Laden der Rollen",severity:"error"})}finally{i(!1)}},x=o=>{switch(o){case"admin":return"error";case"moderator":return"warning";case"support":return"info";case"content_reviewer":return"success";default:return"default"}};return a?e.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(le,{})}):e.jsxs(C,{children:[e.jsx(m,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Rollen-Übersicht"}),e.jsx($,{container:!0,spacing:{xs:2,md:3},sx:{mb:4},children:n.map(o=>e.jsx($,{size:{xs:12,sm:6,md:3},children:e.jsx(ie,{elevation:1,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{elevation:3,transform:"translateY(-2px)"}},children:e.jsxs(oe,{sx:{display:"flex",flexDirection:"column",height:"100%",p:{xs:2,md:3}},children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:2,children:[e.jsx(xt,{size:24,color:t.palette.primary.main,style:{marginRight:8}}),e.jsx(m,{variant:"h6",component:"div",fontWeight:600,children:o.display_name})]}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:"auto",minHeight:40,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:o.description}),e.jsxs(C,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{pt:2,mt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ot,{size:16,color:t.palette.text.secondary}),e.jsx(m,{variant:"body2",fontWeight:500,children:o.user_count})]}),e.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(kr,{size:16,color:t.palette.text.secondary}),e.jsx(m,{variant:"body2",fontWeight:500,children:o.permission_count})]})]})]})})},o.role_id))}),e.jsx(Ne,{sx:{my:4}}),e.jsx(m,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Rollen-Details"}),e.jsx(G,{elevation:1,sx:{mb:4},children:e.jsx(Ge,{children:e.jsxs(Ue,{children:[e.jsx(Ye,{children:e.jsxs(q,{children:[e.jsx(b,{children:"Rolle"}),e.jsx(b,{children:"Beschreibung"}),e.jsx(b,{align:"center",children:"Berechtigungen"}),e.jsx(b,{align:"center",children:"Benutzer"})]})}),e.jsx(He,{children:n.map(o=>e.jsxs(q,{hover:!0,children:[e.jsx(b,{children:e.jsx(I,{label:o.display_name,color:x(o.role_name),size:"small",sx:{fontWeight:500}})}),e.jsx(b,{children:o.description}),e.jsx(b,{align:"center",children:e.jsx(I,{label:o.permission_count,size:"small",variant:"outlined"})}),e.jsx(b,{align:"center",children:e.jsx(I,{label:o.user_count,size:"small",variant:"outlined"})})]},o.role_id))})]})})}),e.jsxs($,{container:!0,spacing:{xs:2,md:3},children:[e.jsx($,{size:{xs:12,md:6},children:e.jsxs(H,{severity:"info",icon:e.jsx(qt,{size:20}),children:[e.jsx(m,{variant:"body2",fontWeight:600,mb:1,children:"Verfügbare Rollen und Berechtigungen:"}),e.jsxs(m,{variant:"body2",component:"div",sx:{mt:1},children:[e.jsx("strong",{children:"Administrator:"})," Vollzugriff auf alle Systemfunktionen inkl. Rollenverwaltung",e.jsx("br",{}),e.jsx("strong",{children:"Moderator:"})," Kann Inserate prüfen, freigeben, sperren und bearbeiten",e.jsx("br",{}),e.jsx("strong",{children:"Support:"})," Kann Benutzerdaten einsehen und bei Problemen helfen",e.jsx("br",{}),e.jsx("strong",{children:"Content Reviewer:"})," Kann Inhalte prüfen und freigeben"]})]})}),e.jsx($,{size:{xs:12,md:6},children:e.jsxs(H,{severity:"success",icon:e.jsx(Cr,{size:20}),children:[e.jsx(m,{variant:"body2",fontWeight:600,mb:1,children:"Funktionen bereits aktiv:"}),e.jsxs(m,{variant:"body2",component:"div",children:["Rollen können Benutzern über die Benutzerverwaltung zugewiesen werden",e.jsx("br",{}),"Berechtigungen werden automatisch überprüft (items.view_all, items.edit_any, items.delete, etc.)",e.jsx("br",{}),"Datenbank-Funktionen: approve_item(), reject_item(), feature_item() für Moderatoren",e.jsx("br",{}),"RLS-Policies berücksichtigen Berechtigungen bei Items"]}),e.jsxs(m,{variant:"body2",component:"div",sx:{mt:2},children:[e.jsx("strong",{children:"Noch zu implementieren:"}),e.jsx("br",{}),"UI-Integration für Moderatoren (Approve/Reject Buttons in der Item-Ansicht)",e.jsx("br",{}),"Messages-Moderation UI",e.jsx("br",{}),"Analytics-Dashboard für Support-Rolle"]})]})})]}),e.jsx(pt,{open:l.open,autoHideDuration:6e3,onClose:()=>d({...l,open:!1}),children:e.jsx(H,{severity:l.severity,onClose:()=>d({...l,open:!1}),children:l.message})})]})},Wr=()=>{const{user:t}=Bt(),[r,n]=g.useState([]),[s,a]=g.useState([]),[i,l]=g.useState(!0),[d,f]=g.useState(!1),[x,o]=g.useState(null),[p,S]=g.useState({open:!1,message:"",severity:"success"}),[h,u]=g.useState(null),[w,k]=g.useState(null),[A,y]=g.useState("all"),[v,M]=g.useState(0),[W,E]=g.useState({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""});g.useEffect(()=>{Q(),z()},[]);const z=async()=>{try{const _=await(await fetch("/TODO.md")).text();F(_)}catch(c){console.error("Error loading TODO.md:",c)}},F=c=>{const _=c.split(`
`),B=[];let N=null;for(let pe=0;pe<_.length;pe++){const re=_[pe],qe=re.match(/^## (.+)$/);if(qe){N&&B.push(N);const se=qe[1].trim(),ae=se.match(/^([^\w\s]+)\s+(.+)$/);N={title:ae?ae[2]:se,emoji:ae?ae[1]:"📋",items:[],notes:[]};continue}if(N){const se=re.match(/^(\s*)- \[([ x])\] (.+)$/);if(se){const We=Math.floor(se[1].length/2);N.items.push({text:se[3],checked:se[2]==="x",indent:We});continue}const ae=re.match(/\*\*Priorität:\*\*\s*(.+)$/);if(ae){N.priority=ae[1];continue}const Qe=re.match(/\*\*Geschätzter Aufwand:\*\*\s*(.+)$/);if(Qe){N.estimatedHours=Qe[1];continue}}}N&&B.push(N),a(B.filter(pe=>pe.items.length>0))},Q=async()=>{l(!0);try{const{data:c,error:_}=await R.from("admin_tasks").select("*").order("created_at",{ascending:!1});if(_)throw _;n(c||[])}catch(c){S({open:!0,message:`Fehler beim Laden: ${c.message}`,severity:"error"})}finally{l(!1)}},P=c=>{var _;c?(o(c),E({title:c.title,description:c.description||"",category:c.category,priority:c.priority,status:c.status,estimated_hours:((_=c.estimated_hours)==null?void 0:_.toString())||"",due_date:c.due_date?c.due_date.split("T")[0]:""})):(o(null),E({title:"",description:"",category:"other",priority:"medium",status:"todo",estimated_hours:"",due_date:""})),f(!0)},J=()=>{f(!1),o(null)},Ie=async()=>{if(!W.title.trim()){S({open:!0,message:"Bitte gib einen Titel ein",severity:"error"});return}try{const c={title:W.title.trim(),description:W.description.trim()||null,category:W.category,priority:W.priority,status:W.status,estimated_hours:W.estimated_hours?parseInt(W.estimated_hours):null,due_date:W.due_date||null};if(x){const{error:_}=await R.from("admin_tasks").update(c).eq("id",x.id);if(_)throw _;S({open:!0,message:"Task erfolgreich aktualisiert",severity:"success"})}else{const{error:_}=await R.from("admin_tasks").insert([{...c,created_by:t==null?void 0:t.id}]);if(_)throw _;S({open:!0,message:"Task erfolgreich erstellt",severity:"success"})}J(),Q()}catch(c){S({open:!0,message:`Fehler: ${c.message}`,severity:"error"})}},ce=async c=>{if(confirm("Möchtest du diese Aufgabe wirklich löschen?"))try{const{error:_}=await R.from("admin_tasks").delete().eq("id",c);if(_)throw _;S({open:!0,message:"Task erfolgreich gelöscht",severity:"success"}),Q()}catch(_){S({open:!0,message:`Fehler: ${_.message}`,severity:"error"})}},fe=async(c,_)=>{try{const{error:B}=await R.from("admin_tasks").update({status:_}).eq("id",c);if(B)throw B;Q()}catch(B){S({open:!0,message:`Fehler: ${B.message}`,severity:"error"})}},Te=c=>({moderation:"Moderation",feature:"Feature",bug:"Bug",improvement:"Verbesserung",documentation:"Dokumentation",other:"Sonstiges"})[c]||c,Fe=c=>({low:"default",medium:"info",high:"warning",urgent:"error"})[c]||"default",ne=A==="all"?r:r.filter(c=>c.status===A),Y={total:r.length,todo:r.filter(c=>c.status==="todo").length,in_progress:r.filter(c=>c.status==="in_progress").length,done:r.filter(c=>c.status==="done").length},de=s.reduce((c,_)=>c+_.items.length,0),xe=s.reduce((c,_)=>c+_.items.filter(B=>B.checked).length,0);return e.jsxs(C,{children:[e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(m,{variant:"h6",sx:{fontWeight:600},children:"Task Management"}),e.jsx(Z,{variant:"contained",startIcon:e.jsx(zn,{size:20}),onClick:()=>P(),children:"Neue Aufgabe"})]}),e.jsx(G,{sx:{mb:3},children:e.jsxs(ht,{value:v,onChange:(c,_)=>M(_),children:[e.jsx(K,{label:`TODO-Liste (${xe}/${de})`}),e.jsx(K,{label:`Datenbank Tasks (${Y.total})`})]})}),v===0?e.jsx(C,{children:s.length===0?e.jsx(G,{sx:{p:4,textAlign:"center"},children:e.jsx(m,{variant:"body1",color:"text.secondary",children:"TODO.md wird geladen..."})}):e.jsx(C,{children:s.map((c,_)=>e.jsxs(An,{defaultExpanded:_<3,children:[e.jsx(Rn,{expandIcon:e.jsx(fn,{size:20}),children:e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1.5,width:"100%"},children:[e.jsx(m,{sx:{fontSize:"1.5rem"},children:c.emoji}),e.jsxs(C,{sx:{flex:1},children:[e.jsx(m,{variant:"h6",fontWeight:600,children:c.title}),e.jsxs(C,{sx:{display:"flex",gap:2,mt:.5},children:[e.jsxs(m,{variant:"caption",color:"text.secondary",children:[c.items.filter(B=>B.checked).length," / ",c.items.length," erledigt"]}),c.priority&&e.jsx(I,{label:c.priority,size:"small",color:c.priority.toLowerCase().includes("high")||c.priority.toLowerCase().includes("urgent")?"error":c.priority.toLowerCase().includes("medium")?"warning":"default",sx:{height:20}}),c.estimatedHours&&e.jsx(I,{label:c.estimatedHours,size:"small",variant:"outlined",sx:{height:20}})]})]})]})}),e.jsx(On,{children:e.jsx(It,{dense:!0,children:c.items.map((B,N)=>e.jsxs(xn,{sx:{pl:2+B.indent*3,py:.5},children:[e.jsx(Ve,{sx:{minWidth:32},children:B.checked?e.jsx(pn,{size:18,color:"#4caf50"}):e.jsx(Sr,{size:18,color:"#9e9e9e"})}),e.jsx(Xe,{primary:B.text,primaryTypographyProps:{sx:{textDecoration:B.checked?"line-through":"none",color:B.checked?"text.secondary":"text.primary",fontSize:"0.9rem"}}})]},N))})})]},_))})}):e.jsxs(C,{children:[e.jsxs($,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(m,{color:"text.secondary",variant:"body2",children:"Gesamt"}),e.jsx(m,{variant:"h4",fontWeight:600,children:Y.total})]})})}),e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(m,{color:"text.secondary",variant:"body2",children:"Offen"}),e.jsx(m,{variant:"h4",fontWeight:600,color:"text.primary",children:Y.todo})]})})}),e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(m,{color:"text.secondary",variant:"body2",children:"In Arbeit"}),e.jsx(m,{variant:"h4",fontWeight:600,color:"info.main",children:Y.in_progress})]})})}),e.jsx($,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ie,{children:e.jsxs(oe,{children:[e.jsx(m,{color:"text.secondary",variant:"body2",children:"Erledigt"}),e.jsx(m,{variant:"h4",fontWeight:600,color:"success.main",children:Y.done})]})})})]}),e.jsx(G,{sx:{mb:3},children:e.jsxs(ht,{value:A,onChange:(c,_)=>y(_),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(K,{label:`Alle (${Y.total})`,value:"all"}),e.jsx(K,{label:`Offen (${Y.todo})`,value:"todo"}),e.jsx(K,{label:`In Arbeit (${Y.in_progress})`,value:"in_progress"}),e.jsx(K,{label:`Erledigt (${Y.done})`,value:"done"})]})}),e.jsx(Ge,{component:G,children:e.jsxs(Ue,{children:[e.jsx(Ye,{children:e.jsxs(q,{children:[e.jsx(b,{children:"Titel"}),e.jsx(b,{children:"Kategorie"}),e.jsx(b,{children:"Priorität"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Aufwand"}),e.jsx(b,{children:"Fällig am"}),e.jsx(b,{align:"right",children:"Aktionen"})]})}),e.jsx(He,{children:i?e.jsx(q,{children:e.jsx(b,{colSpan:7,align:"center",children:"Lädt..."})}):ne.length===0?e.jsx(q,{children:e.jsx(b,{colSpan:7,align:"center",children:"Keine Aufgaben gefunden"})}):ne.map(c=>e.jsxs(q,{children:[e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(m,{variant:"body2",fontWeight:600,children:c.title}),c.description&&e.jsxs(m,{variant:"caption",color:"text.secondary",children:[c.description.substring(0,60),c.description.length>60?"...":""]})]})}),e.jsx(b,{children:e.jsx(I,{label:Te(c.category),size:"small",variant:"outlined"})}),e.jsx(b,{children:e.jsx(I,{label:c.priority,size:"small",color:Fe(c.priority)})}),e.jsx(b,{children:e.jsx(je,{size:"small",sx:{minWidth:120},children:e.jsxs(we,{value:c.status,onChange:_=>fe(c.id,_.target.value),sx:{fontSize:"0.875rem"},children:[e.jsx(D,{value:"todo",children:"Offen"}),e.jsx(D,{value:"in_progress",children:"In Arbeit"}),e.jsx(D,{value:"done",children:"Erledigt"}),e.jsx(D,{value:"cancelled",children:"Abgebrochen"})]})})}),e.jsx(b,{children:c.estimated_hours?`${c.estimated_hours}h`:"-"}),e.jsx(b,{children:c.due_date?e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($n,{size:14}),e.jsx(m,{variant:"body2",children:new Date(c.due_date).toLocaleDateString("de-DE")})]}):"-"}),e.jsx(b,{align:"right",children:e.jsx(ve,{size:"small",onClick:_=>{u(_.currentTarget),k(c)},children:e.jsx(Nt,{size:18})})})]},c.id))})]})}),e.jsxs(Lt,{anchorEl:h,open:!!h,onClose:()=>{u(null),k(null)},children:[e.jsxs(D,{onClick:()=>{w&&P(w),u(null)},children:[e.jsx(Ve,{children:e.jsx(Yt,{size:18})}),e.jsx(Xe,{children:"Bearbeiten"})]}),e.jsxs(D,{onClick:()=>{w&&ce(w.id),u(null),k(null)},children:[e.jsx(Ve,{children:e.jsx(Ut,{size:18})}),e.jsx(Xe,{children:"Löschen"})]})]})]}),e.jsxs(Ke,{open:d,onClose:J,maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ze,{children:x?"Aufgabe bearbeiten":"Neue Aufgabe erstellen"}),e.jsx(et,{children:e.jsxs(C,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(U,{label:"Titel",fullWidth:!0,required:!0,value:W.title,onChange:c=>E({...W,title:c.target.value})}),e.jsx(U,{label:"Beschreibung",fullWidth:!0,multiline:!0,rows:3,value:W.description,onChange:c=>E({...W,description:c.target.value})}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(Ae,{children:"Kategorie"}),e.jsxs(we,{value:W.category,label:"Kategorie",onChange:c=>E({...W,category:c.target.value}),children:[e.jsx(D,{value:"moderation",children:"Moderation"}),e.jsx(D,{value:"feature",children:"Feature"}),e.jsx(D,{value:"bug",children:"Bug"}),e.jsx(D,{value:"improvement",children:"Verbesserung"}),e.jsx(D,{value:"documentation",children:"Dokumentation"}),e.jsx(D,{value:"other",children:"Sonstiges"})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(Ae,{children:"Priorität"}),e.jsxs(we,{value:W.priority,label:"Priorität",onChange:c=>E({...W,priority:c.target.value}),children:[e.jsx(D,{value:"low",children:"Niedrig"}),e.jsx(D,{value:"medium",children:"Mittel"}),e.jsx(D,{value:"high",children:"Hoch"}),e.jsx(D,{value:"urgent",children:"Dringend"})]})]}),e.jsxs(je,{fullWidth:!0,children:[e.jsx(Ae,{children:"Status"}),e.jsxs(we,{value:W.status,label:"Status",onChange:c=>E({...W,status:c.target.value}),children:[e.jsx(D,{value:"todo",children:"Offen"}),e.jsx(D,{value:"in_progress",children:"In Arbeit"}),e.jsx(D,{value:"done",children:"Erledigt"}),e.jsx(D,{value:"cancelled",children:"Abgebrochen"})]})]}),e.jsx(U,{label:"Geschätzter Aufwand (Stunden)",type:"number",fullWidth:!0,value:W.estimated_hours,onChange:c=>E({...W,estimated_hours:c.target.value})}),e.jsx(U,{label:"Fällig am",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0},value:W.due_date,onChange:c=>E({...W,due_date:c.target.value})})]})}),e.jsxs(tt,{children:[e.jsx(Z,{onClick:J,children:"Abbrechen"}),e.jsx(Z,{onClick:Ie,variant:"contained",children:x?"Speichern":"Erstellen"})]})]}),e.jsx(pt,{open:p.open,autoHideDuration:6e3,onClose:()=>S({...p,open:!1}),children:e.jsx(H,{severity:p.severity,onClose:()=>S({...p,open:!1}),children:p.message})})]})},Dr=(t={})=>{const{userId:r,limit:n=50,autoFetch:s=!0}=t,[a,i]=g.useState([]),[l,d]=g.useState(!0),[f,x]=g.useState(null),o=async()=>{try{d(!0),x(null);let h=R.from("donations").select(`
          *,
          user:profiles!user_id (
            id,
            full_name,
            email
          )
        `).order("created_at",{ascending:!1}).limit(n);r&&(h=h.eq("user_id",r));const{data:u,error:w}=await h;if(w)throw w;i(u||[])}catch(h){const u=h instanceof Error?h.message:"Failed to load donations";x(u),console.error("Error fetching donations:",h)}finally{d(!1)}};g.useEffect(()=>{s&&o()},[r,n,s]);const p=()=>a.reduce((h,u)=>h+Number(u.amount),0),S=()=>a.reduce((h,u)=>h+u.credits_granted,0);return{donations:a,loading:l,error:f,refresh:o,totalDonations:p(),totalCredits:S()}},Xt=6048e5,zr=864e5,Wt=Symbol.for("constructDateFrom");function me(t,r){return typeof t=="function"?t(r):t&&typeof t=="object"&&Wt in t?t[Wt](r):t instanceof Date?new t.constructor(r):new Date(r)}function X(t,r){return me(r||t,t)}let Ar={};function dt(){return Ar}function Le(t,r){var d,f,x,o;const n=dt(),s=(r==null?void 0:r.weekStartsOn)??((f=(d=r==null?void 0:r.locale)==null?void 0:d.options)==null?void 0:f.weekStartsOn)??n.weekStartsOn??((o=(x=n.locale)==null?void 0:x.options)==null?void 0:o.weekStartsOn)??0,a=X(t,r==null?void 0:r.in),i=a.getDay(),l=(i<s?7:0)+i-s;return a.setDate(a.getDate()-l),a.setHours(0,0,0,0),a}function rt(t,r){return Le(t,{...r,weekStartsOn:1})}function Kt(t,r){const n=X(t,r==null?void 0:r.in),s=n.getFullYear(),a=me(n,0);a.setFullYear(s+1,0,4),a.setHours(0,0,0,0);const i=rt(a),l=me(n,0);l.setFullYear(s,0,4),l.setHours(0,0,0,0);const d=rt(l);return n.getTime()>=i.getTime()?s+1:n.getTime()>=d.getTime()?s:s-1}function Dt(t){const r=X(t),n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),+t-+n}function Rr(t,...r){const n=me.bind(null,r.find(s=>typeof s=="object"));return r.map(n)}function zt(t,r){const n=X(t,r==null?void 0:r.in);return n.setHours(0,0,0,0),n}function Or(t,r,n){const[s,a]=Rr(n==null?void 0:n.in,t,r),i=zt(s),l=zt(a),d=+i-Dt(i),f=+l-Dt(l);return Math.round((d-f)/zr)}function $r(t,r){const n=Kt(t,r),s=me(t,0);return s.setFullYear(n,0,4),s.setHours(0,0,0,0),rt(s)}function Er(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Br(t){return!(!Er(t)&&typeof t!="number"||isNaN(+X(t)))}function Ir(t,r){const n=X(t,r==null?void 0:r.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}const Fr={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Nr=(t,r,n)=>{let s;const a=Fr[t];return typeof a=="string"?s=a:r===1?s=a.one:s=a.other.replace("{{count}}",r.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:s+" ago":s};function Oe(t){return(r={})=>{const n=r.width?String(r.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const Lr={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ur={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Hr={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Gr={date:Oe({formats:Lr,defaultWidth:"full"}),time:Oe({formats:Ur,defaultWidth:"full"}),dateTime:Oe({formats:Hr,defaultWidth:"full"})},Yr={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qr=(t,r,n,s)=>Yr[t];function ee(t){return(r,n)=>{const s=n!=null&&n.context?String(n.context):"standalone";let a;if(s==="formatting"&&t.formattingValues){const l=t.defaultFormattingWidth||t.defaultWidth,d=n!=null&&n.width?String(n.width):l;a=t.formattingValues[d]||t.formattingValues[l]}else{const l=t.defaultWidth,d=n!=null&&n.width?String(n.width):t.defaultWidth;a=t.values[d]||t.values[l]}const i=t.argumentCallback?t.argumentCallback(r):r;return a[i]}}const Qr={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Jr={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Vr={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Xr={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Kr={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Zr={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},es=(t,r)=>{const n=Number(t),s=n%100;if(s>20||s<10)switch(s%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},ts={ordinalNumber:es,era:ee({values:Qr,defaultWidth:"wide"}),quarter:ee({values:Jr,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ee({values:Vr,defaultWidth:"wide"}),day:ee({values:Xr,defaultWidth:"wide"}),dayPeriod:ee({values:Kr,defaultWidth:"wide",formattingValues:Zr,defaultFormattingWidth:"wide"})};function te(t){return(r,n={})=>{const s=n.width,a=s&&t.matchPatterns[s]||t.matchPatterns[t.defaultMatchWidth],i=r.match(a);if(!i)return null;const l=i[0],d=s&&t.parsePatterns[s]||t.parsePatterns[t.defaultParseWidth],f=Array.isArray(d)?rs(d,p=>p.test(l)):ns(d,p=>p.test(l));let x;x=t.valueCallback?t.valueCallback(f):f,x=n.valueCallback?n.valueCallback(x):x;const o=r.slice(l.length);return{value:x,rest:o}}}function ns(t,r){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r(t[n]))return n}function rs(t,r){for(let n=0;n<t.length;n++)if(r(t[n]))return n}function Zt(t){return(r,n={})=>{const s=r.match(t.matchPattern);if(!s)return null;const a=s[0],i=r.match(t.parsePattern);if(!i)return null;let l=t.valueCallback?t.valueCallback(i[0]):i[0];l=n.valueCallback?n.valueCallback(l):l;const d=r.slice(a.length);return{value:l,rest:d}}}const ss=/^(\d+)(th|st|nd|rd)?/i,as=/\d+/i,is={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},os={any:[/^b/i,/^(a|c)/i]},ls={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},cs={any:[/1/i,/2/i,/3/i,/4/i]},ds={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},us={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},hs={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ms={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},gs={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},fs={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},xs={ordinalNumber:Zt({matchPattern:ss,parsePattern:as,valueCallback:t=>parseInt(t,10)}),era:te({matchPatterns:is,defaultMatchWidth:"wide",parsePatterns:os,defaultParseWidth:"any"}),quarter:te({matchPatterns:ls,defaultMatchWidth:"wide",parsePatterns:cs,defaultParseWidth:"any",valueCallback:t=>t+1}),month:te({matchPatterns:ds,defaultMatchWidth:"wide",parsePatterns:us,defaultParseWidth:"any"}),day:te({matchPatterns:hs,defaultMatchWidth:"wide",parsePatterns:ms,defaultParseWidth:"any"}),dayPeriod:te({matchPatterns:gs,defaultMatchWidth:"any",parsePatterns:fs,defaultParseWidth:"any"})},ps={code:"en-US",formatDistance:Nr,formatLong:Gr,formatRelative:qr,localize:ts,match:xs,options:{weekStartsOn:0,firstWeekContainsDate:1}};function ys(t,r){const n=X(t,r==null?void 0:r.in);return Or(n,Ir(n))+1}function bs(t,r){const n=X(t,r==null?void 0:r.in),s=+rt(n)-+$r(n);return Math.round(s/Xt)+1}function en(t,r){var o,p,S,h;const n=X(t,r==null?void 0:r.in),s=n.getFullYear(),a=dt(),i=(r==null?void 0:r.firstWeekContainsDate)??((p=(o=r==null?void 0:r.locale)==null?void 0:o.options)==null?void 0:p.firstWeekContainsDate)??a.firstWeekContainsDate??((h=(S=a.locale)==null?void 0:S.options)==null?void 0:h.firstWeekContainsDate)??1,l=me((r==null?void 0:r.in)||t,0);l.setFullYear(s+1,0,i),l.setHours(0,0,0,0);const d=Le(l,r),f=me((r==null?void 0:r.in)||t,0);f.setFullYear(s,0,i),f.setHours(0,0,0,0);const x=Le(f,r);return+n>=+d?s+1:+n>=+x?s:s-1}function js(t,r){var d,f,x,o;const n=dt(),s=(r==null?void 0:r.firstWeekContainsDate)??((f=(d=r==null?void 0:r.locale)==null?void 0:d.options)==null?void 0:f.firstWeekContainsDate)??n.firstWeekContainsDate??((o=(x=n.locale)==null?void 0:x.options)==null?void 0:o.firstWeekContainsDate)??1,a=en(t,r),i=me((r==null?void 0:r.in)||t,0);return i.setFullYear(a,0,s),i.setHours(0,0,0,0),Le(i,r)}function ws(t,r){const n=X(t,r==null?void 0:r.in),s=+Le(n,r)-+js(n,r);return Math.round(s/Xt)+1}function O(t,r){const n=t<0?"-":"",s=Math.abs(t).toString().padStart(r,"0");return n+s}const ue={y(t,r){const n=t.getFullYear(),s=n>0?n:1-n;return O(r==="yy"?s%100:s,r.length)},M(t,r){const n=t.getMonth();return r==="M"?String(n+1):O(n+1,2)},d(t,r){return O(t.getDate(),r.length)},a(t,r){const n=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(t,r){return O(t.getHours()%12||12,r.length)},H(t,r){return O(t.getHours(),r.length)},m(t,r){return O(t.getMinutes(),r.length)},s(t,r){return O(t.getSeconds(),r.length)},S(t,r){const n=r.length,s=t.getMilliseconds(),a=Math.trunc(s*Math.pow(10,n-3));return O(a,r.length)}},De={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},At={G:function(t,r,n){const s=t.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return n.era(s,{width:"abbreviated"});case"GGGGG":return n.era(s,{width:"narrow"});case"GGGG":default:return n.era(s,{width:"wide"})}},y:function(t,r,n){if(r==="yo"){const s=t.getFullYear(),a=s>0?s:1-s;return n.ordinalNumber(a,{unit:"year"})}return ue.y(t,r)},Y:function(t,r,n,s){const a=en(t,s),i=a>0?a:1-a;if(r==="YY"){const l=i%100;return O(l,2)}return r==="Yo"?n.ordinalNumber(i,{unit:"year"}):O(i,r.length)},R:function(t,r){const n=Kt(t);return O(n,r.length)},u:function(t,r){const n=t.getFullYear();return O(n,r.length)},Q:function(t,r,n){const s=Math.ceil((t.getMonth()+1)/3);switch(r){case"Q":return String(s);case"QQ":return O(s,2);case"Qo":return n.ordinalNumber(s,{unit:"quarter"});case"QQQ":return n.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(s,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(s,{width:"wide",context:"formatting"})}},q:function(t,r,n){const s=Math.ceil((t.getMonth()+1)/3);switch(r){case"q":return String(s);case"qq":return O(s,2);case"qo":return n.ordinalNumber(s,{unit:"quarter"});case"qqq":return n.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(s,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(s,{width:"wide",context:"standalone"})}},M:function(t,r,n){const s=t.getMonth();switch(r){case"M":case"MM":return ue.M(t,r);case"Mo":return n.ordinalNumber(s+1,{unit:"month"});case"MMM":return n.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(s,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(s,{width:"wide",context:"formatting"})}},L:function(t,r,n){const s=t.getMonth();switch(r){case"L":return String(s+1);case"LL":return O(s+1,2);case"Lo":return n.ordinalNumber(s+1,{unit:"month"});case"LLL":return n.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(s,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(s,{width:"wide",context:"standalone"})}},w:function(t,r,n,s){const a=ws(t,s);return r==="wo"?n.ordinalNumber(a,{unit:"week"}):O(a,r.length)},I:function(t,r,n){const s=bs(t);return r==="Io"?n.ordinalNumber(s,{unit:"week"}):O(s,r.length)},d:function(t,r,n){return r==="do"?n.ordinalNumber(t.getDate(),{unit:"date"}):ue.d(t,r)},D:function(t,r,n){const s=ys(t);return r==="Do"?n.ordinalNumber(s,{unit:"dayOfYear"}):O(s,r.length)},E:function(t,r,n){const s=t.getDay();switch(r){case"E":case"EE":case"EEE":return n.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(s,{width:"short",context:"formatting"});case"EEEE":default:return n.day(s,{width:"wide",context:"formatting"})}},e:function(t,r,n,s){const a=t.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return O(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(t,r,n,s){const a=t.getDay(),i=(a-s.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return O(i,r.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(t,r,n){const s=t.getDay(),a=s===0?7:s;switch(r){case"i":return String(a);case"ii":return O(a,r.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(s,{width:"short",context:"formatting"});case"iiii":default:return n.day(s,{width:"wide",context:"formatting"})}},a:function(t,r,n){const a=t.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,r,n){const s=t.getHours();let a;switch(s===12?a=De.noon:s===0?a=De.midnight:a=s/12>=1?"pm":"am",r){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,r,n){const s=t.getHours();let a;switch(s>=17?a=De.evening:s>=12?a=De.afternoon:s>=4?a=De.morning:a=De.night,r){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,r,n){if(r==="ho"){let s=t.getHours()%12;return s===0&&(s=12),n.ordinalNumber(s,{unit:"hour"})}return ue.h(t,r)},H:function(t,r,n){return r==="Ho"?n.ordinalNumber(t.getHours(),{unit:"hour"}):ue.H(t,r)},K:function(t,r,n){const s=t.getHours()%12;return r==="Ko"?n.ordinalNumber(s,{unit:"hour"}):O(s,r.length)},k:function(t,r,n){let s=t.getHours();return s===0&&(s=24),r==="ko"?n.ordinalNumber(s,{unit:"hour"}):O(s,r.length)},m:function(t,r,n){return r==="mo"?n.ordinalNumber(t.getMinutes(),{unit:"minute"}):ue.m(t,r)},s:function(t,r,n){return r==="so"?n.ordinalNumber(t.getSeconds(),{unit:"second"}):ue.s(t,r)},S:function(t,r){return ue.S(t,r)},X:function(t,r,n){const s=t.getTimezoneOffset();if(s===0)return"Z";switch(r){case"X":return Ot(s);case"XXXX":case"XX":return ye(s);case"XXXXX":case"XXX":default:return ye(s,":")}},x:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"x":return Ot(s);case"xxxx":case"xx":return ye(s);case"xxxxx":case"xxx":default:return ye(s,":")}},O:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Rt(s,":");case"OOOO":default:return"GMT"+ye(s,":")}},z:function(t,r,n){const s=t.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Rt(s,":");case"zzzz":default:return"GMT"+ye(s,":")}},t:function(t,r,n){const s=Math.trunc(+t/1e3);return O(s,r.length)},T:function(t,r,n){return O(+t,r.length)}};function Rt(t,r=""){const n=t>0?"-":"+",s=Math.abs(t),a=Math.trunc(s/60),i=s%60;return i===0?n+String(a):n+String(a)+r+O(i,2)}function Ot(t,r){return t%60===0?(t>0?"-":"+")+O(Math.abs(t)/60,2):ye(t,r)}function ye(t,r=""){const n=t>0?"-":"+",s=Math.abs(t),a=O(Math.trunc(s/60),2),i=O(s%60,2);return n+a+r+i}const $t=(t,r)=>{switch(t){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},tn=(t,r)=>{switch(t){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},vs=(t,r)=>{const n=t.match(/(P+)(p+)?/)||[],s=n[1],a=n[2];if(!a)return $t(t,r);let i;switch(s){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",$t(s,r)).replace("{{time}}",tn(a,r))},Cs={p:tn,P:vs},Ss=/^D+$/,ks=/^Y+$/,Ms=["D","DD","YY","YYYY"];function _s(t){return Ss.test(t)}function Ps(t){return ks.test(t)}function Ts(t,r,n){const s=Ws(t,r,n);if(console.warn(s),Ms.includes(t))throw new RangeError(s)}function Ws(t,r,n){const s=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${r}\`) for formatting ${s} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ds=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,zs=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,As=/^'([^]*?)'?$/,Rs=/''/g,Os=/[a-zA-Z]/;function st(t,r,n){var o,p,S,h,u,w,k,A;const s=dt(),a=(n==null?void 0:n.locale)??s.locale??ps,i=(n==null?void 0:n.firstWeekContainsDate)??((p=(o=n==null?void 0:n.locale)==null?void 0:o.options)==null?void 0:p.firstWeekContainsDate)??s.firstWeekContainsDate??((h=(S=s.locale)==null?void 0:S.options)==null?void 0:h.firstWeekContainsDate)??1,l=(n==null?void 0:n.weekStartsOn)??((w=(u=n==null?void 0:n.locale)==null?void 0:u.options)==null?void 0:w.weekStartsOn)??s.weekStartsOn??((A=(k=s.locale)==null?void 0:k.options)==null?void 0:A.weekStartsOn)??0,d=X(t,n==null?void 0:n.in);if(!Br(d))throw new RangeError("Invalid time value");let f=r.match(zs).map(y=>{const v=y[0];if(v==="p"||v==="P"){const M=Cs[v];return M(y,a.formatLong)}return y}).join("").match(Ds).map(y=>{if(y==="''")return{isToken:!1,value:"'"};const v=y[0];if(v==="'")return{isToken:!1,value:$s(y)};if(At[v])return{isToken:!0,value:y};if(v.match(Os))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:y}});a.localize.preprocessor&&(f=a.localize.preprocessor(d,f));const x={firstWeekContainsDate:i,weekStartsOn:l,locale:a};return f.map(y=>{if(!y.isToken)return y.value;const v=y.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&Ps(v)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&_s(v))&&Ts(v,r,String(t));const M=At[v[0]];return M(d,v,a.localize,x)}).join("")}function $s(t){const r=t.match(As);return r?r[1].replace(Rs,"'"):t}const Et={lessThanXSeconds:{standalone:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"},withPreposition:{one:"weniger als 1 Sekunde",other:"weniger als {{count}} Sekunden"}},xSeconds:{standalone:{one:"1 Sekunde",other:"{{count}} Sekunden"},withPreposition:{one:"1 Sekunde",other:"{{count}} Sekunden"}},halfAMinute:{standalone:"eine halbe Minute",withPreposition:"einer halben Minute"},lessThanXMinutes:{standalone:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"},withPreposition:{one:"weniger als 1 Minute",other:"weniger als {{count}} Minuten"}},xMinutes:{standalone:{one:"1 Minute",other:"{{count}} Minuten"},withPreposition:{one:"1 Minute",other:"{{count}} Minuten"}},aboutXHours:{standalone:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"},withPreposition:{one:"etwa 1 Stunde",other:"etwa {{count}} Stunden"}},xHours:{standalone:{one:"1 Stunde",other:"{{count}} Stunden"},withPreposition:{one:"1 Stunde",other:"{{count}} Stunden"}},xDays:{standalone:{one:"1 Tag",other:"{{count}} Tage"},withPreposition:{one:"1 Tag",other:"{{count}} Tagen"}},aboutXWeeks:{standalone:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"},withPreposition:{one:"etwa 1 Woche",other:"etwa {{count}} Wochen"}},xWeeks:{standalone:{one:"1 Woche",other:"{{count}} Wochen"},withPreposition:{one:"1 Woche",other:"{{count}} Wochen"}},aboutXMonths:{standalone:{one:"etwa 1 Monat",other:"etwa {{count}} Monate"},withPreposition:{one:"etwa 1 Monat",other:"etwa {{count}} Monaten"}},xMonths:{standalone:{one:"1 Monat",other:"{{count}} Monate"},withPreposition:{one:"1 Monat",other:"{{count}} Monaten"}},aboutXYears:{standalone:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahre"},withPreposition:{one:"etwa 1 Jahr",other:"etwa {{count}} Jahren"}},xYears:{standalone:{one:"1 Jahr",other:"{{count}} Jahre"},withPreposition:{one:"1 Jahr",other:"{{count}} Jahren"}},overXYears:{standalone:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahre"},withPreposition:{one:"mehr als 1 Jahr",other:"mehr als {{count}} Jahren"}},almostXYears:{standalone:{one:"fast 1 Jahr",other:"fast {{count}} Jahre"},withPreposition:{one:"fast 1 Jahr",other:"fast {{count}} Jahren"}}},Es=(t,r,n)=>{let s;const a=n!=null&&n.addSuffix?Et[t].withPreposition:Et[t].standalone;return typeof a=="string"?s=a:r===1?s=a.one:s=a.other.replace("{{count}}",String(r)),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+s:"vor "+s:s},Bs={full:"EEEE, do MMMM y",long:"do MMMM y",medium:"do MMM y",short:"dd.MM.y"},Is={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Fs={full:"{{date}} 'um' {{time}}",long:"{{date}} 'um' {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},Ns={date:Oe({formats:Bs,defaultWidth:"full"}),time:Oe({formats:Is,defaultWidth:"full"}),dateTime:Oe({formats:Fs,defaultWidth:"full"})},Ls={lastWeek:"'letzten' eeee 'um' p",yesterday:"'gestern um' p",today:"'heute um' p",tomorrow:"'morgen um' p",nextWeek:"eeee 'um' p",other:"P"},Us=(t,r,n,s)=>Ls[t],Hs={narrow:["v.Chr.","n.Chr."],abbreviated:["v.Chr.","n.Chr."],wide:["vor Christus","nach Christus"]},Gs={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1. Quartal","2. Quartal","3. Quartal","4. Quartal"]},gt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],wide:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]},Ys={narrow:gt.narrow,abbreviated:["Jan.","Feb.","März","Apr.","Mai","Juni","Juli","Aug.","Sep.","Okt.","Nov.","Dez."],wide:gt.wide},qs={narrow:["S","M","D","M","D","F","S"],short:["So","Mo","Di","Mi","Do","Fr","Sa"],abbreviated:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."],wide:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},Qs={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachm.",evening:"Abend",night:"Nacht"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"Morgen",afternoon:"Nachmittag",evening:"Abend",night:"Nacht"}},Js={narrow:{am:"vm.",pm:"nm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachm.",evening:"abends",night:"nachts"},abbreviated:{am:"vorm.",pm:"nachm.",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"},wide:{am:"vormittags",pm:"nachmittags",midnight:"Mitternacht",noon:"Mittag",morning:"morgens",afternoon:"nachmittags",evening:"abends",night:"nachts"}},Vs=t=>Number(t)+".",Xs={ordinalNumber:Vs,era:ee({values:Hs,defaultWidth:"wide"}),quarter:ee({values:Gs,defaultWidth:"wide",argumentCallback:t=>t-1}),month:ee({values:gt,formattingValues:Ys,defaultWidth:"wide"}),day:ee({values:qs,defaultWidth:"wide"}),dayPeriod:ee({values:Qs,defaultWidth:"wide",formattingValues:Js,defaultFormattingWidth:"wide"})},Ks=/^(\d+)(\.)?/i,Zs=/\d+/i,ea={narrow:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,abbreviated:/^(v\.? ?Chr\.?|n\.? ?Chr\.?)/i,wide:/^(vor Christus|vor unserer Zeitrechnung|nach Christus|unserer Zeitrechnung)/i},ta={any:[/^v/i,/^n/i]},na={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](\.)? Quartal/i},ra={any:[/1/i,/2/i,/3/i,/4/i]},sa={narrow:/^[jfmasond]/i,abbreviated:/^(j[aä]n|feb|mär[z]?|apr|mai|jun[i]?|jul[i]?|aug|sep|okt|nov|dez)\.?/i,wide:/^(januar|februar|märz|april|mai|juni|juli|august|september|oktober|november|dezember)/i},aa={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^j[aä]/i,/^f/i,/^mär/i,/^ap/i,/^mai/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ia={narrow:/^[smdmf]/i,short:/^(so|mo|di|mi|do|fr|sa)/i,abbreviated:/^(son?|mon?|die?|mit?|don?|fre?|sam?)\.?/i,wide:/^(sonntag|montag|dienstag|mittwoch|donnerstag|freitag|samstag)/i},oa={any:[/^so/i,/^mo/i,/^di/i,/^mi/i,/^do/i,/^f/i,/^sa/i]},la={narrow:/^(vm\.?|nm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,abbreviated:/^(vorm\.?|nachm\.?|Mitternacht|Mittag|morgens|nachm\.?|abends|nachts)/i,wide:/^(vormittags|nachmittags|Mitternacht|Mittag|morgens|nachmittags|abends|nachts)/i},ca={any:{am:/^v/i,pm:/^n/i,midnight:/^Mitte/i,noon:/^Mitta/i,morning:/morgens/i,afternoon:/nachmittags/i,evening:/abends/i,night:/nachts/i}},da={ordinalNumber:Zt({matchPattern:Ks,parsePattern:Zs,valueCallback:t=>parseInt(t)}),era:te({matchPatterns:ea,defaultMatchWidth:"wide",parsePatterns:ta,defaultParseWidth:"any"}),quarter:te({matchPatterns:na,defaultMatchWidth:"wide",parsePatterns:ra,defaultParseWidth:"any",valueCallback:t=>t+1}),month:te({matchPatterns:sa,defaultMatchWidth:"wide",parsePatterns:aa,defaultParseWidth:"any"}),day:te({matchPatterns:ia,defaultMatchWidth:"wide",parsePatterns:oa,defaultParseWidth:"any"}),dayPeriod:te({matchPatterns:la,defaultMatchWidth:"wide",parsePatterns:ca,defaultParseWidth:"any"})},at={code:"de",formatDistance:Es,formatLong:Ns,formatRelative:Us,localize:Xs,match:da,options:{weekStartsOn:1,firstWeekContainsDate:4}},ua=()=>{const t=Pe(),r=Ee(t.breakpoints.down("md")),{donations:n,loading:s,error:a,refresh:i,totalDonations:l,totalCredits:d}=Dr(),[f,x]=g.useState(!1),o=async()=>{x(!0),await i(),x(!1)},p=u=>{switch(u){case"completed":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"default";default:return"default"}},S=u=>u==="community_pot"?"Community-Topf":"Persönliche Credits",h=u=>u==="community_pot"?"primary":"secondary";return s&&!f?e.jsx(C,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(le,{})}):a?e.jsx(H,{severity:"error",sx:{mb:3},children:a}):e.jsxs(C,{children:[e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(m,{variant:"h5",fontWeight:700,children:"Spenden-Übersicht"}),e.jsx(it,{title:"Aktualisieren",children:e.jsx(ve,{onClick:o,disabled:f,children:e.jsx(Vt,{size:20,className:f?"animate-spin":""})})})]}),e.jsxs(Ht,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:3},children:[e.jsx(ie,{sx:{flex:1},children:e.jsxs(oe,{children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(yt,{size:20,color:t.palette.primary.main}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Gesamtspenden"})]}),e.jsx(m,{variant:"h4",fontWeight:700,children:be(l)})]})}),e.jsx(ie,{sx:{flex:1},children:e.jsxs(oe,{children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(yn,{size:20,color:t.palette.success.main}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Credits vergeben"})]}),e.jsx(m,{variant:"h4",fontWeight:700,children:L(d)})]})}),e.jsx(ie,{sx:{flex:1},children:e.jsxs(oe,{children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(ot,{size:20,color:t.palette.info.main}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Anzahl Spenden"})]}),e.jsx(m,{variant:"h4",fontWeight:700,children:L(n.length)})]})})]}),n.length===0?e.jsx(H,{severity:"info",children:"Noch keine Spenden vorhanden."}):e.jsx(Ge,{component:G,children:e.jsxs(Ue,{size:r?"small":"medium",children:[e.jsx(Ye,{children:e.jsxs(q,{children:[e.jsx(b,{children:"Datum"}),!r&&e.jsx(b,{children:"Benutzer"}),e.jsx(b,{align:"right",children:"Betrag"}),e.jsx(b,{align:"center",children:"Credits"}),e.jsx(b,{align:"center",children:"Typ"}),e.jsx(b,{align:"center",children:"Status"})]})}),e.jsx(He,{children:n.map(u=>{var w,k;return e.jsxs(q,{hover:!0,children:[e.jsxs(b,{children:[e.jsx(m,{variant:"body2",children:st(new Date(u.created_at),"dd.MM.yyyy",{locale:at})}),e.jsxs(m,{variant:"caption",color:"text.secondary",children:[st(new Date(u.created_at),"HH:mm",{locale:at})," Uhr"]})]}),!r&&e.jsxs(b,{children:[e.jsx(m,{variant:"body2",children:((w=u.profiles)==null?void 0:w.full_name)||"Unbekannt"}),e.jsx(m,{variant:"caption",color:"text.secondary",children:(k=u.profiles)==null?void 0:k.email})]}),e.jsx(b,{align:"right",children:e.jsx(m,{variant:"body2",fontWeight:600,children:be(Number(u.amount))})}),e.jsx(b,{align:"center",children:e.jsx(I,{label:L(u.credits_granted),size:"small",color:"success",variant:"outlined"})}),e.jsx(b,{align:"center",children:e.jsx(I,{label:S(u.donation_type),size:"small",color:h(u.donation_type)})}),e.jsx(b,{align:"center",children:e.jsx(I,{label:u.status,size:"small",color:p(u.status)})})]},u.id)})})]})})]})},ha=()=>{const[t,r]=g.useState(!1),[n,s]=g.useState(null);return{grantPersonalCredits:async({userId:l,amount:d,euroAmount:f,pricePerUnit:x})=>{try{r(!0),s(null);const{data:o,error:p}=await R.from("profiles").select("personal_credits").eq("id",l).single();if(p)throw p;const S=(o.personal_credits||0)+d,{error:h}=await R.from("profiles").update({personal_credits:S,updated_at:new Date().toISOString()}).eq("id",l);if(h)throw h;const{error:u}=await R.from("donations").insert({user_id:l,amount:f,price_per_unit:x,donation_type:"personal_credits",credits_granted:d,status:"completed",stripe_payment_id:`admin_grant_${Date.now()}`});if(u)throw u;return{success:!0,newCredits:S}}catch(o){const p=o instanceof Error?o.message:"Failed to grant credits";throw s(p),console.error("Error granting personal credits:",o),o}finally{r(!1)}},addToCommunityPot:async({amount:l,euroAmount:d,pricePerUnit:f,reason:x,userId:o})=>{try{r(!0),s(null);const{data:p,error:S}=await R.from("credit_system_settings").select("setting_value").eq("setting_key","community_pot_balance").single();if(S)throw S;const u=parseInt(p.setting_value||"0")+l,{error:w}=await R.from("credit_system_settings").update({setting_value:u.toString(),updated_at:new Date().toISOString()}).eq("setting_key","community_pot_balance");if(w)throw w;if(o){const{error:A}=await R.from("donations").insert({user_id:o,amount:d,price_per_unit:f,donation_type:"community_pot",credits_granted:l,status:"completed",stripe_payment_id:`admin_community_${Date.now()}`});if(A)throw A}const{error:k}=await R.from("community_pot_transactions").insert({transaction_type:"adjustment",user_id:o||null,amount:l,balance_after:u,description:x||`Admin adjustment: +${l} credits`});if(k)throw k;return{success:!0,newBalance:u}}catch(p){const S=p instanceof Error?p.message:"Failed to add to community pot";throw s(S),console.error("Error adding to community pot:",p),p}finally{r(!1)}},loading:t,error:n}},ma=()=>{const{grantPersonalCredits:t,addToCommunityPot:r,loading:n}=ha(),{settings:s,loading:a}=Qt(),[i,l]=g.useState("personal"),[d,f]=g.useState(null),[x,o]=g.useState([]),[p,S]=g.useState(!1),[h,u]=g.useState(5),[w,k]=g.useState(""),[A,y]=g.useState(null),M=(()=>{if(!s||h<=0)return 0;const z=i==="community"?s.costPerListing:s.powerUserCreditPrice;return Math.floor(h/z)})(),W=async z=>{if(!z||z.length<2){o([]);return}try{S(!0);const{data:F,error:Q}=await R.from("profiles").select("id, email, full_name").or(`email.ilike.%${z}%,full_name.ilike.%${z}%`).limit(10);if(Q)throw Q;o(F||[])}catch(F){console.error("Error searching users:",F)}finally{S(!1)}},E=async()=>{if(y(null),i==="personal"&&!d){y({type:"error",text:"Bitte wähle einen Benutzer aus."});return}if(h<=0){y({type:"error",text:"Betrag muss größer als 0 sein."});return}if(M<=0){y({type:"error",text:"Der eingegebene Betrag ergibt 0 Credits. Bitte erhöhe den Betrag."});return}try{const z=i==="community"?s.costPerListing:s.powerUserCreditPrice;if(i==="personal")await t({userId:d.id,amount:M,euroAmount:h,pricePerUnit:z,reason:w||void 0}),y({type:"success",text:`Erfolgreich ${L(M)} Credits (${be(h)}) an ${d.full_name||d.email} vergeben!`});else{await r({amount:M,euroAmount:h,pricePerUnit:z,reason:w||void 0,userId:(d==null?void 0:d.id)||void 0});const F=d?` von ${d.full_name||d.email}`:"";y({type:"success",text:`Erfolgreich ${L(M)} Inserate (${be(h)})${F} zum Community-Topf hinzugefügt!`})}u(5),k(""),f(null)}catch(z){y({type:"error",text:z instanceof Error?z.message:"Fehler beim Vergeben der Credits"})}};return e.jsxs(C,{children:[e.jsx(m,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:3},children:"Manuelle Credit-Vergabe"}),e.jsxs(G,{sx:{p:3},children:[A&&e.jsx(H,{severity:A.type,sx:{mb:3},onClose:()=>y(null),children:A.text}),e.jsxs(Ht,{spacing:3,children:[e.jsxs(C,{children:[e.jsx(bn,{component:"legend",sx:{mb:1,fontWeight:600},children:"Vergabe-Typ"}),e.jsxs(En,{row:!0,value:i,onChange:z=>l(z.target.value),children:[e.jsx(jt,{value:"personal",control:e.jsx(wt,{}),label:e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(mt,{size:18}),"Persönliche Credits"]})}),e.jsx(jt,{value:"community",control:e.jsx(wt,{}),label:e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{size:18}),"Community-Topf"]})})]})]}),e.jsx(Ne,{}),e.jsx(jn,{options:x,loading:p,value:d,onChange:(z,F)=>f(F),onInputChange:(z,F)=>W(F),getOptionLabel:z=>`${z.full_name||"Kein Name"} (${z.email})`,renderInput:z=>e.jsx(U,{...z,label:i==="personal"?"Benutzer auswählen *":"Spender verknüpfen (optional)",placeholder:"Suche nach Name oder E-Mail...",helperText:i==="personal"?"Gib mindestens 2 Zeichen ein um zu suchen":"💡 Optional: Verknüpfe die Spende mit einem User für Dankesliste, Nominierungen & Marketing",InputProps:{...z.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[p?e.jsx(le,{size:20}):null,z.InputProps.endAdornment]})}})}),e.jsx(U,{fullWidth:!0,label:"Betrag in Euro",type:"number",value:h,onChange:z=>u(parseFloat(z.target.value)||0),helperText:"Gib den Euro-Betrag ein - die Credits werden automatisch berechnet",inputProps:{min:.01,step:.01},InputProps:{startAdornment:e.jsx(he,{position:"start",children:"€"})}}),!a&&h>0&&e.jsx(ie,{sx:{bgcolor:M>0?"success.main":"warning.main",color:"white",borderRadius:2,boxShadow:3},children:e.jsxs(oe,{sx:{py:2},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[e.jsx(Gt,{size:24,strokeWidth:2.5}),e.jsxs(m,{variant:"h6",fontWeight:700,children:[L(M)," ",i==="community"?"Inserate":"Credits"]})]}),e.jsx(m,{variant:"body2",fontWeight:600,sx:{bgcolor:"rgba(255, 255, 255, 0.25)",px:1.5,py:.5,borderRadius:1},children:be(h)})]}),e.jsxs(m,{variant:"body2",sx:{opacity:.95,fontWeight:500},children:["Berechnung: ",be(h)," ÷ ",be(i==="community"?(s==null?void 0:s.costPerListing)||0:(s==null?void 0:s.powerUserCreditPrice)||0)," = ",L(M)," ",i==="community"?"Inserate":"Credits",M===0&&e.jsx(C,{component:"span",sx:{bgcolor:"rgba(255, 255, 255, 0.9)",color:"warning.dark",fontWeight:700,ml:1,px:1,py:.25,borderRadius:.5},children:"⚠️ Betrag zu niedrig"})]})]})}),e.jsx(U,{fullWidth:!0,label:"Grund (optional)",multiline:!0,rows:3,value:w,onChange:z=>k(z.target.value),placeholder:"Z.B. Bonus für aktive Community-Teilnahme",helperText:"Optionale Begründung für die Credit-Vergabe"}),e.jsx(C,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(Z,{variant:"contained",size:"large",onClick:E,disabled:n||a||M<=0||i==="personal"&&!d,startIcon:n?e.jsx(le,{size:20,color:"inherit"}):e.jsx(mt,{size:20}),children:n?"Vergebe Credits...":`${L(M)} ${i==="community"?"Inserate":"Credits"} vergeben`})})]})]})]})},ga=(t={})=>{const{limit:r=100,transactionType:n,autoFetch:s=!0}=t,[a,i]=g.useState([]),[l,d]=g.useState(!0),[f,x]=g.useState(null),o=async()=>{try{d(!0),x(null);let h=R.from("community_pot_transactions").select(`
          *,
          user:profiles!user_id (
            id,
            full_name,
            email
          ),
          item:items!item_id (
            id,
            title
          )
        `).order("created_at",{ascending:!1}).limit(r);n&&(h=h.eq("transaction_type",n));const{data:u,error:w}=await h;if(w)throw w;i(u||[])}catch(h){const u=h instanceof Error?h.message:"Failed to load transactions";x(u),console.error("Error fetching community pot transactions:",h)}finally{d(!1)}};g.useEffect(()=>{s&&o()},[r,n,s]);const p=()=>a.filter(h=>h.transaction_type==="donation").reduce((h,u)=>h+u.amount,0),S=()=>Math.abs(a.filter(h=>h.transaction_type==="usage").reduce((h,u)=>h+u.amount,0));return{transactions:a,loading:l,error:f,refresh:o,totalDonations:p(),totalUsage:S()}},fa=()=>{const t=Pe(),r=Ee(t.breakpoints.down("md")),[n,s]=g.useState("all"),[a,i]=g.useState(!1),{transactions:l,loading:d,error:f,refresh:x,totalDonations:o,totalUsage:p}=ga({transactionType:n==="all"?void 0:n}),S=async()=>{i(!0),await x(),i(!1)},h=k=>{switch(k){case"donation":return"Spende";case"usage":return"Nutzung";case"adjustment":return"Anpassung";default:return k}},u=k=>{switch(k){case"donation":return"success";case"usage":return"error";case"adjustment":return"warning";default:return"default"}},w=k=>{switch(k){case"donation":return e.jsx(Gt,{size:16});case"usage":return e.jsx(Pr,{size:16});case"adjustment":return e.jsx(qt,{size:16});default:return}};return d&&!a?e.jsx(C,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(le,{})}):f?e.jsx(H,{severity:"error",sx:{mb:3},children:f}):e.jsxs(C,{children:[e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexDirection:{xs:"column",sm:"row"},gap:2},children:[e.jsx(m,{variant:"h5",fontWeight:700,children:"Community-Topf Transaktionen"}),e.jsx(it,{title:"Aktualisieren",children:e.jsx(ve,{onClick:S,disabled:a,children:e.jsx(Vt,{size:20,className:a?"animate-spin":""})})})]}),e.jsx(C,{sx:{mb:3},children:e.jsxs(wn,{value:n,exclusive:!0,onChange:(k,A)=>{A!==null&&s(A)},size:"small",fullWidth:r,children:[e.jsx(Je,{value:"all",children:"Alle"}),e.jsx(Je,{value:"donation",children:"Spenden"}),e.jsx(Je,{value:"usage",children:"Nutzung"}),e.jsx(Je,{value:"adjustment",children:"Anpassungen"})]})}),e.jsxs(G,{elevation:1,sx:{p:2,mb:3,display:"flex",gap:3,flexDirection:{xs:"column",sm:"row"}},children:[e.jsxs(C,{sx:{flex:1},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Gesamte Spenden"}),e.jsxs(m,{variant:"h5",fontWeight:700,color:"success.main",children:["+",L(o)]})]}),e.jsxs(C,{sx:{flex:1},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Gesamte Nutzung"}),e.jsxs(m,{variant:"h5",fontWeight:700,color:"error.main",children:["-",L(p)]})]}),e.jsxs(C,{sx:{flex:1},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Netto"}),e.jsx(m,{variant:"h5",fontWeight:700,children:L(o-p)})]})]}),l.length===0?e.jsx(H,{severity:"info",children:"Keine Transaktionen vorhanden."}):e.jsx(Ge,{component:G,children:e.jsxs(Ue,{size:r?"small":"medium",children:[e.jsx(Ye,{children:e.jsxs(q,{children:[e.jsx(b,{children:"Datum"}),!r&&e.jsx(b,{children:"Benutzer"}),e.jsx(b,{align:"center",children:"Typ"}),e.jsx(b,{align:"right",children:"Betrag"}),e.jsx(b,{align:"right",children:"Saldo danach"}),!r&&e.jsx(b,{children:"Beschreibung"})]})}),e.jsx(He,{children:l.map(k=>{var A,y;return e.jsxs(q,{hover:!0,children:[e.jsxs(b,{children:[e.jsx(m,{variant:"body2",children:st(new Date(k.created_at),"dd.MM.yyyy",{locale:at})}),e.jsxs(m,{variant:"caption",color:"text.secondary",children:[st(new Date(k.created_at),"HH:mm",{locale:at})," Uhr"]})]}),!r&&e.jsxs(b,{children:[e.jsx(m,{variant:"body2",children:((A=k.profiles)==null?void 0:A.full_name)||"System"}),((y=k.profiles)==null?void 0:y.email)&&e.jsx(m,{variant:"caption",color:"text.secondary",children:k.profiles.email})]}),e.jsx(b,{align:"center",children:e.jsx(I,{icon:w(k.transaction_type),label:h(k.transaction_type),size:"small",color:u(k.transaction_type)})}),e.jsx(b,{align:"right",children:e.jsxs(m,{variant:"body2",fontWeight:600,color:k.amount>0?"success.main":k.amount<0?"error.main":"text.primary",children:[k.amount>0?"+":"",L(k.amount)]})}),e.jsx(b,{align:"right",children:e.jsx(I,{label:L(k.balance_after),size:"small",variant:"outlined"})}),!r&&e.jsxs(b,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",children:k.description||"-"}),k.items&&e.jsxs(m,{variant:"caption",color:"text.secondary",children:["Inserat: ",k.items.title]})]})]},k.id)})})]})})]})},xa=()=>{const[t,r]=g.useState(0);return e.jsxs(C,{children:[e.jsx(G,{sx:{mb:3},children:e.jsxs(ht,{value:t,onChange:(n,s)=>r(s),variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(K,{icon:e.jsx(vn,{size:18}),label:"Einstellungen",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(K,{icon:e.jsx(yt,{size:18}),label:"Spenden",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(K,{icon:e.jsx(mt,{size:18}),label:"Credits vergeben",iconPosition:"start",sx:{textTransform:"none",minHeight:48}}),e.jsx(K,{icon:e.jsx(Cn,{size:18}),label:"Transaktionen",iconPosition:"start",sx:{textTransform:"none",minHeight:48}})]})}),t===0&&e.jsx(pa,{}),t===1&&e.jsx(ua,{}),t===2&&e.jsx(ma,{}),t===3&&e.jsx(fa,{})]})},pa=()=>{const t=Pe(),r=Ee(t.breakpoints.down("md")),{settings:n,loading:s,error:a,updateSetting:i}=Qt(),[l,d]=g.useState(!1),[f,x]=g.useState(null),[o,p]=g.useState({dailyFreeListings:(n==null?void 0:n.dailyFreeListings)||5,costPerListing:(n==null?void 0:n.costPerListing)||.2,powerUserCreditPrice:(n==null?void 0:n.powerUserCreditPrice)||.2,minDonationAmount:(n==null?void 0:n.minDonationAmount)||5,powerUserMinPurchase:(n==null?void 0:n.powerUserMinPurchase)||10,lowPotWarningThreshold:(n==null?void 0:n.lowPotWarningThreshold)||100});g.useEffect(()=>{n&&p({dailyFreeListings:n.dailyFreeListings,costPerListing:n.costPerListing,powerUserCreditPrice:n.powerUserCreditPrice,minDonationAmount:n.minDonationAmount,powerUserMinPurchase:n.powerUserMinPurchase,lowPotWarningThreshold:n.lowPotWarningThreshold})},[n]);const S=async()=>{try{d(!0),x(null),await Promise.all([i({setting_key:"daily_free_listings",setting_value:o.dailyFreeListings}),i({setting_key:"cost_per_listing",setting_value:o.costPerListing}),i({setting_key:"power_user_credit_price",setting_value:o.powerUserCreditPrice}),i({setting_key:"min_donation_amount",setting_value:o.minDonationAmount}),i({setting_key:"power_user_min_purchase",setting_value:o.powerUserMinPurchase}),i({setting_key:"low_pot_warning_threshold",setting_value:o.lowPotWarningThreshold})]),x({type:"success",text:"Einstellungen erfolgreich gespeichert!"})}catch(w){x({type:"error",text:"Fehler beim Speichern der Einstellungen."}),console.error("Error saving settings:",w)}finally{d(!1)}};if(s)return e.jsx(C,{sx:{display:"flex",justifyContent:"center",py:8},children:e.jsx(le,{})});if(a)return e.jsx(H,{severity:"error",sx:{mb:3},children:a});const h=r?C:G,u=r?{}:{sx:{p:3}};return e.jsxs(C,{children:[e.jsx(m,{variant:"h5",fontWeight:700,gutterBottom:!0,sx:{mb:1,display:{xs:"none",md:"block"}},children:"Credit-System Einstellungen"}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:{xs:2,md:4},display:{xs:"none",md:"block"}},children:"Konfiguriere das Community-Spendentopf & Power-User System"}),e.jsxs(H,{severity:"info",icon:e.jsx(Sn,{size:20}),sx:{mb:3},children:[e.jsx(m,{variant:"body2",sx:{fontWeight:600,mb:.5},children:"Wie funktioniert das System?"}),e.jsxs(m,{variant:"body2",sx:{fontSize:"0.875rem"},children:[e.jsx("strong",{children:"Community-Topf"}),": Alle User spenden in einen gemeinsamen Topf",e.jsx("br",{}),e.jsx("strong",{children:"Gratis-User"}),": Bekommen täglich X kostenlose Inserate (solange Topf nicht leer)",e.jsx("br",{}),e.jsx("strong",{children:"Power-User"}),": Kaufen eigene Credits für unbegrenzte Inserate"]})]}),e.jsx(G,{elevation:1,sx:{p:{xs:2,md:3},mb:3,bgcolor:"primary.50",borderLeft:"4px solid",borderColor:"primary.main"},children:e.jsxs(C,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:{xs:"column",sm:"row"},gap:2,textAlign:{xs:"center",sm:"left"}},children:[e.jsxs(C,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mb:.5},children:"Aktueller Community-Topf"}),e.jsxs(m,{variant:"h4",sx:{fontWeight:700,color:"primary.main"},children:[L(n==null?void 0:n.communityPotBalance)," Inserate"]})]}),e.jsx(I,{icon:e.jsx(ot,{size:16}),label:(n==null?void 0:n.communityPotBalance)>(n==null?void 0:n.lowPotWarningThreshold)?"Gesund":"Niedrig",color:(n==null?void 0:n.communityPotBalance)>(n==null?void 0:n.lowPotWarningThreshold)?"success":"warning"})]})}),f&&e.jsx(H,{severity:f.type,sx:{mb:3},onClose:()=>x(null),children:f.text}),e.jsxs(h,{...u,children:[e.jsx(m,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Gratis-Inserate Einstellungen"}),e.jsxs($,{container:!0,spacing:{xs:2,md:3},sx:{mb:3},children:[e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Kostenlose Inserate pro Tag",type:"number",value:o.dailyFreeListings,onChange:w=>p({...o,dailyFreeListings:parseInt(w.target.value)}),helperText:"Anzahl der kostenlosen Inserate die jeder User pro Tag erstellen kann",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"Inserate/Tag"})}})}),e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Warnschwelle Community-Topf",type:"number",value:o.lowPotWarningThreshold,onChange:w=>p({...o,lowPotWarningThreshold:parseInt(w.target.value)}),helperText:"Bei wie vielen verbleibenden Inseraten soll gewarnt werden?",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"Inserate"})}})})]}),e.jsx(Ne,{sx:{my:3}}),e.jsx(m,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Kosten & Preise"}),e.jsxs($,{container:!0,spacing:{xs:2,md:3},sx:{mb:3},children:[e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Kosten pro Inserat",type:"number",inputProps:{step:.01},value:o.costPerListing,onChange:w=>p({...o,costPerListing:parseFloat(w.target.value)}),helperText:"Tatsächliche Kosten (Gemini API + Server) pro Inserat",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"EUR"})}})}),e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Power-User Credit Preis",type:"number",inputProps:{step:.01},value:o.powerUserCreditPrice,onChange:w=>p({...o,powerUserCreditPrice:parseFloat(w.target.value)}),helperText:"Preis pro Power-User Credit",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"EUR/Credit"})}})}),e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Minimale Spende",type:"number",inputProps:{step:.01},value:o.minDonationAmount,onChange:w=>p({...o,minDonationAmount:parseFloat(w.target.value)}),helperText:"Mindestbetrag für Community-Topf Spenden",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"EUR"})}})}),e.jsx($,{size:{xs:12,md:6},children:e.jsx(U,{fullWidth:!0,label:"Minimaler Power-User Kauf",type:"number",inputProps:{step:.01},value:o.powerUserMinPurchase,onChange:w=>p({...o,powerUserMinPurchase:parseFloat(w.target.value)}),helperText:"Mindestbetrag für Power-User Credit Kauf",InputProps:{endAdornment:e.jsx(he,{position:"end",children:"EUR"})}})})]}),e.jsx(Ne,{sx:{my:3}}),e.jsx(m,{variant:"h6",fontWeight:600,gutterBottom:!0,sx:{mb:2},children:"Aktuelle Berechnungen"}),e.jsxs(C,{sx:{bgcolor:"grey.100",p:{xs:2,md:3},borderRadius:1,mb:3},children:[e.jsxs(m,{variant:"body2",sx:{mb:1},children:["1 EUR Spende = ",e.jsxs("strong",{children:[L(Math.floor(1/o.costPerListing))," Inserate"]})," für Community-Topf"]}),e.jsxs(m,{variant:"body2",sx:{mb:1},children:["1 EUR Power-User = ",e.jsxs("strong",{children:[L(Math.floor(1/o.powerUserCreditPrice))," Credits"]})," persönlich"]}),e.jsxs(m,{variant:"body2",sx:{mb:1},children:["Min. Spende ",o.minDonationAmount," EUR = ",e.jsxs("strong",{children:[L(Math.floor(o.minDonationAmount/o.costPerListing))," Inserate"]})]}),e.jsxs(m,{variant:"body2",children:["Min. Power-User ",o.powerUserMinPurchase," EUR = ",e.jsxs("strong",{children:[L(Math.floor(o.powerUserMinPurchase/o.powerUserCreditPrice))," Credits"]})]})]}),e.jsx(C,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:e.jsx(Z,{variant:"contained",startIcon:l?e.jsx(le,{size:20,color:"inherit"}):e.jsx(Bn,{size:20}),onClick:S,disabled:l,size:"large",children:l?"Speichern...":"Einstellungen speichern"})})]})]})},ya=()=>{const t=Ft(),r=Pe(),n=Ee(r.breakpoints.down("md")),{isAdmin:s,loading:a}=bt(),[i,l]=g.useState("users"),[d,f]=g.useState(!1),[x,o]=g.useState(!1);if(g.useEffect(()=>{!a&&!s&&t("/")},[s,a,t]),a)return e.jsx(C,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(le,{})});if(!s)return null;const p=u=>{l(u),n&&o(!1)},S=()=>{switch(i){case"users":return e.jsx(Tt,{});case"roles":return e.jsx(Tr,{});case"tasks":return e.jsx(Wr,{});case"credits":return e.jsx(xa,{});default:return e.jsx(Tt,{})}},h=()=>{switch(i){case"users":return"Benutzerverwaltung";case"roles":return"Rollen & Rechte";case"tasks":return"Aufgaben";case"credits":return"Credit-System";default:return"Admin-Bereich"}};return e.jsxs(C,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[e.jsx(kn,{onNavigate:u=>{u==="items"?t("/"):u==="messages"?t("/messages"):u==="settings"&&t("/settings")},onLoginClick:()=>{},showSearch:!1}),e.jsxs(C,{sx:{display:"flex",flex:1},children:[!n&&e.jsx(Pt,{currentSection:i,onSectionChange:p,collapsed:d,onToggleCollapse:()=>f(!d)}),n&&e.jsxs(Mn,{anchor:"left",open:x,onClose:()=>o(!1),sx:{"& .MuiDrawer-paper":{width:260,boxSizing:"border-box"}},children:[e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(m,{variant:"h6",fontWeight:600,children:"Admin-Bereich"}),e.jsx(ve,{onClick:()=>o(!1),size:"small",children:e.jsx(_n,{size:20})})]}),e.jsx(Pt,{currentSection:i,onSectionChange:p,collapsed:!1,onToggleCollapse:()=>{},isMobile:!0})]}),e.jsx(C,{sx:{flex:1,overflow:"auto"},children:e.jsxs(Pn,{maxWidth:"lg",sx:{py:4},children:[n&&e.jsxs(C,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(ve,{onClick:()=>o(!0),sx:{bgcolor:"action.hover","&:hover":{bgcolor:"action.selected"}},children:e.jsx(_r,{size:20})}),e.jsx(m,{variant:"h5",sx:{fontWeight:600},children:h()})]}),!n&&e.jsx(m,{variant:"h4",sx:{mb:3,fontWeight:600},children:h()}),S()]})})]}),e.jsx(Tn,{})]})},za=Object.freeze(Object.defineProperty({__proto__:null,default:ya},Symbol.toStringTag,{value:"Module"}));export{ya as A,$ as G,_r as M,Pr as T,za as a,bt as u};
