import{x as C,aJ as w,n as z,r as o,j as e,B as t,R as P,P as W,H as I,T as s,l as a,ak as f,o as R,f as S}from"./index-kFPCxDRP.js";import{u as T}from"./useTokens-BWraYwIJ.js";import{A}from"./alert-circle-B4U78Sn6.js";import{A as Z}from"./arrow-right-Pi5aGlFh.js";const M=()=>{const n=C(),[d]=w(),{refetch:h}=T(),{user:l}=z(),[m,u]=o.useState(!0),[b,p]=o.useState(!1),[j,y]=o.useState(!1);return o.useEffect(()=>{const x=d.get("session_id");if(!x){n("/tokens/buy");return}const v=async()=>{if(!l)return!1;const{data:r,error:i}=await S.from("donations").select("id, created_at").eq("stripe_session_id",x).eq("user_id",l.id).maybeSingle();return i?(console.error("Error checking donation:",i),!1):!!r},k=(async()=>{let r=0;const i=20,c=setInterval(async()=>{r++;const g=await v();console.log(`Poll ${r}: donation processed=${g}`),g?(console.log("Payment confirmed!"),p(!0),u(!1),clearInterval(c),h()):r>=i&&(console.log("Polling timeout - payment not processed"),y(!0),u(!1),clearInterval(c))},1e3);return()=>clearInterval(c)})();return()=>{k.then(r=>r&&r())}},[d,n,h,l]),e.jsx(t,{sx:{bgcolor:"#fafafa",minHeight:"100vh",py:8},children:e.jsx(P,{maxWidth:"sm",children:e.jsx(W,{sx:{p:6,borderRadius:3,textAlign:"center",boxShadow:3},children:m?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:64,sx:{mb:3}}),e.jsx(s,{variant:"h5",sx:{fontWeight:700,mb:2},children:"Zahlung wird verarbeitet..."}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Bitte warte einen Moment, während wir deine Credits gutschreiben."})]}):j?e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{display:"inline-flex",p:3,borderRadius:"50%",bgcolor:"warning.main",color:"white",mb:3},children:e.jsx(A,{size:64})}),e.jsx(s,{variant:"h4",sx:{fontWeight:900,mb:2},children:"Zahlung erfolgreich, Credits verzögert"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"Deine Zahlung wurde erfolgreich verarbeitet, aber die Credits konnten noch nicht gutgeschrieben werden."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Bitte warte einige Minuten oder kontaktiere den Support, falls die Credits nicht innerhalb von 10 Minuten erscheinen."}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(f,{size:20}),onClick:()=>n("/settings?section=tokens"),sx:{textTransform:"none",fontWeight:600,py:1.5,borderRadius:2},children:"Zur Credits-Übersicht"}),e.jsx(a,{fullWidth:!0,variant:"outlined",size:"large",onClick:()=>window.location.reload(),sx:{textTransform:"none",fontWeight:600,py:1.5,borderRadius:2},children:"Seite neu laden"})]})]}):b?e.jsxs(e.Fragment,{children:[e.jsx(t,{sx:{display:"inline-flex",p:3,borderRadius:"50%",bgcolor:"success.main",color:"white",mb:3},children:e.jsx(R,{size:64})}),e.jsx(s,{variant:"h4",sx:{fontWeight:900,mb:2},children:"Zahlung erfolgreich!"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Deine Credits wurden erfolgreich gutgeschrieben und stehen dir jetzt zur Verfügung."}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{fullWidth:!0,variant:"contained",size:"large",startIcon:e.jsx(f,{size:20}),onClick:()=>n("/settings?section=tokens"),sx:{textTransform:"none",fontWeight:600,py:1.5,borderRadius:2},children:"Zur Credits-Übersicht"}),e.jsx(a,{fullWidth:!0,variant:"outlined",size:"large",endIcon:e.jsx(Z,{size:20}),onClick:()=>n("/create"),sx:{textTransform:"none",fontWeight:600,py:1.5,borderRadius:2},children:"Jetzt Inserat erstellen"})]})]}):null})})})};export{M as TokenSuccessPage};
